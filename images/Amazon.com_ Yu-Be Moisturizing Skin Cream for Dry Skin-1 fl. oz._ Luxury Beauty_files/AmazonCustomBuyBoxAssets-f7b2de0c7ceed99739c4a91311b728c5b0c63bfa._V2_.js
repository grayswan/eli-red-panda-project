(function(s,B,t){s.execute(function(){(function(){s.when("A","ready").register("ac-base",function(n){var m=n.$;n.on("pc-single-text-loaded",function(){m("html").hasClass("a-canvas")||(m(".pc-customization-disabled").addClass("active"),m(".pc-customization-enabled").remove())});return{getASIN:function(){return m(".ac-mobile-app").length>=1?m(".ac-meta-data").find("#asin").val():m("#ASIN").val()},getOfferListingID:function(){return m("#offerListingID").val()},getMerchantID:function(){return m(".ac-mobile-app").length>=
1?m(".ac-meta-data").find("#merchantID").val():m("#merchantID").val()},isApp:function(){return m(".ac-mobile-app").length>=1}}});s.when("A","ac-base","ready").execute(function(n,m){function g(b){var h="/gp/product/features/log-message.html/ref="+b.refTag,e;a++;e="ajax_amzon_custom_log"+a;if(B.ue){var c=B.uet;c("tc",e)}d.ajax({type:"POST",url:h,dataType:"json",data:{component:b.component,message:b.msg,isMetricsNeeded:b.isMetricsNeeded},success:function(b){if(B.ue){var a=B.ues,h=B.uet,c=B.uex;a("id",
e,b.result.rid);a("t0",e,new Date);a("ctb",e,"1");h("cf",e);h("be",e);c("ld",e)}}})}var d=n.$,a=0,f=m.getASIN(),c={CustomizeNowClick:{refTag:"amz_custom_cn_clk_"+f,component:"Amazon Custom customize now button",msg:"Amazon Custom customize now button clicked",isMetricsNeeded:!1},AddToCartClick:{refTag:"amz_custom_atc_clk_"+f,component:"Amazon Custom Add to cart",msg:"Amazon Custom add to cart clicked",isMetricsNeeded:!1},CloseClick:{refTag:"amz_custom_cls_clk_"+f,component:"Amazon Custom Add to cart",
msg:"Amazon Custom close button clicked",isMetricsNeeded:!1},FontChange:{refTag:"amz_custom_font_chg_"+f,component:"Font drop down list",msg:"Font selected from drop down list",isMetricsNeeded:!1},FontColorChange:{refTag:"amz_custom_color_chg_"+f,component:"Font drop down list",msg:"Font selected from drop down list",isMetricsNeeded:!1},logCustomImageTabClick:{refTag:"pc_ci_tab_clk",component:"Custom image",msg:"Custom Image click",isMetricsNeeded:!1},logVendorGalleryTabClick:{refTag:"pc_ig_tab_clk",
component:"Vendor image gallery",msg:"Vendor image gallery click",isMetricsNeeded:!1},logAddTextTabClick:{refTag:"pc_at_tab_clk",component:"Add Text",msg:"Add Text Click",isMetricsNeeded:!1},logUseThisDesignClick:{refTag:"pc_utdbtn_clk_"+f,component:"UseThisDesignClick",msg:"Use this design click",isMetricsNeeded:!0},logS3TextUploadError:{refTag:"pc_s3_txt_err",component:"S3TextUploadError",msg:"S3 error on text upload",isMetricsNeeded:!0},logS3ImageUploadError:{refTag:"pc_s3_img_pst_err",component:"S3ImageUploadError",
msg:"S3 error on image upload",isMetricsNeeded:!0},logUseThisDesignKindleHucClick:{refTag:"pc_utdgbtn_clk_kin_huc_"+f,component:"UseThisDesignKindleHucClick",msg:"Use this Design From Kindle Click",isMetricsNeeded:!1},hasNonASCII:{refTag:"amz_custom_has_non_ASCII",component:"Text",msg:"Added Non ASCII. PC-Token - ",isMetricsNeeded:!0}};n.on("amazon-custom-popup-open",function(){this.popupOpenTime=new Date});n.on("amazon-custom-popup-close",function(b){b-=this.popupOpenTime;b/=1E3;B.ue.count("pcSingleTextTimer",
b);B.ue.count("pcSingleTextTimer")});n.on("logVendor-ref-Click",function(b){b={refTag:"pc_vi_"+b.categoryName.substring(0,4)+"_"+f,component:"theme for selected vendor image",msg:"Theme selected for vendor image is "+b.categoryName,isMetricsNeeded:!1};g(b)});n.on("amazon-custom-log-ref-tag",function(b,a){if(b!==t){var e=c[b];e!==t&&(a&&a.msg&&(e.msg+=a.msg),g(e))}})})})();(function(){s.when("A","fabric-js","ac-base","ac-utils","ac-constants","ac-simple-textInput","ac-gallery","ac-image-gallery","ac-text-image",
"ac-error-handling","ac-weblab","ready").register("ac-canvas",function(n,m,g,d,a,f,c,b,h,e,j){var k=n.$;return function(a,c){var i=this;i.isActive=!1;i.surface=c;i.childCanvas=[];i.canvas=a;i.isChild=i.canvas.isChild?i.canvas.isChild:!1;i.controls={};i.canvasObjects=[];i.name="";i.canvas.index!==t?(i.id=i.surface.id+"-area-"+i.canvas.index,i.data=c.data.areas[i.canvas.index],i.name=i.data.name):(i.id=i.surface.id+"-primary",i.isChild=!1);i.currentSelectedObject=null;i.enableBuyBox=!1;i.hasRequiredField=
function(){return i.data.customizationType==="TextPrinting"?i.controls&&i.controls.simpleTextInput&&i.controls.simpleTextInput.hasRequiredField():!1};i.requiredFieldsAreValid=function(){return i.data.customizationType==="TextPrinting"?i.controls&&i.controls.simpleTextInput&&i.controls.simpleTextInput.requiredFieldsAreValid():!0};i.emphasizeMissingField=function(){i.data.customizationType==="TextPrinting"&&i.controls&&i.controls.simpleTextInput&&k.isFunction(i.controls.simpleTextInput.emphasizeMissingField)&&
i.controls.simpleTextInput.emphasizeMissingField()};i.renderAll=function(b){b=b?b:1;i.isChild?(i.canvas.renderAll(),setTimeout(function(){d.debounce(i.surface.updatePrimaryCanvas(i.canvas.index),25)},b)):i.canvas.renderAll()};i.getObjects=function(){return i.canvas.getObjects()};i.toDataURL=function(){try{i.canvas.toDataURL()}catch(b){return null}};i.verifyScaling=function(){i.canvas.off("object:modified");i.canvas.on("object:modified",function(b){b=b.target;i.renderAll();b.type!=="text"&&(b.scaleX>
1.5||b.scaleY>1.5?e.show("pc-scale-warning-message"):(b.scaleX<1.5||b.scaleY<1.5)&&e.hide(),i.canvas.calcOffset());i.dragResetObject()})};i.dragResetObject=function(){var b=parseInt(i.canvas.width,10),a=parseInt(i.canvas.height,10),h=new m.Rect({left:0,top:0,width:b,height:a,opacity:0}),c=new m.Point(0,0),j=new m.Point(0+b,0+a);i.canvas.add(h);c=i.canvas.getActiveObject().intersectsWithObject(h)||i.canvas.getActiveObject().isContainedWithinRect(c,j);i.canvas.remove(h);c||(i.canvas.getActiveObject().set({left:0+
(b/2-i.canvas.getActiveObject().width/2),top:0+(a/2-i.canvas.getActiveObject().height/2),scaleX:1,scaleY:1,angle:0}),e.hide(),i.canvas.getActiveObject().setCoords(),i.canvas.calcOffset(),i.renderAll(50))};i.clear=function(){i.canvas.clear();for(var b in i.controls)if(i.controls.hasOwnProperty(b)&&i.controls[b].cleared)i.controls[b].cleared(),i.controls[b].isControlActive=!1;i.renderAll()};i.childCanvas=[];i.addGalleryImage=function(b){var e;e=i.getObjects();d.imageLoading.show();for(var a=i.canvas.size()-
1;a>=0;a--)(e[a].name&&e[a].name==="galImage"||e[a].name&&e[a].name==="cusImage"||e[a].type==="text")&&i.canvas.remove(e[a]);if(i.controls.textInput&&i.controls.textInput.imgText)i.controls.textInput.imgText.resetControl(),i.controls.textInput.isControlActive=!1;k("#pcTextArea").val("");k(".ac-upload-tnC").fadeOut();m.Image.fromURL(b.imageUrl,function(e){i.canvas.add(e);e.name="galImage";d.imageLoading.hide();i.renderAll();e.vendorGalleryFileId=b.vendorGalleryFileId;e.vendorGalleryId=b.vendorGalleryId;
e.originalURL=b.originalURL;k(".pc-two-column-layout .ac-delete-button").fadeIn()},{height:i.canvas.height,width:i.canvas.width,selectable:!1,crossOrigin:"anonymous"})};i.addCustomerImage=function(e){var a,h;a=i.getObjects();for(var c=i.canvas.size()-1;c>=0;c--)i.canvas.deactivateAll(),(a[c].name&&a[c].name==="galImage"||a[c].name&&a[c].name==="cusImage")&&i.canvas.remove(a[c]);h=function(b){b.height>=b.width&&b.height>=i.canvas.height?(b.width*=i.canvas.height/b.height,b.height=i.canvas.height,b.width>
i.canvas.width?(b.height*=i.canvas.width/b.width,b.width=i.canvas.width,b.left=0,b.top=(i.canvas.height-b.height)/2):(b.top=0,b.left=(i.canvas.width-b.width)/2)):b.width>=b.height&&b.width>=i.canvas.width?(b.height*=i.canvas.width/b.width,b.width=i.canvas.width,b.height>i.canvas.height?(b.width*=i.canvas.height/b.height,b.height=i.canvas.height,b.left=(i.canvas.width-b.width)/2,b.top=0):(b.left=0,b.top=(i.canvas.height-b.height)/2)):(b.left=(i.canvas.width-b.width)/2,b.top=(i.canvas.height-b.height)/
2);i.canvas.calcOffset();b.setCoords();i.renderAll()};e=b.prototype.scaleImage(e);m.Image.fromURL(e,function(b){i.canvas.add(b);h(b);d.imageLoading.hide();b.name="cusImage";b.sendToBack();i.canvas.setActiveObject(b);i.renderAll()},{crossOrigin:"anonymous",transparentCorners:!1,borderColor:"white",centeredScaling:!0,lockUniScaling:!0});k(".ac-upload-tnC").fadeIn()};i.setActiveControl=function(b){for(var e in i.controls)if(i.controls.hasOwnProperty(e)&&i.controls[e])i.controls[e].isControlActive=!1;
i.controls[b].isControlActive=!0};i.resetControls=function(){var b=!1,e;e=function(){k(".ac-btn-makeOwn.ac-imageUpload").trigger("click")};for(var a in i.controls)if(i.controls.hasOwnProperty(a)&&i.controls[a].isControlActive)switch(a){case "textInput":k(".ac-btn-makeOwn.ac-textInput").trigger("click");b=!0;break;case "imageUpload":k(".ac-btn-makeOwn.ac-imageUpload").trigger("click"),b=!0}b||e()};i.activate=function(){};i.bindEvents={commonEvent:function(){i.canvas.off("canvas:cleared");i.canvas.on("canvas:cleared",
function(){for(var b=0;b<=i.controls.length;b++)i.controls[b].cleared&&i.controls[b].cleared()});i.canvas.off("object:modified");i.canvas.on("object:modified",function(b){b=b.target;i.controls.textInput?(b.type!=="text"&&((b.scaleX>1.5||b.scaleY>1.5)&&e.show("pc-scale-warning-message"),(b.scaleX<1.5||b.scaleY<1.5)&&e.hide(),i.canvas.calcOffset()),i.dragResetObject(),i.renderAll()):i.controls.imageUpload&&(i.dragResetObject(),i.renderAll())})},imageUpload:function(){i.controls.imageUpload.cleared=
function(){e.hide();k(".ac-upload-tnC").fadeOut()}},imageAndText:function(){i.controls.textInput={};i.canvas.off("object:selected");i.canvas.on("object:selected",function(b){if(b.target)b.target.type==="text"?(i.currentSelectedObject="text",b.target.text!==""&&k(".pc-two-column-layout .ac-delete-button").fadeIn(),n.trigger("slideUpTextArea")):(i.currentSelectedObject="other",n.trigger("slideDownTextArea"),k(".pc-two-column-layout .ac-delete-button").fadeIn())});i.canvas.off("selection:cleared");i.canvas.on("selection:cleared",
function(){if(i.currentSelectedObject==="text")i.currentSelectedObject="other",n.trigger("slideDownTextArea");k(".pc-two-column-layout .ac-delete-button").fadeOut()});i.controls.textInput.cleared=function(){var b=i.getObjects();k("#pcTextArea").val("");i.controls.textInput.imgText.cleared();for(var e=0;e<b.length;e++)b[e].type==="text"&&b[e].remove();n.trigger("slideDownTextArea")}}};i.bindControls=function(){var b=k(".ac-area-control."+i.id+", .ac-area-control.ac-widget-control"),e;k.each(b,function(b,
a){e=k(a).attr("data-control-template");switch(e){case "simple-textInput":var c=new f(a,i,{});i.controls.simpleTextInput=c;break;case "imageUpload":if(i.surface.customizationType==="ImagePrinting")i.verifyScaling(),i.controls.imageUpload={isControlActive:!0},i.bindEvents.imageUpload();break;case "textInput":if(i.surface.customizationType==="ImagePrinting"&&i.data.customizationTypeSettings.ImagePrinting.isCustomTextSupported)i.bindEvents.imageAndText(),i.controls.textInput.imgText=new h(i,{})}})};
i.controlRenderingHandle=function(){var b,e,a;if(i.surface.customizationType==="ImagePrinting"){var h,c,j,f,d=!1;b=!1;e=!1;a=!1;k(".ac-imageUpload-control");h=k(".ac-btn-makeOwn.ac-imageUpload");k(".ac-textInput-control");c=k(".ac-btn-makeOwn.ac-textInput");j=k('.a-tab-heading[data-a-tab-name="gallery"]');f=k('.a-tab-heading[data-a-tab-name="makeOwn"]');i.data.customizationTypeSettings.ImagePrinting&&(i.data.customizationTypeSettings.ImagePrinting.isGallerySupported&&i.data.customizationTypeSettings.ImagePrinting.galleries&&
i.data.customizationTypeSettings.ImagePrinting.galleries.length&&(b=!0),i.data.customizationTypeSettings.ImagePrinting.isCustomerUploadSupported&&(e=!0),i.data.customizationTypeSettings.ImagePrinting.isCustomTextSupported&&(a=!0));j.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-hidden");h.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-hidden");c.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-hidden");
f.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-list-item");b?j.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-list-item"):f.trigger("click");e?h.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-inline"):(k(".ac-imageUpload-control").removeClass("active"),k(".ac-btn-makeOwn.ac-imageUpload").removeClass("active"));
a&&(c.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-inline"),e||(i.surface.widget.surfaceList.forEach(function(b){b.childCanvasList.forEach(function(b){for(var b=b.getObjects(),e=0;e<b.length;e++)b[e].name&&b[e].name==="galImage"&&(d=!0)})}),d||setTimeout(function(){c.trigger("click")},50)));!e&&!a&&(f.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-hidden"),j.addClass("a-active"),
j.parents(".a-tab-container").find('.a-tab-content[data-a-name="makeOwn"]').addClass("a-hidden").siblings('.a-tab-content[data-a-name="gallery"]').removeClass("a-hidden").addClass("a-active"))}};i.fulfillmentJSON=function(){var b={},e=i.getObjects(),a,h;i.canvas.deactivateAll();h=function(){var b,e;e={};for(e=0;e<i.surface.data.FontSettings.colors.length;e++)if(i.surface.data.FontSettings.colors[e].value===i.surface.color){b=i.surface.data.FontSettings.colors[e].name;break}e=i.data.customizationTypeSettings.TextPrinting.placeHolderText;
e={fontFamily:i.surface.fontName,text:i.controls.simpleTextInput.inputBox.val(),fill:i.surface.color,customizationType:"TextPrinting",label:e?e:""};if(b)e.colorName=b;return e};b.name=i.name;b.Position=i.data.specifications.position;b.Dimensions=i.data.specifications.dimension;if(i.surface.customizationType==="ImagePrinting"){for(h=0;h<e.length;h++)if(e[h].name&&e[h].name==="galImage"){var c=e[h].originalURL;a="VendorGallery";b.vendorGalleryImagePath=c;b.vendorGalleryFileId=e[h].vendorGalleryFileId;
b.vendorGalleryId=e[h].vendorGalleryId;b.customizationType="ImagePrinting"}else e[h].type==="text"&&!e[h].text.replace(" ","").length&&e[h].remove();if(!a&&e.length)a="SVG",b.canvas=i.canvas,b.customizationType="ImagePrinting"}else a="JSON",b=k.extend(b,h());if(k("#amazonCustomUseCaseId").val()==="AC_ImgTxtPersonalization_3")b.id=i.id;b.fulfillmentType=a;return b};i.init=function(){i.isChild&&(i.bindControls(),i.controlRenderingHandle());if(k(".ac-mobile-app").length>=1)n.on("resize-preview-text",
function(){i.controls.simpleTextInput&&i.controls.simpleTextInput.inputBox&&i.controls.simpleTextInput.inputBox.trigger("keyup")});j.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_71376")&&i.controls.simpleTextInput&&!i.controls.simpleTextInput.hasRequiredField()&&i.controls.simpleTextInput.hideIsRequiredLabel()}}})})();(function(){s.when("A","ac-base","fabric-js","ac-utils","ac-canvas","ac-color-picker","ac-font-picker","ac-constants","ac-base","ac-weblab","ready").register("ac-surface",function(n,m,g,d,a,f,
c,b,h,e){var j=n.$;return function(k,l,o){var i={},p,z,x,C,E,K,w;i.isActive=!1;i.name="";i.productImageUrl="";i.maskImageUrl="";i.primaryCanvas=null;i.thumbnail=null;i.childCanvasList=[];i.controls={};i.font=m.getMerchantID()+"-Arial";i.customizationType=k.areas[0].customizationType;i.data=k;i.widget=l;i.isApp=h.isApp();w=j("html.a-ie9").length||n.capabilities.isIE10;i.miniThumbnailCanvas=[];p=function(b,e){var c=new a(b,i);c.init();if(h.isApp())n.on("resize-preview-text",function(){if(e!==t){var a=
d.getScaleRatio(),h=e.specifications.dimension.height*a+5;b.setWidth(e.specifications.dimension.width*a);b.setHeight(h)}});return c};x=function(){for(var b=j('.ac-controls-container[data-surface="surface-'+k.index+'"]').find('[type="text"]'),e=0;e<b.length;e++)if(b[e].value.length)return!0;return!1};z=function(b,e){var a,h,c,f,k,l,o=i.isApp,p;if(e.isChild)return null;h=b.specifications.position.y;c=b.specifications.position.x;f=b.specifications.dimension.height;k=b.specifications.dimension.width;
l=b.specifications.angle?b.specifications.angle:0;a=document.createElement("canvas");a.id=i.id+"-area-"+b.index;a.className+=" canvasArea";o?(p=d.getScaleRatio(),a.setAttribute("data-left",c*p),a.setAttribute("data-top",h*p),a.setAttribute("data-initial-left",c),a.setAttribute("data-initial-top",h),a.setAttribute("data-initial-width",k),a.setAttribute("data-initial-height",f),a.setAttribute("data-angle",l),a.height=f*p+5,a.width=k*p):(a.setAttribute("data-left",c),a.setAttribute("data-top",h),a.setAttribute("data-angle",
l),a.height=f+5,a.width=k);j('.ac-preview-container[data-surface="'+i.id+'"]').append(a);a.getContext("2d");var x=new g.Canvas(a.id);l="rotate("+l+"deg)";o?j(a).parent(".canvas-container").css({width:k*p,height:f*p,position:"absolute",top:h*p+"px",left:c*p+"px","-ms-transform":l,"-webkit-transform":l,transform:l}):j(a).parent(".canvas-container").css({position:"absolute",top:h+"px",left:c+"px","-ms-transform":l,"-webkit-transform":l,transform:l});x.isChild=!0;x.parent=e;x.index=b.index;return x};
C=function(b){var e=new Image;e.crossOrigin="anonymous";e.src=k.preview.url;e.onload=function(){b.canvas.setBackgroundImage(new g.Image(e,{originX:"left",originY:"top",left:0,top:0}),function(){b.renderAll.bind(b.canvas);d.debounce(i.updateThumbnail(),50)})};if(k.mask&&k.mask.url){var a=new Image;a.crossOrigin="anonymous";a.src=k.mask.url;a.style.top="-"+k.areas[0].specifications.position.y+"px";a.style.left="-"+k.areas[0].specifications.position.x+"px";a.onload=function(){b.canvas.setOverlayImage(new g.Image(a,
{originY:"top",originX:"left",left:0,top:0}),function(){b.renderAll.bind(b.canvas);d.debounce(i.updateThumbnail(),25)});j("#"+i.id+"-area-0").after(a).parent(".canvas-container").css({height:"400px",width:"400px"})}}};E=function(b){for(var e,a=0;a<k.areas.length;a++)e=k.areas[a],e.index=a,e=i.isApp?p(z(e,b),e):p(z(e,b)),a===0&&i.setActiveArea(e),b.childCanvas.push(e);C(b);return b.childCanvas};K=function(){var b,e=i.data.areas[0].customizationTypeSettings.ImagePrinting.galleries,a,h=!1,c,f;j("#ac-gallery.vendor-categories > .vendor-category").css({display:"none"});
if(i.data.areas[0].customizationTypeSettings.ImagePrinting.defaultGallery)a=i.data.areas[0].customizationTypeSettings.ImagePrinting.defaultGallery;for(var d=0;d<e.length;d++)if(b="",b=e[d].charAt(0)==="/"?e[d].substr(1,e[d].length):e[d])c=j('#ac-gallery.vendor-categories > .vendor-category > a[data-themename="'+b+'"]'),f=j('#ac-gallery.vendor-categories > .vendor-category > a[data-categoryid="'+b+'"]'),c.length?(c.parent(".vendor-category").css({display:"block"}),a&&a.substr(1,a.length)===b&&(c.trigger("click"),
h=!0)):f.length&&(f.parent(".vendor-category").css({display:"block"}),a&&a.substr(1,a.length)===b&&(f.trigger("click"),h=!0));h||j("#ac-gallery.vendor-categories > .vendor-category > a").each(function(b,e){j(e).parent(".vendor-category").css("display")==="block"&&j(e).trigger("click")})};i.setActiveArea=function(b){for(var e=0;e<i.childCanvasList.length;e++)i.childCanvasList[e].isActive=!1;b.isActive=!0;return b};i.updateTickerOnTab=function(){x()?j(".pc-surface-nav-carousel").find('[data-surface-num="'+
(k.index+1)+'"]').addClass("customized"):j(".pc-surface-nav-carousel").find('[data-surface-num="'+(k.index+1)+'"]').removeClass("customized")};i.isSurfaceCustomized=function(){for(var b=j('.ac-controls-container[data-surface="surface-'+k.index+'"]').find('[type="text"]'),e=0;e<b.length;e++)if(b[e].value.length)return!0;return!1};i.getActiveArea=function(){var b,e;for(b=0;b<i.childCanvasList.length;b++)i.childCanvasList[b].isActive===!0&&(e=i.childCanvasList[b]);return e};i.hasRequiredField=function(){return n.reduce(i.childCanvasList,
function(b,e){return b||e.hasRequiredField()},!1)};i.requiredFieldsAreValid=function(){return n.reduce(i.childCanvasList,function(b,e){return b&&e.requiredFieldsAreValid()},!0)};i.emphasizeMissingFields=function(){n.each(i.childCanvasList,function(b){b.requiredFieldsAreValid()||b.emphasizeMissingField()});var b=i.getThumbnailImage().parent();b.hasClass("active")||b.addClass("error")};i.enableBuyBox=function(){for(var b=!1,e=0;e<i.childCanvasList.length;e++)if(i.childCanvasList[e].enableBuyBox===!0){b=
!0;break}return b};i.getThumbnailImage=function(){return j(".thumbnail-container").find('.thumbnail-image[ac-target="'+i.id+'"]')};i.setPrimaryCanvas=function(){var b;b=p(new g.Canvas("ac-preview-canvas-"+i.id));b.isChild=!1;return b};i.updatePrimaryCanvas=function(b){var e,a,h,c,f=!1;e=function(){var e={};e.height=i.primaryCanvas.childCanvas[b].canvas.height;e.width=i.primaryCanvas.childCanvas[b].canvas.width;e.top=j("canvas#"+i.id+"-area-"+b).data("top");e.left=j("canvas#"+i.id+"-area-"+b).data("left");
e.angle=j("canvas#"+i.id+"-area-"+b).data("angle");return e};if(i.primaryCanvas.childCanvas[b]){var k=i.primaryCanvas.childCanvas[b].getObjects(),o;c=i.primaryCanvas.getObjects();for(var p=i.primaryCanvas.canvas.size()-1;p>=0;p--)c[p].areaId!==t&&c[p].areaId===b&&i.primaryCanvas.canvas.remove(c[p]);if(k.length)if(k.length===1&&k[0].type==="text"&&(k[0].text===""||k[0].text===" "))i.primaryCanvas.childCanvas[b].canvas.deactivateAll();else{f=!0;for(p=i.primaryCanvas.childCanvas[b].canvas.size()-1;p>=
0;p--)k[p].active&&(o=k[p]);h=e();var x=function(b){var e={},a=!1,e={left:-b.width/2,top:-b.height/2,width:b.width,height:b.height};if(b.left<0){if(a=!0,e.left=-b.width/2-b.left,b.width+b.left>h.width)e.width=h.width}else if(b.width+b.left>h.width)a=!0,e.left=-b.width/2-(b.width+b.left-h.width);if(b.top<0){if(a=!0,e.top=-b.height/2-b.top,b.height+b.top>h.height)e.height=h.height}else if(b.height+b.top>h.height)a=!0,e.top=-b.height/2-(b.height+b.top-h.height);e.clipNeeded=a;return e};e=function(){i.primaryCanvas.canvas.forEachObject(function(e){e.areaId===
b&&e.remove()});w?i.primaryCanvas.childCanvas[b].canvas.forEachObject(function(e){var c=g.util.object.clone(e);if(!w&&c.type==="group")for(var j=c.getObjects(),f=0;f<j.length;f++)j[f].text&&(e=g.util.object.clone(j[f]),e.top+=c.top,e.top+=c.top,c=e);i.primaryCanvas.canvas.calcOffset();i.primaryCanvas.canvas.add(c);if(c.type==="image"){c.sendToBack();try{var k={},l,o,p,z;l=c.getBoundingRect();k=x(l);o=new g.Rect({left:h.left,top:h.top,height:h.height,width:h.width,selectable:!1,fill:"none",strokeWidth:0,
opacity:0});i.primaryCanvas.canvas.add(o);p=function(b){return b*(Math.PI/180)};z=function(b,e){e.setCoords();b.save();b.translate(-(e.width/2)+o.strokeWidth,-(e.height/2)+o.strokeWidth);b.rotate(p(e.angle*-1));b.scale(1,1);b.beginPath();b.rect(o.left-e.oCoords.tl.x,o.top-e.oCoords.tl.y,o.width,o.height);b.closePath();b.restore()};c.clipTo=function(b){return z(b,c)}}catch(C){}}c.type==="text"?c.text.replace(/\s/g,"")===""?i.primaryCanvas.canvas.remove(c):(k={},l=c.getBoundingRect(),k=x(l),k.clipNeeded?
(a=c.toDataURL(),g.Image.fromURL(a,function(e){e.set({top:l.top+h.top,left:l.left+h.left,selectable:!1,areaId:b});i.primaryCanvas.canvas.remove(c);c=e;i.primaryCanvas.canvas.add(e);e.clipTo=function(b){b.rect(k.left,k.top,k.width,k.height)};i.primaryCanvas.canvas.renderAll();d.debounce(i.updateThumbnail(),50)})):(c.left+=h.left,c.top+=h.top,c.areaId=b)):(c.left+=h.left,c.top+=h.top,c.areaId=b);c.setCoords()}):(a=i.primaryCanvas.childCanvas[b].canvas.toDataURL("png"),g.Image.fromURL(a,function(e){e.set({height:h.height,
width:h.width,top:h.top,left:h.left,selectable:!1});e.areaId=b;i.primaryCanvas.canvas.add(e);i.primaryCanvas.canvas.renderAll();d.debounce(i.updateThumbnail(),50)}));i.primaryCanvas.canvas.renderAll()};o?(i.primaryCanvas.childCanvas[b].canvas.deactivateAll(),e(),i.primaryCanvas.childCanvas[b].canvas.setActiveObject(o)):e()}d.debounce(i.updateThumbnail(),50);i.primaryCanvas.childCanvas[b].enableBuyBox=!!f;l.buybox.verify()}};i.updateThumbnail=function(){if(!i.widget.showThumbnail)return null;try{if(i.customizationType===
"TextPrinting"&&!w){var e=i.primaryCanvas.canvas.toDataURL("png");i.getThumbnailImage().html("<img src='"+e+"' class='thumbnail-image "+i.id+"' />")}else{var a,h,c,f,d;a=b.defaults.thumbnailHeight/b.defaults.galHeight;d=i.getThumbnailImage();if(!d.find(".ieThumbnail-bg").length)h=j("<img />",{"class":"ieThumbnail-bg",src:i.data.preview.url,alt:"Thumbnail Image",height:b.defaults.thumbnailHeight+"px",width:b.defaults.thumbnailWidth="px"});d.html(h);c=function(b,e){var h,c,f,d,k,l;c=b.position.y*a;
f=b.position.x*a;d=b.dimension.height*a;k=b.dimension.width*a;l=b.angle?o.specifications.angle:0;h=document.createElement("canvas");h.id="thumbnail-"+i.id+"-area-"+e;h.className+="thumbnail-canvasArea";h.height=d;h.width=k;i.getThumbnailImage().append(h);h.getContext("2d");d=new g.Canvas(h.id);l="rotate("+l+"deg)";j(h).parent(".canvas-container").css({position:"absolute",top:c+"px",left:f+"px","-ms-transform":l,"-webkit-transform":l,transform:l});return d};for(e=0;e<i.childCanvasList.length;e++)j("#thumbnail-"+
i.id+"-area-"+e).length?(f=i.miniThumbnailCanvas[e],f.clear()):(f=c(i.childCanvasList[e].data.specifications,e),i.miniThumbnailCanvas[e]=f),i.customizationType==="ImagePrinting"?i.childCanvasList[e].canvas.forEachObject(function(b){var e=g.util.object.clone(b);f.calcOffset();f.add(e);e.top=b.top*a;e.left=b.left*a;e.scaleX*=a;e.scaleY*=a;e.selectable=!1;f.deactivateAll();e.type!=="text"&&e.sendToBack();e.setCoords();f.renderAll()}):i.customizationType==="TextPrinting"&&function(b,e){g.Image.fromURL(b,
function(b){e.add(b);b.scaleX=a;b.scaleY=a;b.selectable=!1;e.renderAll()})}(i.childCanvasList[e].canvas.toDataURL("png"),f);if(i.data.mask&&i.data.mask.url&&!d.find(".ieThumbnail-mask").length){var k=j("<img />",{"class":"ieThumbnail-mask",src:i.data.mask.url,alt:"Thumbnail Mask Image"});j(k).load(function(){var b,e;b=this.naturalHeight;e=this.naturalWidth;j(this).height(b*a).width(e*a)});d.find(".canvas-container").after(k)}}}catch(l){return console.log(l),null}};i.activateSurface=function(){l.setActiveSurface(i.id);
i.customizationType==="ImagePrinting"&&(i.getActiveArea().resetControls(),i.getActiveArea().controlRenderingHandle());i.customizationType==="TextPrinting"&&j("#ac-simple-text-font-picker",j("div[data-surface='"+i.id+"']")).val(i.font)};i.bindEvents=function(){j(".thumbnail-container .ac-thumbnail.surface-0").addClass("active");j(".thumbnail-container").delegate('[ac-target="'+i.id+'"]',"click",function(){if(j('.ac-preview-container[data-surface="'+i.id+'"]').css("display").toLowerCase()==="block")return null;
j(".ac-thumbnail").removeClass("active");j(".ac-thumbnail."+i.id).addClass("active");e.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_71376")&&j(".ac-thumbnail."+i.id).removeClass("error");j(".ac-preview-container").css("display","none").parent().find('[data-surface="'+i.id+'"]').css("display","block");i.customizationType==="ImagePrinting"?(j(".ac-controls-container").css("display","none").parent().find(".ac-controls-container.ac-image-text-control").css("display","block"),i.data.areas[0].customizationTypeSettings.ImagePrinting.galleries&&
K(),j(".ac-single-text-preview-guideline").css({display:"none"})):(j(".ac-controls-container").css("display","none").parent().find('[data-surface="'+i.id+'"]').css("display","block"),j(".pc-two-column-layout .ac-delete-button").fadeOut(),j(".ac-single-text-preview-guideline").css({display:"block"}));i.activateSurface()});return K};i.notifySubscribers=function(b,e){switch(b){case "colorpicker":i.color=e;for(var a=0;a<i.childCanvasList.length;a++)i.childCanvasList[a].controls.simpleTextInput&&(i.childCanvasList[a].controls.simpleTextInput.changePreview(),
n.trigger("amazon-custom-log-ref-tag","FontColorChange"));break;case "fontpicker":i.font=e;for(a=0;a<i.childCanvasList.length;a++)i.childCanvasList[a].controls.simpleTextInput&&(i.childCanvasList[a].controls.simpleTextInput.changePreview(),n.trigger("amazon-custom-log-ref-tag","FontChange"))}};i.bindControls=function(){var b=j(".ac-surface-control."+i.id),e;j.each(b,function(b,a){e=j(a).attr("data-control-template");switch(e){case "colorpicker":var h=new f(a,i);i.controls.colorPicker=h;break;case "fontpicker":h=
new c(a,i),i.controls.fontPicker=h}})};i.initiateEvents=function(){};i.fulfillmentJSON=function(){var b={},e=[];b.name=i.name;if(j("#amazonCustomUseCaseId").length&&j("#amazonCustomUseCaseId").val()==="AC_ImgTxtPersonalization_3"){b.images={};if(k.preview&&k.preview.url)b.images.previewUrl=k.preview.url;if(k.mask&&k.mask.url)b.images.maskUrl=k.mask.url;if(i.customizationType==="TextPrinting"){b.font={};if(i.font.substring(0,3)==="ac_"){b.font.isDefault=0;var a=i.data.FontSettings.fonts.filter(function(b){if(b.name===
i.fontName)return!0});if(a.length===1)b.font.fontUrl=a[0].fontURL}else b.font.isDefault=1;b.font.fontName=i.fontName}b.id=i.id}for(a=0;a<i.childCanvasList.length;a++)e.push(i.childCanvasList[a].fulfillmentJSON());b.areas=e;return b};i.init=function(){i.name=k.name;i.isActive=k.isActive;i.id="surface-"+k.index;i.productImageUrl=k.preview.productImageUrl;i.maskImageUrl=k.preview.maskImageUrl;i.primaryCanvas=i.setPrimaryCanvas();i.childCanvasList=E(i.primaryCanvas);i.bindEvents();i.bindControls();i.initiateEvents()};
i.init();return i}})})();(function(){s.when("A","ac-base","ready").register("ac-utils",function(n,m){var g=n.$,d,a,f,c;d={};a=function(b){var a=null;try{a=n.state(b)?n.state(b):null}catch(e){a=null}finally{return a}};c=function(){for(var b=g(".pc-customization-enabled script"),a=0,e=b.length;a<e;a++)if(!g.data(b[a],"a-eval")){var c=g(b[a]),f=c.attr("data-a-state");f&&(f=n.parseJSON(f),f.key&&(c=n.parseJSON(c.html()),n.state.replace(f.key,c)))}return!0};d.init=function(){c();f=a("wssStringArray")};
d.getState=function(b,h){if(h){var e=!1,e=c();if(!e)return}f||(f=a("wssStringArray"));return a(b)};d.validator=function(){var b={AlphaNumeric:function(){return!0},Digits:function(b){return/^[\s\d]*$/.test(b)}};return{Validate:function(a,e){return b[e]!==t&&typeof b[e]==="function"?b[e](a):!0}}};d.debounce=function(b,a,e){var c;return function(){var f=this,d=arguments,g=e&&!c;clearTimeout(c);c=setTimeout(function(){c=null;e||b.apply(f,d)},a);g&&b.apply(f,d)}};d.showDialog={show:function(b,a,e){e&&
e.ok&&g(".ac-btn.ac-btn-dialog-ok").text(e.ok);e&&e.cancel&&g(".ac-btn.ac-btn-dialog-cancel").text(e.cancel);b&&g("#ac-dialog-confirm p").html(b);g("#ac-dialog-confirm").fadeIn();g(".ac-image-backdrop").fadeIn();g("#ac-dialog-confirm").undelegate(".ac-btn-dialog-ok","click");g("#ac-dialog-confirm").delegate(".ac-btn-dialog-ok","click",function(){g("#ac-dialog-confirm").fadeOut();g(".ac-image-backdrop").fadeOut();a()});g("#ac-dialog-confirm").undelegate(".ac-btn-dialog-cancel","click");g("#ac-dialog-confirm").delegate(".ac-btn-dialog-cancel",
"click",function(){g("#ac-dialog-confirm").fadeOut();g(".ac-image-backdrop").fadeOut();e&&e.cancelCallBack&&e.cancelCallBack();d.imageLoading.hide()})}};d.imageLoading={show:function(){g(".ac-image-loader").fadeIn();g(".ac-image-backdrop").fadeIn()},hide:function(){g(".ac-image-loader").fadeOut();g(".ac-image-backdrop").fadeOut()}};d.arrFilterUnique=function(b){return b.filter(function(b,e,a){return a.indexOf(b)===e})};d.stringHandler=function(b){return f&&f[b]?f[b]:""};d.getScaleRatio=function(){var b=
1;if(m.isApp()){var a=g(".ac-surface-background-image"),b=a.width();a.height();a=a.get()[0].naturalWidth;b/=a}return b};return d})})();(function(){s.when("A","fabric-js","ac-base","BuyBox","ac-constants","ac-surface","ac-utils","ac-gallery","ac-image-gallery","ac-weblab","ready").register("ac-widget",function(n,m,g,d,a,f,c,b,h,e){var j=n.$;return function(){var h=this,l,o;h.surfaceList=[];h.data={};h.showThumbnail=!0;h.acTempCanvas=new m.Canvas("acTempCanvas");o=function(){j(".pc-two-column-layout").delegate(".ac-delete-button",
"click",function(){var b=h.getActiveArea();b.canvas.forEachObject(function(e){var a;if(e&&e.active||e&&e.name&&e.name==="galImage"){if(e.type&&e.type==="text")a=b.controls.textInput.cleared;if(e.name&&e.name==="cusImage")a=b.controls.imageUpload.cleared;a&&a();b.canvas.remove(e)}});b.canvas.discardActiveGroup();j(".pc-two-column-layout .ac-delete-button").fadeOut();b.renderAll()})};h.getActiveSurface=function(){for(var b=null,e=0;e<h.surfaceList.length;e++)h.surfaceList[e].isActive===!0&&(b=h.surfaceList[e]);
return b};h.setActiveSurface=function(b){for(var e=0;e<h.surfaceList.length;e++)if(h.surfaceList[e].isActive=!1,h.surfaceList[e].id===b)h.surfaceList[e].isActive=!0};h.getActiveArea=function(){return h.getActiveSurface().getActiveArea()};h.fulfillmentJSON=function(){var b={},e=[],c=[],f,d;d=h.acTempCanvas;d.setDimensions(a.outputSVGDimention);f=function(b){var e=a.scaleRatio,h,c,f,i;f=parseInt(j(b.lowerCanvasEl).parent(b.wrapperEl).css("top").replace("px",""),10);i=parseInt(j(b.lowerCanvasEl).parent(b.wrapperEl).css("left").replace("px",
""),10);d.clear();b.forEachObject(function(b){b=m.util.object.clone(b);b.type!=="rect"&&(d.calcOffset(),d.add(b),b.type==="image"&&(b.sendToBack(),h=b.getSrc()),b.type==="text"&&b.text.replace(/\s/g,"")===""&&d.remove(b),b.top+=f,b.left+=i,b.scaleX*=e,b.scaleY*=e,b.left*=e,b.top*=e,b.setCoords())});d.renderAll();h&&h.indexOf("._")!==-1&&h.indexOf("._")!==-1?(c=h.split("._")[0]+"."+h.split("_.")[1],b=d.toSVG(null,function(b){return b.replace(RegExp(/xlink:href=\"\S*\"/),'xlink:href="'+c+'"').replace(/(<tspan\s(.*?)>)(.*?)(<\/tspan>)/g,
"$1<![CDATA[$3]]\>$4")})):b=d.toSVG(null,function(b){return b.replace(/(<tspan\s(.*?)>)(.*?)(<\/tspan>)/g,"$1<![CDATA[$3]]\>$4")});return b};b.customizationInfo={fulfillmentDetails:h.data.fulfillmentDetails,"version3.0":{surfaces:[]}};b.merchantId=g.getMerchantID();for(var l=0;l<h.surfaceList.length;l++)e.push(h.surfaceList[l].fulfillmentJSON());for(l=0;l<e.length;l++)for(var o=0;o<e[l].areas.length;o++)e[l].areas[o].fulfillmentType==="SVG"?(e[l].areas[o].svgImage=f(e[l].areas[o].canvas),delete e[l].areas[o].canvas):
e[l].areas[o].fulfillmentType||e[l].areas.splice(o,1);for(l=0;l<e.length;l++)e[l].areas.length&&c.push(e[l]);b.customizationInfo["version3.0"].surfaces=c;return b};h.bindControls={galleryImage:function(){n.on("addGalleryImage",function(b){var e,a,f,j=!1;e=h.getActiveSurface();n.trigger("amazon-custom-log-ref-tag","logVendorGalleryTabClick");a=e.getActiveArea();if(a.getObjects().length===1&&a.getObjects()[0].name==="galImage"&&a.getObjects()[0].getSrc()===b.imageUrl)return null;e=c.stringHandler("pc-clear-custom-msg");
f=function(){h.surfaceList.forEach(function(e){e.childCanvasList.forEach(function(e){for(var a=e.getObjects(),h=!1,c=0;c<a.length;c++)a[c].name&&a[c].name==="galImage"&&a[c].getSrc()===b.imageUrl&&(h=!0);h||e.clear()})});a.addGalleryImage(b)};for(var d=0;d<h.surfaceList.length;d++){for(var g=0;g<h.surfaceList[d].childCanvasList.length;g++){var l,o=h.surfaceList[d].childCanvasList[g];l=o.getObjects();for(var m=o.canvas.size()-1;m>=0;m--)if(l[m].type==="text"&&!l[m].text.replace(" ","").length)l[m].remove(),
o.controls.textInput.isControlActive=!1;else if(l[m].name&&l[m].name==="cusImage"||l[m].type==="text"){j=!0;break}if(j)break}if(j)break}j?c.showDialog.show(e,f,{ok:"Clear"}):f()})},uploadImage:function(){n.off("addCustomerImage");n.on("addCustomerImage",function(b){var e,a,f,j=!1;e=h.getActiveSurface().getActiveArea();e.getObjects();a=c.stringHandler("pc-clear-design-msg");f=function(){h.surfaceList.forEach(function(b){b.childCanvasList.forEach(function(b){for(var e=b.getObjects(),a=0;a<e.length;a++)e[a].name&&
e[a].name==="galImage"&&b.clear()})});e.addCustomerImage(b)};h.surfaceList.forEach(function(b){b.childCanvasList.forEach(function(b){for(var b=b.getObjects(),e=0;e<b.length;e++)if(b[e].name&&b[e].name==="galImage"){j=!0;break}})});j?c.showDialog.show(a,f,{ok:"Clear"}):f()});j(".ac-image-text-container").delegate(".ac-btn-makeOwn.ac-imageUpload","click",function(){j(".ac-imageUpload-control").addClass("active");j(".ac-btn-makeOwn.ac-imageUpload").addClass("active");j(".ac-textInput-control").removeClass("active");
j(".ac-btn-makeOwn.ac-textInput").removeClass("active");h.getActiveSurface().getActiveArea().setActiveControl("imageUpload");n.trigger("amazon-custom-log-ref-tag","logCustomImageTabClick")})},textOnImage:function(){(function(){j("#pcTextArea").unbind().bind("keyup",function(){var b=j(this).val().replace('"',"''");j(this).val(b);if(b.length>50)return b=b.substring(0,50),j(this).val(b),null;h.getActiveArea().controls.textInput.imgText.updateText(b);j(this).val()});j(".pc-textArea-fontStyle-li").unbind().bind("click",
function(){j(this).toggleClass("button-active");var b=j(this).attr("data-style");b+=j(this).hasClass("button-active")?"on":"off";h.getActiveArea().controls.textInput.imgText.toggleStyle(b)});j(".pc-textArea-fontAlign-li").unbind().bind("click",function(){j(".pc-textArea-fontAlign-li").removeClass("button-active");j(this).addClass("button-active");var b=j(this).attr("data-align");h.getActiveArea().controls.textInput.imgText.changeAlign(b)});n.off("a:dropdown:fontPicker:select");n.on("a:dropdown:fontPicker:select",
function(b){h.getActiveArea().controls.textInput.imgText.changeFont(b.value)});j(".pc-textArea-fontColor-li").unbind().bind("click",function(){h.getActiveArea().controls.textInput.imgText.changeTextColor(j(this).find("div").attr("data-color"))});n.off("a:popover:show:text-color");n.on("a:popover:show:text-color",function(b){b.popover.$popover.css("z-index",999999)});n.off("slideUpTextArea");n.on("slideUpTextArea",function(){var b=j(".pc-textArea-overlay");b.parents().is(":hidden")?b.hide():b.slideUp(100,
function(){j("#pcTextArea").focus()})});n.off("slideDownTextArea");n.on("slideDownTextArea",function(){j(".pc-textArea-overlay").slideDown()})})();j(".ac-image-text-container").delegate(".ac-btn-makeOwn.ac-textInput","click",function(){var b;j(".ac-imageUpload-control").removeClass("active");j(".ac-btn-makeOwn.ac-imageUpload").removeClass("active");j(".ac-textInput-control").addClass("active");j(".ac-btn-makeOwn.ac-textInput").addClass("active");b=h.getActiveArea();b.controls.textInput.imgText.updateControl();
b.controls.textInput.imgText.select();b.setActiveControl("textInput");n.trigger("slideUpTextArea");n.trigger("amazon-custom-log-ref-tag","logAddTextTabClick")})}};h.initiateBuyBox=function(){(new d({controller:{getJSON:h.fulfillmentJSON}})).Init()};h.buybox={enable:function(){n.trigger("enableBuybox")},disable:function(){n.trigger("disableBuybox")},block:function(b){n.trigger("blockBuybox",b)},unblock:function(){n.trigger("unblockBuybox")},showMissingCustomization:function(b){n.trigger("showMissingCustomization",
b)},hideMissingCustomization:function(){n.trigger("hideMissingCustomization")},showMissingRequiredFields:function(b){n.trigger("showMissingRequiredFields",b)},hideMissingRequiredFields:function(){n.trigger("hideMissingRequiredFields")}};h.buybox.verify=e.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_71376")?function(){var b=!1,e,a=[];if(n.reduce(h.surfaceList,function(b,e){return b||e.hasRequiredField()},!1)){b=!0;for(e=0;e<h.surfaceList.length;e++){var c=h.surfaceList[e],f=c.requiredFieldsAreValid();f||a.push(c);
b=b&&f}b=!b;e=function(){n.each(a,function(b){b.emphasizeMissingFields()});h.buybox.showMissingRequiredFields({error:!0})}}else b=!n.reduce(h.surfaceList,function(b,e){return b||e.enableBuyBox()},!1),e=function(){h.buybox.showMissingCustomization({error:!0})};b?h.buybox.block({callback:e}):(h.buybox.unblock(),h.buybox.hideMissingRequiredFields(),h.buybox.hideMissingCustomization());h.buybox.enable()}:function(){for(var b=!1,e=0;e<h.surfaceList.length;e++)if(h.surfaceList[e].enableBuyBox()){b=!0;break}b?
h.buybox.enable():h.buybox.disable()};h.init=function(){var e,a,d=!1,g=[],C;c.init();a=c.getState("ctsStateData",!0);h.data=a;for(var E=0;E<a.surfaces.length;E++){e=a.surfaces[E];e.index=E;E===0?e.isActive=!0:e.isActive=!1;e=new f(e,h);if(E===0)e.isActive=!0,e.customizationType==="ImagePrinting"?(j(".ac-single-text-preview-guideline").css({display:"none"}),j(".ac-image-text-preview-guideline").css({display:"block"})):j(".ac-single-text-preview-guideline").css({display:"block"});if(e.customizationType===
"ImagePrinting"){var d=!0,K=e.data.areas[0].customizationTypeSettings.ImagePrinting.galleries;if(K&&K.length&&(g=g.concat(K),!C&&e.data.areas[0].customizationTypeSettings.ImagePrinting.defaultGallery))C=e.data.areas[0].customizationTypeSettings.ImagePrinting.defaultGallery}h.surfaceList.push(e)}if(a.surfaces.length===1&&a.surfaces[0].areas[0].customizationType==="TextPrinting")j(".thumbnail-container").fadeOut("fast"),j(".ac-image-text-preview-guideline").fadeOut("fast"),j(".pc-two-column-layout .pc-input-controls").addClass("ac-single-text-only"),
j(".pc-two-column-layout .ac-controls-container").addClass("ac-single-text-only"),j(".pc-two-column-layout").addClass("ac-single-text-only"),j(".pc-atc-wrapper").addClass("a-button-span12"),j(".ac-price").addClass("ac-single-text-only"),j(".ac-quantity").addClass("ac-single-text-only"),h.showThumbnail=!1;g=c.arrFilterUnique(g);o();h.initiateBuyBox();d===!0&&(g.length&&(l=new b(null,g,C),l.Fetch()),h.bindControls.galleryImage(),h.bindControls.uploadImage(),h.bindControls.textOnImage())}}})})();s.when("A",
"ready").execute(function(n){function m(){g("html").hasClass("a-canvas")||(g(".pc-customization-disabled").addClass("active"),g(".pc-customization-enabled").remove())}var g=n.$;n.on("pc-single-text-loaded",function(){m()});m()});s.when("A","a-modal","ac-utils","ac-widget","ac-base","ready").execute(function(n,m,g,d){function a(){if(f(".ac-mobile-app").length>=1){var b=f(".ac-surface-background-image"),a=b.width(),b=b.height();g.getScaleRatio();f(".canvas-container > .ac-parent-canvas").attr({width:a,
height:b}).css({width:a+"px",height:b+"px"});f(".canvas-container .canvasArea").each(function(b,a){var h=f(a).attr("data-initial-top"),c=f(a).attr("data-initial-left"),d=f(a).attr("data-initial-width"),i=f(a).attr("data-initial-height"),p=g.getScaleRatio();h!==t&&c!==t&&(f(a).attr({"data-top":parseInt(h,10)*p,"data-left":parseInt(c,10)*p}),f(a).parent().css({top:parseInt(h,10)*p,left:parseInt(c,10)*p,width:d+"px",height:i+"px"}))});f(".ac-preview-container").css({"min-height":b+10});n.trigger("resize-preview-text")}}
var f=n.$,c=[];n.on("a:popover:afterShow:pc-buybox-secondary-view",function(){a();f("#pc-customize-now-div").attr("data-customization-clicked")==="false"&&((new d).init(),f("#pc-customize-now-div").attr("data-customization-clicked","true"));n.on("resize-preview",function(){a()})});n.on("a:popover:afterHide:pc-popover-content",function(){n.trigger("amazon-custom-log-ref-tag","CloseClick");n.trigger("amazon-custom-popup-close",new Date)});f("html").hasClass("a-canvas")&&(f(".pc-customization-disabled").remove(),
n.declarative("popover-trigger","click",function(){var b=f(".pc-popover-button"),a=m.get(b);n.trigger("amazon-custom-log-ref-tag","CustomizeNowClick");if(a===null){if(c.length>0){for(a=0;a<c.length;a++)m.remove(c[a]);c.length=0}a=m.create(b,{name:"pc-popover-content",header:f(".pc-popover-header").html(),activate:"onclick"});f(".pc-popover-header").remove();a.lock().show();c.push(a);b=f("#ASIN",f(".pc-buy-box",f(".pc-two-column-layout"))).val();f(".pc-two-column-layout").attr("asin",b);(new d).init()}}))});
(function(){s.when("A","fabric-js","ac-utils","ac-base","ac-weblab","ready").register("ac-simple-textInput",function(n,m,g,d,a){var f=n.$;return function(c,b,h){var e={},j,k,l;d.isApp()?(e.inputBox=f(c).find(".pc-simple-text-input input"),e.errorClassTarget=f(c).find("div.pc-simple-text-input")):(e.inputBox=f(c).find("input.pc-simple-text-input"),e.errorClassTarget=e.inputBox);e.isRequiredLabel=f(c).find(".isRequiredLabel");e.maxLength=parseInt(e.inputBox.attr("maxLength"),10);e.textLimitElement=
f(c).find(".pc-char-limit-length");e.charType=f(e.inputBox).data("input-type");e.acCanvas=b;e.options=h;e.isEmpty=function(){var b=!1;e.inputBox.val().replace(/\s/g,"")===""&&(b=!0);return b};e.isValid=function(){return g.validator().Validate(e.inputBox.val(),e.charType)&&!e.isEmpty()};e.cleared=function(){e.inputBox.val("")};e.hasRequiredField=function(){return b.data&&b.data.customizationTypeSettings&&b.data.customizationTypeSettings.TextPrinting&&!!b.data.customizationTypeSettings.TextPrinting.isRequired};
e.requiredFieldsAreValid=function(){return e.isValid()};e.hideIsRequiredLabel=function(){f(e.isRequiredLabel).hide()};e.emphasizeMissingField=function(){e.addErrorClass();f(e.isRequiredLabel).addClass("a-color-error")};e.addErrorClass=function(){a.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_71376")?e.errorClassTarget.addClass("a-form-error"):e.inputBox.addClass("a-form-error")};e.removeErrorClass=function(){a.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_71376")?e.errorClassTarget.removeClass("a-form-error"):e.inputBox.removeClass("a-form-error")};
e.changePreview=function(b){b||(b=e.inputBox.val());if(e.acCanvas.canvasObjects[e.acCanvas.id]!==t){var a=e.acCanvas.canvasObjects[e.acCanvas.id];a.forEachObject(function(b){e.acCanvas.canvasObjects[e.acCanvas.id].removeWithUpdate(b)});e.acCanvas.canvas.remove(a)}if(b&&b.replace(/\s+/g,"").length){a={fontFamily:e.acCanvas.surface.font,fontSize:e.acCanvas.canvas.height,fill:e.acCanvas.surface.color,selectable:!1,textAlign:"center",originX:"center",originY:"center",lockMovementX:!0,lockMovementY:!0,
lineHeight:1.3/1.13};if(d.isApp())a.fontSize=Math.round(e.acCanvas.canvas.height);b=new m.Text(b,a);a={originX:"center",originY:"center",fill:"",opacity:0,width:e.acCanvas.canvas.width,height:e.acCanvas.canvas.height,selectable:!1,lockMovementX:!0,lockMovementY:!0,clipTo:function(b){b.rect(-(e.acCanvas.canvas.width/2),-(e.acCanvas.canvas.height/2),e.acCanvas.canvas.width,e.acCanvas.canvas.height+5)}};if(d.isApp())a.width=Math.round(e.acCanvas.canvas.width),a.height=Math.round(e.acCanvas.canvas.height);
var a=new m.Rect(a),h={left:0,top:0,width:e.acCanvas.canvas.width,height:e.acCanvas.canvas.height,lockScalingX:!0,lockScalingY:!0,lockMovementX:!0,lockMovementY:!0,selectable:!1,name:"simple-text"};if(d.isApp())h.width=Math.round(e.acCanvas.canvas.width),h.height=Math.round(e.acCanvas.canvas.height);h=new m.Group([a,b],h);e.acCanvas.canvasObjects[e.acCanvas.id]=h;e.acCanvas.canvas.add(h);k(b,a)}else e.acCanvas.renderAll();d.isApp()&&e.acCanvas.surface.updateTickerOnTab()};k=function(b){var a,h;f(".parentReferenceDiv").length?
a=f(".parentReferenceDiv"):(a=f(document.createElement("div")),f(".ac-image-backdrop").after(f(a)));h=f(".referenceDiv").length?f(".referenceDiv"):f(document.createElement("div"));f(a).addClass("parentReferenceDiv");f(h).addClass("referenceDiv");f(h).css({"font-family":e.acCanvas.surface.font,"font-size":b.getFontSize()});f(h).text(b.text);for(f(a).html(f(h));b.getWidth()>e.acCanvas.canvas.width-e.acCanvas.canvas.width*0.1||f(h).height()>e.acCanvas.canvas.height-e.acCanvas.canvas.height*0.1;)if(a=
b.getFontSize(),a>2)a-=1,b.setFontSize(a-1),f(h).css({"font-size":a+"px"}),b.set({top:-a*(1.3/1.13)*(1-1/1.13)*0.5}),b.setCoords();else break;e.acCanvas.renderAll()};l=function(){var b=e.inputBox.val(),h=parseInt(b.length,10),c=parseInt(e.maxLength,10),j=c;e.textLimitElement.length>0&&(j=c-h,j<0?(e.textLimitElement.html(0),e.inputBox.val(b.substring(0,c))):e.textLimitElement.html(j));e.isValid()?(e.removeErrorClass(),a.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_71376")&&f(e.isRequiredLabel).removeClass("a-color-error"),
e.inputBox.siblings(".pc-input-invalid").removeClass("active"),e.changePreview(b)):(e.isEmpty()&&e.changePreview(b),e.isEmpty()?(e.inputBox.siblings(".pc-input-invalid").removeClass("active"),e.removeErrorClass()):(e.inputBox.siblings(".pc-input-invalid").addClass("active"),e.addErrorClass()),e.changePreview(""))};j=function(){e.inputBox.bind("keyup",function(){l()});e.inputBox.bind("change",function(){l()});e.inputBox.bind("cut",function(){setTimeout(function(){l()},100)});e.inputBox.bind("paste",
function(){setTimeout(function(){l()},100)})};e.init=function(){j()};e.init();return e}})})();(function(){s.when("A","a-popover","ac-utils","ac-base","ready").register("ac-color-picker",function(n,m,g,d){var a=n.$;return function(f,c){var b={};b.elem=f;b.notify=function(b){c.notifySubscribers("colorpicker",b)};b.bindEvents=function(){a(".ac-color-li",b.elem).bind("click",function(){var h=a(this).find("div").attr("data-color"),e=m.get(a(".ac-color-picker-trigger",b.elem).parent());a(".ac-simplecolorpicker",
b.elem).css("background-color",h);b.notify(h);e.hide()})};b.init=function(){a(".ac-is-single-color").length===a(".ac-controls-container").length?(b.notify(a(".ac-is-single-color").attr("data-color")),d.isApp()&&a(".ac-colorpicker").hide()):(b.bindEvents(),b.notify(a(".ac-color-li",b.elem).find("div").attr("data-color")))};b.init();return b}})})();(function(){s.when("A","a-dropdown","ac-utils","ready").register("ac-font-picker",function(n,m){var g=n.$;return function(d,a){var f={};f.elem=d;f.notify=
function(c){a.notifySubscribers("fontpicker",c)};f.init=function(){g(".ac-simple-text-font-picker",d);var c;g(".ac-mobile-app").length>=1&&(c="pcFont"+g("#a",g("#addToCart")).val(),c=m.getSelect(c),c.update({option_prompt:c.getOption(0).info()[0].text}),c.getOptions().size()===1&&(c.update({status:"disabled"}),g(".ac-fontpicker").hide()));g("select",g(".ac-simple-text-font-picker",g("div[data-surface='"+a.id+"']"))).change(function(){var b=g(this).val();a.fontName=g(this).find("option:selected").text();
f.notify(b)});g("select option:first-child",g(".ac-simple-text-font-picker")).click().change()};f.init();return f}})})();(function(){s.when("A","ready").register("ac-constants",function(){return{AssetType:{IMAGE:"image"},StatusCode:{NON_HTML5_BROWSER:"NON-HTML5-BROWSER",NON_IMAGE_TYPE:"NON-IMAGE-TYPE",INVALID_FILE_TYPE:"INVALID_FILE_TYPE",READ_SUCCESS:"READ-SUCCESS",READ_NOT_REQUIRED:"READ_NOT_REQUIRED",INVALIDFILESIZE:"INVALID-FILE-SIZE"},defaults:{thumbnailWidth:80,thumbnailHeight:80,thresholdImageWidth:50,
thresholdImageHeight:50,galWidth:400,galHeight:400},scaleRatio:8,outputSVGDimention:{height:3200,width:3200},textDefaults:{fontFamily:"Arial, Helvetica, sans-serif",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",textAlign:"left",fill:"#FF9900",text:"",angle:0,opacity:1,fontSize:20}}})})();(function(){s.when("A","ac-utils","ac-gallery-base","ac-constants","ac-error-handling","ready").register("ac-image-gallery",function(n,m,g,d,a){var f=n.$,c=function(){};c.prototype=new g;c.prototype.Init=
function(){};f.extend(c.prototype,{getMediaServerUrl:function(){var b="";return"https://images-na.ssl-images-amazon.com/images/S/"+this.bucket+"/"+this.getResourcePath()+"._SL80_"+this.extension},isValidFile:function(b,a){var e=d.StatusCode;if(typeof FileReader!=="undefined")if(/(jpg|jpeg|png)$/i.test(b.name.toLowerCase())){var c=new FileReader;c.onload=function(){var f=new Image,d=b.size/1024;d>7168?a({statusCode:e.INVALIDFILESIZE}):(f.onload=function(){a&&typeof a==="function"&&a({statusCode:e.READ_SUCCESS,
imageHeight:f.height,imageWidth:f.width,imageSize:d})},f.onerror=function(){a&&typeof a==="function"&&a({statusCode:e.INVALID_FILE_TYPE})},f.src=c.result)};c.readAsDataURL(b)}else a&&typeof a==="function"&&a({statusCode:e.INVALID_FILE_TYPE});else a&&typeof a==="function"&&a({statusCode:e.NON_HTML5_BROWSER})},setKey:function(){this.resourcePath=this.getResourcePath();this.extension=this.getFileExtension();this.key=this.resourcePath+this.extension},isValidFileType:function(b){return/(jpg|jpeg|png)$/i.test(b.name.toLowerCase())?
!0:!1},createResourceStub:function(b,a){var e=f(".ac-custom-image-container").clone();e.find("img").attr("id","ac-custom-image-"+a);b.parent().find("#ac-custom-upload-preview-container").append(e)},updateView:function(b,a){a===d.StatusCode.NON_HTML5_BROWSER?this.validateImage(b):this.updateImage(b)},displayWarningIfRequired:function(b){var h=d.defaults.thresholdImageWidth,e=d.defaults.thresholdImageHeight,c=b.imageHeight,f=b.imageWidth,b=c>f?c:f,c=c>f?f:c;a.hide();c<h||b<e?a.show("pc-resolution-warning"):
a.hide()},updateImage:function(b){var h=this.getMediaServerUrl(),e,c;e=f("<div>").addClass("customer-image-container");c=f("<img>").addClass("a-declarative customer-uploaded-image");c.attr({id:"#ac-custom-image-"+b.resourceIndex,src:h,"data-original-url":b.pcImageUrl,"data-original-width":b.imageWidth,"data-original-height":b.imageHeight,"data-preview-url":b.pcImageUrl,"data-action":"customer-uploaded-image","data-token":b.imageToken});b=f("<div>").addClass("swatch-arrow");e.append(c);e.append(b);
c.load(function(){c.trigger("click");f(".ac-uploaded-image").prepend(e);f(".ac-select-uploaded-image").fadeIn()}).error(function(){c.parent(".customer-image-container").remove();a.show("pc-image-mime-type-incorrect");f(".ac-select-uploaded-image").fadeOut();m.imageLoading.hide()})},validateImage:function(b){var h={bucketName:this.getBucket(),fileKey:b.imageToken.split("/")[1]},e=this;m.imageLoading.show();n.ajax("/gp/product/features/callValidateImage.html/ref=dp_pc_val_img",{method:"POST",params:h,
success:function(h){h.result.isValid==="1"?(b.imageWidth=h.result.width,b.imageHeight=h.result.height,e.updateImage(b)):(m.imageLoading.hide(),h.result.errorString&&h.result.errorString.length?a.show(null,{type:"error",message:h.result.errorString}):a.show("pc-upload-error-message"))},error:function(){a.show("pc-upload-error-message");m.imageLoading.hide()}})},populateImageObject:function(b,a){var e={};e.imageUrl=b.attr("data-preview-url");e.isCustomerImage=a;e.element=b;return e},imageSelection:function(){var b=
this.populateImageObject,a=this.displayWarningIfRequired;n.declarative.remove("customer-uploaded-image","click");n.declarative("customer-uploaded-image","click",function(e){var c=b(e.$currentTarget,!0);f(".selected.customer-image-container").removeClass("selected");e.$currentTarget.parent().addClass("selected");n.trigger("addCustomerImage",c);a({imageWidth:e.$currentTarget.attr("data-original-width"),imageHeight:e.$currentTarget.attr("data-original-height")});m.imageLoading.show()})},scaleImage:function(b){var a,
e,c,k;e=parseInt(f(b.element).attr("data-original-width"),10)/d.scaleRatio;parseInt(f(b.element).attr("data-original-height"),10);a=/[.]/.exec(b.imageUrl)?/[^.]+$/.exec(b.imageUrl):t;b=b.imageUrl.split(a[0]);c=a[0];k="";c.toLowerCase()==="png"&&(k="_AL__FMPng_");return b[0]+"_SX"+e+"_"+k+"."+a[0]}});return c})})();(function(){s.when("A","ac-base").register("ac-gallery",function(n,m){var g=n.$,d;d=function(a,f,c){var b=this;this.options=g.extend({thumbnailWidth:80,thumbnailHeight:80,pageSize:100,categoryContainerSelector:"#ac-gallery",
enableLazyLoading:!0,confineToContainerSelector:"body"},a);var h=g(b.options.confineToContainerSelector),e,j=t,d={checkIfCategoryAlreadyLoaded:function(b){var e=!1,a="";g('.theme-image-container[data-theme="'+b+'"]').length>0?(a=g('.theme-image-container[data-theme="'+b+'"]'),e=!0):a=g("<div>").addClass("theme-image-container").attr({"data-theme":b});return{container:a,isEmpty:!e}},checkIfCategoryExistsInObject:function(b){for(var a=e.contentLibraryList.length,h=0,c=!1,h=0;h<a;h+=1)if(e.contentLibraryList[h].title===
b||e.contentLibraryList[h].contentLibraryId===b){c=!0;break}return c},formatResponseObject:function(b){if(b.inlineData!==t)b.contentLibraryList=b.inlineData.contentLibraryList,b.contentLibraryIds=b.inlineData.contentLibraryIds;for(var e=0;e<b.contentLibraryIds.length;e++){var a=b.contentLibraryIds[e];b.contentLibraryIds[e]=d.getFormattedName(a)}for(e=0;e<b.contentLibraryList.length;e++){var h=b.contentLibraryList[e],a=h.title;h.title=d.getFormattedName(a)}b.defaultLibrary=d.getFormattedName(b.defaultLibrary);
return b},formatNewResponseObject:function(b){if(b.contentList.length)b.contentLibraryList=[b],b.contentLibraryIds="/"+b.title;for(var e=0;e<b.contentLibraryIds.length;e++){var a=b.contentLibraryIds[e];b.contentLibraryIds[e]=d.getFormattedName(a)}for(e=0;e<b.contentLibraryList.length;e++){var h=b.contentLibraryList[e],a=h.title;h.title=d.getFormattedName(a)}b.defaultLibrary=d.getFormattedName(b.defaultLibrary);return b},getFormattedName:function(b){if(!b)return null;var e=b;b.charAt(0)==="/"&&(e=
b.substr(1,b.length));return e},getGalleryInputData:function(b){var e={};if(m.getOfferListingID()!==t)e.url="/gp/product/features/getContentLibrary.html",e.data={merchantId:m.getMerchantID(),contentLibraryName:String(b)};return e},getContentLibraryObject:function(b){if(e===j)return j;b=d.getIndexOfCategory(e.contentLibraryList,b);return b===-1?j:e.contentLibraryList[b]},getIndexOfCategory:function(b,e){var a=b.length,h;for(h=0;h<a;h+=1)if(b[h].title.toLowerCase()===e.toLowerCase())return h;return-1},
lazyload:function(){var b=g(".ac-gallery-container"),e=g(".pc-lazyload-error-message");return{success:function(){e.removeClass("active");b.show()},error:function(){b.hide();e.addClass("active");d.loading.hide()}}}(),loading:function(){var b=g(".pc-lazyload-image");return{show:function(){b.addClass("active")},hide:function(){b.removeClass("active")}}}(),populateImageObject:function(b,e){var a={},h=b.data("original-url"),h=h.substr(h.lastIndexOf("."),h.length);a.imageUrl=b.data("preview-url");a.isCustomerImage=
e;a.token=g(".pc-category-name.active").attr("data-themename")+"/"+b.attr("data-token")+h;return a}},l=t,o=function(){var e={categorySelection:function(){n.declarative.remove("category-selection","click");n.declarative("category-selection","click",function(e){var a=e.$currentTarget.attr("data-themename"),h=e.$currentTarget.attr("data-categoryid");p.BuildGallery(a);g(".ac-selected-gallery-name").html(a).attr({"data-contentId":h,title:a});g("a",g(b.options.categoryContainerSelector)).removeClass("active");
e.$currentTarget.addClass("active");g(".vendor-category",g(b.options.categoryContainerSelector)).removeClass("a-active");e.$currentTarget.parent(".vendor-category").addClass("a-active");l!==t&&l.hide()})},imageContainerScroll:function(){if(b.options.enableLazyLoading){var e=g(".ac-gallery-container");e.scroll(function(b){b.preventDefault();if(e.scrollTop()>=g(".ac-gallery-content").height()-e.height()){var b=g("a.active",g(".vendor-categories")).attr("data-themename"),a=d.checkIfCategoryAlreadyLoaded(b);
p.AppendImages(b,a,!1)}})}},imageSelection:function(){n.declarative.remove("ac-gallery-content-image","click");n.declarative("ac-gallery-content-image","click",function(b){var e=d.populateImageObject(b.$currentTarget,!1);e.vendorGalleryFileId=g(b.$target).attr("data-contentid");e.vendorGalleryId=g(".vendor-category .pc-category-name.active").attr("data-categoryid");e.originalURL=g(b.$target).attr("data-original-url");g(".selected.ac-gallery-content-container").removeClass("selected");b.$currentTarget.parent().addClass("selected");
n.trigger("hideWarningMessage");n.trigger("addGalleryImage",e);g("a.active",g(".vendor-category")).attr("data-themename")})},popover:function(){n.off("a:popover:show:vendor-categories");n.on("a:popover:show:vendor-categories",function(b){l=b.popover})}};return{Init:function(){e.categorySelection();e.imageSelection();e.imageContainerScroll();e.popover()}}}(),i=function(){function a(b,e,h){var c=g("<li>"),f=g("<a>");f.attr({"data-themename":b,"data-action":"category-selection","data-categoryId":e?e:
b,title:b});c.addClass("a-tab-heading vendor-category");f.addClass(" a-declarative ");f.attr("href","#").addClass("pc-category-name").html(b);c.append(f);h.append(c)}var c={defaultCategory:function(){g(".pc-category-name").each(function(b,a){if(g(a).attr("data-themename")===e.defaultLibrary||g(a).attr("data-categoyid")===e.defaultLibraryId)return setTimeout(function(){g(a).trigger("click");g("#gallerySpinner").css("display","none")},2E3),!1});g(".ac-selected-gallery-name").text(e.defaultLibrary).attr({"data-categoryid":e.defaultLibraryId,
title:e.defaultLibrary})}};return{Build:function(){var f;d.loading.hide();try{for(var j=e.contentLibraryIds.length,i=g("<div>"),l,p=0;p<e.contentLibraryList.length;p++){e.contentLibraryList[p].contentLibraryId=d.getFormattedName(e.contentLibraryList[p].contentLibraryId);if(e.contentLibraryList[p].contentLibraryId&&e.contentLibraryList[p].contentLibraryId===e.defaultLibrary)e.defaultLibraryId=e.contentLibraryList[p].contentLibraryId,e.defaultLibrary=e.contentLibraryList[p].title;if(!e.contentLibraryList[p].contentLibraryId)e.contentLibraryList[p].contentLibraryId=
e.contentLibraryList[p].title}if(!e.defaultLibraryId)e.defaultLibraryId=e.defaultLibrary;d.checkIfCategoryExistsInObject(e.defaultLibrary)&&a(e.defaultLibrary,e.defaultLibraryId,i);for(l=0;l<j;l+=1)f=e.contentLibraryList[l].title,f!==e.defaultLibrary&&d.checkIfCategoryExistsInObject(e.defaultLibrary)&&a(f,e.contentLibraryList[l].contentLibraryId,i);g(b.options.categoryContainerSelector,h).append(i.html());o.Init();c.defaultCategory()}catch(z){d.lazyload.error()}}}}(),p=function(){function e(a,h,c){var f=
d.getContentLibraryObject(a),a=f.contentList,f=f.contentList.length,j=g("<div>"),i;if(b.options.enableLazyLoading||c){b.options.enableLazyLoading?c?(i=0,c=f<b.options.pageSize?f:b.options.pageSize):(c=h.container.data("endIndex"),i=c+1,c=f<c+b.options.pageSize?f:c+b.options.pageSize):(i=0,c=f);for(;i<c;i+=1){var l=a[i],o=g("<div>").addClass("ac-gallery-content-container"),p=g("<img>"),z=g("<div>").addClass("swatch-arrow");l.status&&l.status!=="Active"||!l.isActive||!l.info||(p.attr({src:l.info.thumbnailURL,
"data-original-url":l.info.url,alt:l.description,"data-original-width":l.width?l.width:2500,"data-original-height":l.height?l.height:3500,"data-preview-url":l.info.previewURL,"data-thumbnail-url":l.info.thumbnailURL,"data-action":"ac-gallery-content-image","data-token":l.title,"data-contentId":l.ContentId?l.ContentId:l.title,isExclusive:1}),p.addClass("ac-gallery-content-image a-declarative"),o.append(p),o.append(z),j.append(o))}a=j.html();h.isEmpty?(g(".ac-gallery-content").append(h.container.append(a)),
h.container.data("endIndex",c),h.container.data("length",f)):(h.container.data("endIndex",c),h.container.append(a))}}return{AppendImages:e,BuildGallery:function(b){var a=d.checkIfCategoryAlreadyLoaded(b);g(".theme-image-container",h).hide();g(".ac-gallery-container").scrollTop(0);a.isEmpty?e(b,a,!0):(g(".ac-gallery-container").scrollTop(0),g('.theme-image-container[data-theme="'+b+'"]',h).show())}}}(),z=function(b,a){var h=d.getGalleryInputData(b),c=g.Deferred();h.data.contentLibraryName="/"+h.data.contentLibraryName.replace("/",
"");g.ajax({type:"GET",url:h.url,dataType:"json",data:h.data,success:function(b){d.lazyload.success();e=g.parseJSON(b.result);if(e===null||e.Status==="Error")d.lazyload.error();else return c.resolve(e,a)},error:function(b){return c.reject(b,a)}});return c.promise()};return{Fetch:function(){var b=[],a={},h=0,j;j=function(){++h;if(h===f.length){for(var j=0;j<b.length;j++)b[j]||(b.splice(j,1),f.splice(j,1));a.inlineData={contentLibraryList:b,contentLibraryIds:f};j=!1;if(c)for(var g=0;g<a.inlineData.contentLibraryList.length;g++)if(a.inlineData.contentLibraryList[g].contentLibraryId===
c||a.inlineData.contentLibraryList[g].title===c){j=!0;break}a.defaultLibrary=j?c:f[0];e=d.formatResponseObject(a);i.Build()}};for(var l=0;l<f.length;l++)g.when(z(f[l],l)).then(function(e,a){b[a]=e.status&&e.status==="Active"&&e.contentList||e.isActive&&e.contentList?e:null;j()},function(e,a){b[a]=null;j()})}}};d.prototype=m;return d})})();(function(){s.when("A","ac-utils","ac-constants","ac-image-gallery","ac-error-handling","ready").register("AssetUploader",function(n,m,g,d,a){var f=n.$,c=function(b){this.assetType=
b.assetType;this.$form=b.$form;this.mediaServer=b.mediaServer;this.index=0};c.prototype.getComponentName=function(){return"AssetUploader"};c.prototype.getUploadTypeObject=function(b){var a;b==="image"&&(a=new d);a.index=this.index++;return a};c.prototype.Init=function(){var b=this.$form,h=this.getUploadTypeObject(this.assetType);b.find("input[type='file']").attr("multiple",!1);h.imageSelection();b.fileupload({autoUpload:!0,url:f(".ac-custom-upload-form").attr("action"),dataType:"json",type:"POST",
add:function(e,c){var d=c.files[0];c.resourceIndex=h.index;h.isValidFile(d,function(e){f.extend(c,e);c.statusCode===g.StatusCode.INVALID_FILE_TYPE?a.show("pc-image-mime-type-incorrect",{timeOut:"6000"}):c.statusCode===g.StatusCode.INVALIDFILESIZE?a.show("pc-image-size-incorrect",{timeOut:"6000"}):(h.createResourceStub(b,c.resourceIndex),n.post("/gp/features/fetch-imageUpload-s3post-parameters.html",{dataType:"json",params:{contentType:"image",csrfToken:f(".ac-custom-upload-form").attr("data-csrf"),
uid:h.getResourcePath(),extension:"."+c.fileInput.val().split(".").pop().toLowerCase(),isDPX:1},success:function(e){c.uploadObject=h;h.setBucket(e.imageToken.split("/")[0]);h.setFileName(d.name);h.setKey(c.resourceIndex);h.setResourcePath(e.key.split(".")[0]);h.getKey();b.attr("action",e.action);f("#key",b).val(e.key);f("#AWSAccessKeyId",b).val(e.AWSAccessKeyId);f("#policy",b).val(e.policy);f("#signature",b).val(e.signature);f("#success_action_status",b).val(e.statusCode);f("#expires",b).val(e.expires);
c.pcImageUrl=e.thumbnailUrl;c.imageName=e.key;c.imageToken=e.imageToken;c.submit()},error:function(){a.show("pc-upload-error-message",{timeOut:"6000"});n.trigger("amazon-custom-log-ref-tag","logS3TextUploadError")}}))})},send:function(){f(".ac-upload-progress").text("0%");m.imageLoading.show()},fail:function(){m.imageLoading.hide();a.show("pc-upload-error-message",{timeOut:"6000"});f(".ac-upload-progress").text("");n.trigger("amazon-custom-log-ref-tag","logS3ImageUploadError")},done:function(b,a){f(".ac-upload-progress").text("100%");
m.imageLoading.hide();a.uploadObject.updateView(a,a.statusCode);f(".ac-upload-progress").text("")},progress:function(b,a){var h=parseInt(a.loaded/a.total*100,10);f(".ac-upload-progress").text(h+"%")}})};return c});s.when("A","AssetUploader","ac-constants","ready").execute(function(n,m){n.declarative("asset-upload","click",function(g){var d;g.$target.data("asset-upload")===t&&(d=new m({$form:g.$target.parentsUntil(".ac-custom-upload-container","form"),assetType:"image",uploadType:g.data["upload-type"],
mediaServer:"https://images-na.ssl-images-amazon.com/images/S/"}),d.Init(),g.$target.data("asset-upload",d))})})})();(function(){s.when("A","ready").register("ac-gallery-base",function(){var n=function(){};n.prototype={generateUUID:function(){function m(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return m()+m()+"-"+m()+"-"+m()+"-"+m()+"-"+m()+m()+m()},getTimeStamp:function(){var m=new Date;return m.getUTCFullYear()+"-"+m.getUTCMonth()+"-"+m.getUTCDate()+"-"+m.getUTCHours()+
"-"+m.getUTCMinutes()},getFileExtension:function(){var m=/^.+\.([^.]+)$/.exec(this.fileName);return m===null?"":"."+m[1].toLowerCase()},getFileNameWithoutExtension:function(){var m=this.fileName.split(".")[0];return m===null?"":m.toLowerCase()},getKey:function(){return this.key},isValidFile:function(){console.log("No Implementation - isValidFile")},setBucket:function(m){this.bucket=m},getBucket:function(){return this.bucket},setFileName:function(m){this.fileName=m},updateView:function(){console.log("No Implementation - ValidateAndUpdate")},
setResourcePath:function(m){this.ResourcePath=m},getResourcePath:function(){return this.ResourcePath}};return n})})();(function(){s.when("A","ac-base","ac-utils","ready").register("ac-error-handling",function(n,m,g){var d=n.$,a,f,c,b,h;a=function(){return d(".ac-error-container")};f=function(){return d(".ac-error-container .a-alert-heading")};c=function(){return d(".ac-error-container .a-alert-content")};b=function(b){var a;a={type:b.type?b.type:"error",message:b.message};if(h.indexOf(b.id)!==-1)a.type=
"warning";return a};h=["pc-error-generic-text","pc-resolution-warning","pc-scale-warning-message","pc-generic-warning-text"];return{show:function(e,h){var d={};e?d=b({id:e,message:g.stringHandler(e)}):(d.type=h.type,d.message=h.message);a().removeClass("a-alert-warning a-alert-error a-alert-success a-alert-info").addClass("a-alert-"+d.type);f().text(d.type.charAt(0).toUpperCase()+d.type.slice(1)+" Message");c().html(d.message);a().addClass("active");h&&h.timeOut&&setTimeout(function(){a().removeClass("active")},
parseInt(h.timeOut,10))},hide:function(){a().removeClass("active")}}})})();(function(){s.when("A","a-dropdown","ac-base","ac-utils","fabric-js","ac-constants","ready").register("ac-text-image",function(n,m,g,d,a,f){var c=n.$;return function(b){var h=this,e,j,k={},g;g=function(){k=c.extend({},f.textDefaults);j&&j.setText("")};h.isInitialized=!1;h.changeFont=function(b){h.updateText({fontFamily:b})};h.toggleStyle=function(b){var e={};switch(b){case "boldoff":e.fontWeight="normal";h.updateText(e);break;
case "boldon":e.fontWeight="bold";h.updateText(e);break;case "italicson":e.fontStyle="italic";h.updateText(e);break;case "italicsoff":e.fontStyle="normal";h.updateText(e);break;case "underlineon":e.textDecoration="underline";h.updateText(e);break;case "underlineoff":e.textDecoration="normal",h.updateText(e)}};h.style=function(){};h.changeAlign=function(b){var e={};switch(b){case "left":e.textAlign="left";h.updateText(e);break;case "center":e.textAlign="center";h.updateText(e);break;case "right":e.textAlign=
"right",h.updateText(e)}};h.changeTextColor=function(b){c(".simplecolorpicker.icon").css("background-color",b);h.updateText({fill:b})};h.editText=function(b){j.setText(b);h.updateText(null)};h.resetControl=function(){c("#pcTextArea").val("");c(".pc-textArea-fontStyle-li").removeClass("button-active");c(".pc-textArea-fontAlign-li").removeClass("button-active");c('.pc-textArea-fontAlign-li[data-align="left"]').addClass("button-active");m.getSelect("fontPicker").setValue("Arial");c(".simplecolorpicker.icon").css({"background-color":c("ul.pc-textArea-fontColor-ul li.pc-textArea-fontColor-li:first-child div").css("background-color")})};
h.updateControl=function(){if(h.isInitialized){h.resetControl();var e=b.getObjects();k.text="";for(var a=0;a<e.length;a++)if(e[a].type==="text")k.text=e[a].text;c("#pcTextArea").val(k.text);k.fontWeight==="bold"&&c('.pc-textArea-fontStyle-li[data-style="bold"]').addClass("button-active");k.textDecoration==="underline"&&c('.pc-textArea-fontStyle-li[data-style="underline"]').addClass("button-active");k.fontStyle==="italic"&&c('.pc-textArea-fontStyle-li[data-style="italics"]').addClass("button-active");
k.textAlign==="right"?(c(".pc-textArea-fontAlign-li").removeClass("button-active"),c('.pc-textArea-fontAlign-li[data-align="right"]').addClass("button-active")):k.textAlign==="center"&&(c(".pc-textArea-fontAlign-li").removeClass("button-active"),c('.pc-textArea-fontAlign-li[data-align="center"]').addClass("button-active"));m.getSelect(c("#fontPicker")).setValue(k.fontFamily);c(".simplecolorpicker.icon").css({"background-color":k.fill})}else h.init(),h.resetControl()};h.select=function(){for(var e=
b.getObjects(),a=b.canvas.size()-1;a>=0;a--)e[a].id&&e[a].id==="text-"+b.id&&b.canvas.setActiveObject(e[a])};h.deSelect=function(){for(var e=b.getObjects(),a=b.canvas.size()-1;a>=0;a--)e[a].id&&e[a].id==="text-"+b.id&&b.canvas.setActiveObject(e[a])};e=function(e){for(var j,d=b.getObjects(),g=b.canvas.size()-1;g>=0;g--)if(d[g].id&&d[g].id===e.id)return null;j=function(e){b.canvas.add(e);e.bringToFront();b.canvas.calcOffset();e.setCoords();b.canvas.setActiveObject(e);b.renderAll()};e=function(e){var a=
{};c.extend(a,e,f.textDefaults);a.id="text-"+b.id;return k=a}(e?e:{});e.fontSize=b.canvas.width/5;e.fill=b.surface.data.FontSettings.colors[0].value;c("#pcTextArea").val("");h.updateText(null);return function(){var h=new a.Text(e.text,{angle:e.angle,opacity:e.opacity,fontFamily:e.fontFamily,fontSize:e.fontSize,fontWeight:e.fontWeight,fontStyle:e.fontStyle,id:e.id,cursorColor:"#ffffff",fill:e.fill,transparentCorners:!1,centeredRotation:!0,centeredScaling:!0,padding:5,originX:"left",originY:"top",selectable:!0,
textAlign:e.textAlign});h.set({left:20,top:b.canvas.height/2-e.fontSize/2});j(h);return h}()};var o=function(e){for(var a=b.getObjects(),h=a.length-1;h>=0;h--)a[h].name&&a[h].name==="galImage"&&b.canvas.remove(a[h]);if(j){j.bringToFront();b.canvas.calcOffset();if(typeof e==="object")j.set(e),c.extend(k,k,e);else if(typeof e==="string")j.setText(e),k.text=e,c("#pcTextArea").val(e);j.setCoords();b.canvas.setActiveObject(j);k.text===""?c(".pc-two-column-layout .ac-delete-button").fadeOut():c(".pc-two-column-layout .ac-delete-button").fadeIn()}b.renderAll()};
h.updateText=function(e){var a,c,f,j,k=!1;a=b.getObjects();c=d.stringHandler("pc-clear-design-msg");f=function(){b.surface.widget.surfaceList.forEach(function(b){b.childCanvasList.forEach(function(b){for(var e=b.getObjects(),a=0;a<e.length;a++)e[a].name&&e[a].name==="galImage"&&b.clear()})});o(e)};j=function(){for(var e=b.canvas.size()-1;e>=0;e--)if(a[e].type==="text"){a[e].remove();break}h.cleared();b.controls.textInput.isControlActive=!1};b.surface.widget.surfaceList.forEach(function(b){b.childCanvasList.forEach(function(b){for(var b=
b.getObjects(),e=0;e<b.length;e++)if(b[e].name&&b[e].name==="galImage"){k=!0;break}})});k?d.showDialog.show(c,f,{ok:"Clear",cancelCallBack:j}):f()};h.cleared=function(){h.resetControl();g();h.isInitialized=!1};h.hasRequiredField=function(){return!1};h.requiredFieldsAreValid=function(){return!0};h.init=function(){h.isInitialized=!0;j=e()}}})})();s.when("A","ready").register("ac-weblab",function(n){var m={getTreatment:function(g){var d=n.state(g);return n.objectIsEmpty(d)?(B.console&&console.log("Weblab "+
g+" not found"),t):d.treatment}};m.isT1=function(g){return"T1"===m.getTreatment(g)};return m})})})(function(){var s=window.AmazonUIPageJS||window.P,B=s._namespace||s.attributeErrors;return B?B("ProductCustomizationSingleTextAssets"):s}(),window);
(function(s,B,t){s.execute(function(){s.when("A","jQuery").register("jq-ui-widget",function(n,m){(function(g){g(m)})(function(g,d){var a=0,f=Array.prototype.slice,c=g.cleanData;g.cleanData=function(b){for(var a=0,e;(e=b[a])!=null;a++)try{g(e).triggerHandler("remove")}catch(f){}c(b)};g.widget=function(b,a,e){var c,f,d,o,i={},p=b.split(".")[0],b=b.split(".")[1];c=p+"-"+b;if(!e)e=a,a=g.Widget;g.expr[":"][c.toLowerCase()]=function(b){return!!g.data(b,c)};g[p]=g[p]||{};f=g[p][b];d=g[p][b]=function(b,e){if(!this._createWidget)return new d(b,
e);arguments.length&&this._createWidget(b,e)};g.extend(d,f,{version:e.version,_proto:g.extend({},e),_childConstructors:[]});o=new a;o.options=g.widget.extend({},o.options);g.each(e,function(b,e){i[b]=g.isFunction(e)?function(){var c=function(){return a.prototype[b].apply(this,arguments)},f=function(e){return a.prototype[b].apply(this,e)};return function(){var b=this._super,a=this._superApply,h;this._super=c;this._superApply=f;h=e.apply(this,arguments);this._super=b;this._superApply=a;return h}}():
e});d.prototype=g.widget.extend(o,{widgetEventPrefix:f?o.widgetEventPrefix||b:b},i,{constructor:d,namespace:p,widgetName:b,widgetFullName:c});f?(g.each(f._childConstructors,function(b,e){var a=e.prototype;g.widget(a.namespace+"."+a.widgetName,d,e._proto)}),delete f._childConstructors):a._childConstructors.push(d);g.widget.bridge(b,d)};g.widget.extend=function(b){for(var a=f.call(arguments,1),e=0,c=a.length,k,l;e<c;e++)for(k in a[e])l=a[e][k],a[e].hasOwnProperty(k)&&l!==d&&(b[k]=g.isPlainObject(l)?
g.isPlainObject(b[k])?g.widget.extend({},b[k],l):g.widget.extend({},l):l);return b};g.widget.bridge=function(b,a){var e=a.prototype.widgetFullName||b;g.fn[b]=function(c){var k=typeof c==="string",l=f.call(arguments,1),o=this,c=!k&&l.length?g.widget.extend.apply(null,[c].concat(l)):c;k?this.each(function(){var a,h=g.data(this,e);if(!h)return g.error("cannot call methods on "+b+" prior to initialization; attempted to call method '"+c+"'");if(!g.isFunction(h[c])||c.charAt(0)==="_")return g.error("no such method '"+
c+"' for "+b+" widget instance");a=h[c].apply(h,l);if(a!==h&&a!==d)return o=a&&a.jquery?o.pushStack(a.get()):a,!1}):this.each(function(){var b=g.data(this,e);b?b.option(c||{})._init():g.data(this,e,new a(c,this))});return o}};g.Widget=function(){};g.Widget._childConstructors=[];g.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(b,c){c=g(c||this.defaultElement||this)[0];this.element=g(c);this.uuid=a++;this.eventNamespace=
"."+this.widgetName+this.uuid;this.options=g.widget.extend({},this.options,this._getCreateOptions(),b);this.bindings=g();this.hoverable=g();this.focusable=g();if(c!==this)g.data(c,this.widgetFullName,this),this._on(!0,this.element,{remove:function(b){b.target===c&&this.destroy()}}),this.document=g(c.style?c.ownerDocument:c.document||c),this.window=g(this.document[0].defaultView||this.document[0].parentWindow);this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:g.noop,
_getCreateEventData:g.noop,_create:g.noop,_init:g.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(g.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},
_destroy:g.noop,widget:function(){return this.element},option:function(b,a){var e=b,c,f,l;if(arguments.length===0)return g.widget.extend({},this.options);if(typeof b==="string")if(e={},c=b.split("."),b=c.shift(),c.length){f=e[b]=g.widget.extend({},this.options[b]);for(l=0;l<c.length-1;l++)f[c[l]]=f[c[l]]||{},f=f[c[l]];b=c.pop();if(arguments.length===1)return f[b]===d?null:f[b];f[b]=a}else{if(arguments.length===1)return this.options[b]===d?null:this.options[b];e[b]=a}this._setOptions(e);return this},
_setOptions:function(b){for(var a in b)this._setOption(a,b[a]);return this},_setOption:function(b,a){this.options[b]=a;b==="disabled"&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!a).attr("aria-disabled",a),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"));return this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(b,a,e){var c,f=this;typeof b!==
"boolean"&&(e=a,a=b,b=!1);e?(a=c=g(a),this.bindings=this.bindings.add(a)):(e=a,a=this.element,c=this.widget());g.each(e,function(e,d){function i(){return!b&&(f.options.disabled===!0||g(this).hasClass("ui-state-disabled"))?void 0:(typeof d==="string"?f[d]:d).apply(f,arguments)}if(typeof d!=="string")i.guid=d.guid=d.guid||i.guid||g.guid++;var p=e.match(/^(\w+)\s*(.*)$/),z=p[1]+f.eventNamespace;(p=p[2])?c.delegate(p,z,i):a.bind(z,i)})},_off:function(b,a){a=(a||"").split(" ").join(this.eventNamespace+
" ")+this.eventNamespace;b.unbind(a).undelegate(a)},_delay:function(b,a){var e=this;return setTimeout(function(){return(typeof b==="string"?e[b]:b).apply(e,arguments)},a||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b);this._on(b,{mouseenter:function(b){g(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){g(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b);this._on(b,{focusin:function(b){g(b.currentTarget).addClass("ui-state-focus")},
focusout:function(b){g(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,a,e){var c,f=this.options[b],e=e||{},a=g.Event(a);a.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase();a.target=this.element[0];if(b=a.originalEvent)for(c in b)c in a||(a[c]=b[c]);this.element.trigger(a,e);return!(g.isFunction(f)&&f.apply(this.element[0],[a].concat(e))===!1||a.isDefaultPrevented())}};g.each({show:"fadeIn",hide:"fadeOut"},function(b,a){g.Widget.prototype["_"+b]=function(e,
c,f){typeof c==="string"&&(c={effect:c});var d,o=!c?b:c===!0||typeof c==="number"?a:c.effect||a,c=c||{};typeof c==="number"&&(c={duration:c});d=!g.isEmptyObject(c);c.complete=f;c.delay&&e.delay(c.delay);if(d&&g.effects&&g.effects.effect[o])e[b](c);else if(o!==b&&e[o])e[o](c.duration,c.easing,f);else e.queue(function(a){g(this)[b]();f&&f.call(e[0]);a()})}})})});s.when("A","jQuery").register("jq-IframeTransport",function(n,m){(function(g){g(m)})(function(g){var d=0;g.ajaxTransport("iframe",function(a){if(a.async){var f=
a.initialIframeSrc||"javascript:false;",c,b,h;return{send:function(e,j){c=g('<form style="display:none;"></form>');c.attr("accept-charset",a.formAcceptCharset);h=/\?/.test(a.url)?"&":"?";if(a.type==="DELETE")a.url=a.url+h+"_method=DELETE",a.type="POST";else if(a.type==="PUT")a.url=a.url+h+"_method=PUT",a.type="POST";else if(a.type==="PATCH")a.url=a.url+h+"_method=PATCH",a.type="POST";d+=1;b=g('<iframe src="'+f+'" name="iframe-transport-'+d+'"></iframe>').bind("load",function(){var e,h=g.isArray(a.paramName)?
a.paramName:[a.paramName];b.unbind("load").bind("load",function(){var e;try{if(e=b.contents(),!e.length||!e[0].firstChild)throw Error();}catch(a){e=t}j(200,"success",{iframe:e});g('<iframe src="'+f+'"></iframe>').appendTo(c);B.setTimeout(function(){c.remove()},0)});c.prop("target",b.prop("name")).prop("action",a.url).prop("method",a.type);a.formData&&g.each(a.formData,function(b,e){e.name!=="file"&&g('<input type="hidden"/>').prop("name",e.name).val(e.value).appendTo(c)});a.fileInput&&a.fileInput.length&&
a.type==="POST"&&(e=a.fileInput.clone(),a.fileInput.after(function(b){return e[b]}),a.paramName&&a.fileInput.each(function(b){g(this).prop("name",h[b]||a.paramName)}),c.append(a.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),a.fileInput.removeAttr("form"));c.submit();e&&e.length&&a.fileInput.each(function(b,a){var c=g(e[b]);g(a).prop("name",c.prop("name")).attr("form",c.attr("form"));c.replaceWith(a)})});c.append(b).appendTo(document.body)},abort:function(){b&&
b.unbind("load").prop("src",f);c&&c.remove()}}}});g.ajaxSetup({converters:{"iframe text":function(a){return a&&g(a[0].body).text()},"iframe json":function(a){return a&&g.parseJSON(g(a[0].body).text())},"iframe html":function(a){return a&&g(a[0].body).html()},"iframe xml":function(a){return(a=a&&a[0])&&g.isXMLDoc(a)?a:g.parseXML(a.XMLDocument&&a.XMLDocument.xml||g(a.body).html())},"iframe script":function(a){return a&&g.globalEval(g(a[0].body).text())}}})})});s.when("A","jQuery","jq-ui-widget").register("jq-fileupload",
function(n,m){(function(g){g(m)})(function(g){g.support.fileInput=!(RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(B.navigator.userAgent)||g('<input type="file">').prop("disabled"));g.support.xhrFileUpload=!(!B.ProgressEvent||!B.FileReader);g.support.xhrFormDataFileUpload=!!B.FormData;g.support.blobSlice=B.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);
g.widget("blueimp.fileupload",{options:{dropZone:g(document),pasteZone:g(document),fileInput:t,replaceFileInput:!0,paramName:t,singleFileUploads:!0,limitMultiFileUploads:t,limitMultiFileUploadSize:t,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:t,forceIframeTransport:!1,redirect:t,redirectParamName:t,postMessage:t,multipart:!0,maxChunkSize:t,uploadedBytes:t,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},
i18n:function(d,a){d=this.messages[d]||d.toString();a&&g.each(a,function(a,c){d=d.replace("{"+a+"}",c)});return d},formData:function(d){return d.serializeArray()},add:function(d,a){if(d.isDefaultPrevented())return!1;(a.autoUpload||a.autoUpload!==!1&&g(this).fileupload("option","autoUpload"))&&a.process().done(function(){a.submit()})},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:g.support.blobSlice&&function(){return(this.slice||
this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime();this.bitrate=this.loaded=0;this.getBitrate=function(d,a,f){var c=d-this.timestamp;if(!this.bitrate||!f||c>f)this.bitrate=(a-this.loaded)*(1E3/c)*8,this.loaded=a,this.timestamp=d;return this.bitrate}},_isXHRUpload:function(d){return!d.forceIframeTransport&&(!d.multipart&&g.support.xhrFileUpload||g.support.xhrFormDataFileUpload)},_getFormData:function(d){var a;if(g.type(d.formData)===
"function")return d.formData(d.form);if(g.isArray(d.formData))return d.formData;return g.type(d.formData)==="object"?(a=[],g.each(d.formData,function(f,c){a.push({name:f,value:c})}),a):[]},_getTotal:function(d){var a=0;g.each(d,function(f,c){a+=c.size||1});return a},_initProgressObject:function(d){var a={loaded:0,total:0,bitrate:0};d._progress?g.extend(d._progress,a):d._progress=a},_initResponseObject:function(d){var a;if(d._response)for(a in d._response)d._response.hasOwnProperty(a)&&delete d._response[a];
else d._response={}},_onProgress:function(d,a){if(d.lengthComputable){var f=Date.now?Date.now():(new Date).getTime(),c;if(!a._time||!a.progressInterval||!(f-a._time<a.progressInterval&&d.loaded!==d.total))a._time=f,c=Math.floor(d.loaded/d.total*(a.chunkSize||a._progress.total))+(a.uploadedBytes||0),this._progress.loaded+=c-a._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(f,this._progress.loaded,a.bitrateInterval),a._progress.loaded=a.loaded=c,a._progress.bitrate=a.bitrate=a._bitrateTimer.getBitrate(f,
c,a.bitrateInterval),this._trigger("progress",g.Event("progress",{delegatedEvent:d}),a),this._trigger("progressall",g.Event("progressall",{delegatedEvent:d}),this._progress)}},_initProgressListener:function(d){var a=this,f=d.xhr?d.xhr():g.ajaxSettings.xhr();if(f.upload)g(f.upload).bind("progress",function(c){var b=c.originalEvent;c.lengthComputable=b.lengthComputable;c.loaded=b.loaded;c.total=b.total;a._onProgress(c,d)}),d.xhr=function(){return f}},_isInstanceOf:function(d,a){return Object.prototype.toString.call(a)===
"[object "+d+"]"},_initXHRData:function(d){var a=this,f,c=d.files[0],b=d.multipart||!g.support.xhrFileUpload,h=g.type(d.paramName)==="array"?d.paramName[0]:d.paramName;d.headers=g.extend({},d.headers);if(d.contentRange)d.headers["Content-Range"]=d.contentRange;if(!b||d.blob||!this._isInstanceOf("File",c))d.headers["Content-Disposition"]='attachment; filename="'+encodeURI(c.name)+'"';if(b){if(g.support.xhrFormDataFileUpload)d.postMessage?(f=this._getFormData(d),d.blob?f.push({name:h,value:d.blob}):
g.each(d.files,function(b,a){f.push({name:g.type(d.paramName)==="array"&&d.paramName[b]||h,value:a})})):(a._isInstanceOf("FormData",d.formData)?f=d.formData:(f=new FormData,g.each(this._getFormData(d),function(b,a){f.append(a.name,a.value)})),d.blob?f.append(h,d.blob,c.name):g.each(d.files,function(b,c){if(a._isInstanceOf("File",c)||a._isInstanceOf("Blob",c))f.append(g.type(d.paramName)==="array"&&d.paramName[b]||h,c,c.uploadName||c.name)})),d.data=f}else d.contentType=c.type||"application/octet-stream",
d.data=d.blob||c;d.blob=null},_initIframeSettings:function(d){var a=g("<a></a>").prop("href",d.url).prop("host");d.dataType="iframe "+(d.dataType||"");d.formData=this._getFormData(d);d.redirect&&a&&a!==location.host&&d.formData.push({name:d.redirectParamName||"redirect",value:d.redirect})},_initDataSettings:function(d){if(this._isXHRUpload(d)){if(this._chunkedUpload(d,!0)||(d.data||this._initXHRData(d),this._initProgressListener(d)),d.postMessage)d.dataType="postmessage "+(d.dataType||"")}else this._initIframeSettings(d)},
_getParamName:function(d){var a=g(d.fileInput),f=d.paramName;f?g.isArray(f)||(f=[f]):(f=[],a.each(function(){for(var a=g(this),b=a.prop("name")||"files[]",a=(a.prop("files")||[1]).length;a;)f.push(b),a-=1}),f.length||(f=[a.prop("name")||"files[]"]));return f},_initFormSettings:function(d){if(!d.form||!d.form.length)if(d.form=g(d.fileInput.prop("form")),!d.form.length)d.form=g(this.options.fileInput.prop("form"));d.paramName=this._getParamName(d);if(!d.url)d.url=d.form.prop("action")||location.href;
d.type=(d.type||g.type(d.form.prop("method"))==="string"&&d.form.prop("method")||"").toUpperCase();if(d.type!=="POST"&&d.type!=="PUT"&&d.type!=="PATCH")d.type="POST";if(!d.formAcceptCharset)d.formAcceptCharset=d.form.attr("accept-charset")},_getAJAXSettings:function(d){d=g.extend({},this.options,d);this._initFormSettings(d);this._initDataSettings(d);return d},_getDeferredState:function(d){return d.state?d.state():d.isResolved()?"resolved":d.isRejected()?"rejected":"pending"},_enhancePromise:function(d){d.success=
d.done;d.error=d.fail;d.complete=d.always;return d},_getXHRPromise:function(d,a,f){var c=g.Deferred(),b=c.promise(),a=a||this.options.context||b;d===!0?c.resolveWith(a,f):d===!1&&c.rejectWith(a,f);b.abort=c.promise;return this._enhancePromise(b)},_addConvenienceMethods:function(d,a){var f=this,c=function(b){return g.Deferred().resolveWith(f,b).promise()};a.process=function(b,h){if(b||h)a._processQueue=this._processQueue=(this._processQueue||c([this])).pipe(function(){return a.errorThrown?g.Deferred().rejectWith(f,
[a]).promise():c(arguments)}).pipe(b,h);return this._processQueue||c([this])};a.submit=function(){if(this.state()!=="pending")a.jqXHR=this.jqXHR=f._trigger("submit",g.Event("submit",{delegatedEvent:d}),this)!==!1&&f._onSend(d,this);return this.jqXHR||f._getXHRPromise()};a.abort=function(){if(this.jqXHR)return this.jqXHR.abort();this.errorThrown="abort";f._trigger("fail",null,this);return f._getXHRPromise(!1)};a.state=function(){if(this.jqXHR)return f._getDeferredState(this.jqXHR);if(this._processQueue)return f._getDeferredState(this._processQueue)};
a.processing=function(){return!this.jqXHR&&this._processQueue&&f._getDeferredState(this._processQueue)==="pending"};a.progress=function(){return this._progress};a.response=function(){return this._response}},_getUploadedBytes:function(d){var b;var a;return(b=(a=(d=d.getResponseHeader("Range"))&&d.split("-"),d=a)&&d.length>1&&parseInt(d[1],10),d=b)&&d+1},_chunkedUpload:function(d,a){d.uploadedBytes=d.uploadedBytes||0;var f=this,c=d.files[0],b=c.size,h=d.uploadedBytes,e=d.maxChunkSize||b,j=this._blobSlice,
k=g.Deferred(),l=k.promise(),o,i;if(!this._isXHRUpload(d)||!j||!(h||e<b)||d.data)return!1;if(a)return!0;if(h>=b)return c.error=d.i18n("uploadedBytes"),this._getXHRPromise(!1,d.context,[null,"error",c.error]);i=function(){var a=g.extend({},d),l=a._progress.loaded;a.blob=j.call(c,h,h+e,c.type);a.chunkSize=a.blob.size;a.contentRange="bytes "+h+"-"+(h+a.chunkSize-1)+"/"+b;f._initXHRData(a);f._initProgressListener(a);o=(f._trigger("chunksend",null,a)!==!1&&g.ajax(a)||f._getXHRPromise(!1,a.context)).done(function(e,
c,j){h=f._getUploadedBytes(j)||h+a.chunkSize;l+a.chunkSize-a._progress.loaded&&f._onProgress(g.Event("progress",{lengthComputable:!0,loaded:h-a.uploadedBytes,total:h-a.uploadedBytes}),a);d.uploadedBytes=a.uploadedBytes=h;a.result=e;a.textStatus=c;a.jqXHR=j;f._trigger("chunkdone",null,a);f._trigger("chunkalways",null,a);h<b?i():k.resolveWith(a.context,[e,c,j])}).fail(function(b,e,c){a.jqXHR=b;a.textStatus=e;a.errorThrown=c;f._trigger("chunkfail",null,a);f._trigger("chunkalways",null,a);k.rejectWith(a.context,
[b,e,c])})};this._enhancePromise(l);l.abort=function(){return o.abort()};i();return l},_beforeSend:function(d,a){if(this._active===0)this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0;this._initResponseObject(a);this._initProgressObject(a);a._progress.loaded=a.loaded=a.uploadedBytes||0;a._progress.total=a.total=this._getTotal(a.files)||1;a._progress.bitrate=a.bitrate=0;this._active+=1;this._progress.loaded+=a.loaded;
this._progress.total+=a.total},_onDone:function(d,a,f,c){var b=c._progress.total,h=c._response;c._progress.loaded<b&&this._onProgress(g.Event("progress",{lengthComputable:!0,loaded:b,total:b}),c);h.result=c.result=d;h.textStatus=c.textStatus=a;h.jqXHR=c.jqXHR=f;this._trigger("done",null,c)},_onFail:function(d,a,f,c){var b=c._response;c.recalculateProgress&&(this._progress.loaded-=c._progress.loaded,this._progress.total-=c._progress.total);b.jqXHR=c.jqXHR=d;b.textStatus=c.textStatus=a;b.errorThrown=
c.errorThrown=f;this._trigger("fail",null,c)},_onAlways:function(d,a,f,c){this._trigger("always",null,c)},_onSend:function(d,a){a.submit||this._addConvenienceMethods(d,a);var f=this,c,b,h,e,j=f._getAJAXSettings(a),k=function(){f._sending+=1;j._bitrateTimer=new f._BitrateTimer;return c=c||((b||f._trigger("send",g.Event("send",{delegatedEvent:d}),j)===!1)&&f._getXHRPromise(!1,j.context,b)||f._chunkedUpload(j)||g.ajax(j)).done(function(b,e,a){f._onDone(b,e,a,j)}).fail(function(b,e,a){f._onFail(b,e,a,
j)}).always(function(b,e,a){f._onAlways(b,e,a,j);f._sending-=1;f._active-=1;if(j.limitConcurrentUploads&&j.limitConcurrentUploads>f._sending)for(b=f._slots.shift();b;){if(f._getDeferredState(b)==="pending"){b.resolve();break}b=f._slots.shift()}f._active===0&&f._trigger("stop")})};this._beforeSend(d,j);return this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(h=g.Deferred(),this._slots.push(h),
e=h.pipe(k)):e=this._sequence=this._sequence.pipe(k,k),e.abort=function(){b=[t,"abort","abort"];return!c?(h&&h.rejectWith(j.context,b),k()):c.abort()},this._enhancePromise(e)):k()},_onAdd:function(d,a){var f=this,c=!0,b=g.extend({},this.options,a),h=a.files,e=h.length,j=b.limitMultiFileUploads,k=b.limitMultiFileUploadSize,l=b.limitMultiFileUploadSizeOverhead,o=0,i=this._getParamName(b),p,z,x=0;if(k&&(!e||h[0].size===t))k=t;if(!b.singleFileUploads&&!j&&!k||!this._isXHRUpload(b))z=[h],p=[i];else if(!b.singleFileUploads&&
!k&&j){z=[];p=[];for(b=0;b<e;b+=j)z.push(h.slice(b,b+j)),o=i.slice(b,b+j),o.length||(o=i),p.push(o)}else if(!b.singleFileUploads&&k){z=[];p=[];for(b=0;b<e;b+=1)if(o+=h[b].size+l,b+1===e||o+h[b+1].size+l>k||j&&b+1-x>=j)z.push(h.slice(x,b+1)),o=i.slice(x,b+1),o.length||(o=i),p.push(o),x=b+1,o=0}else p=i;a.originalFiles=h;g.each(z||h,function(b,e){var h=g.extend({},a);h.files=z?e:[e];h.paramName=p[b];f._initResponseObject(h);f._initProgressObject(h);f._addConvenienceMethods(d,h);return c=f._trigger("add",
g.Event("add",{delegatedEvent:d}),h)});return c},_replaceFileInput:function(d){var a=d.clone(!0);g("<form></form>").append(a)[0].reset();d.after(a).detach();g.cleanData(d.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(f,c){return c===d[0]?a[0]:c});if(d[0]===this.element[0])this.element=a},_handleFileTreeEntry:function(d,a){var f=this,c=g.Deferred(),b=function(b){if(b&&!b.entry)b.entry=d;c.resolve([b])},h,a=a||"";d.isFile?d._file?(d._file.relativePath=a,c.resolve(d._file)):
d.file(function(b){b.relativePath=a;c.resolve(b)},b):d.isDirectory?(h=d.createReader(),h.readEntries(function(e){f._handleFileTreeEntries(e,a+d.name+"/").done(function(b){c.resolve(b)}).fail(b)},b)):c.resolve([]);return c.promise()},_handleFileTreeEntries:function(d,a){var f=this;return g.when.apply(g,g.map(d,function(c){return f._handleFileTreeEntry(c,a)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(d){var d=d||{},a=d.items;return a&&a.length&&
(a[0].webkitGetAsEntry||a[0].getAsEntry)?this._handleFileTreeEntries(g.map(a,function(a){var c;if(a.webkitGetAsEntry){if(c=a.webkitGetAsEntry())c._file=a.getAsFile();return c}return a.getAsEntry()})):g.Deferred().resolve(g.makeArray(d.files)).promise()},_getSingleFileInputFiles:function(d){var d=g(d),a=d.prop("webkitEntries")||d.prop("entries");if(a&&a.length)return this._handleFileTreeEntries(a);a=g.makeArray(d.prop("files"));if(a.length)a[0].name===t&&a[0].fileName&&g.each(a,function(a,c){c.name=
c.fileName;c.size=c.fileSize});else{d=d.prop("value");if(!d)return g.Deferred().resolve([]).promise();a=[{name:d.replace(/^.*\\/,"")}]}return g.Deferred().resolve(a).promise()},_getFileInputFiles:function(d){return!(d instanceof g)||d.length===1?this._getSingleFileInputFiles(d):g.when.apply(g,g.map(d,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_onChange:function(d){var a=this,f={fileInput:g(d.target),form:g(d.target.form)};this._getFileInputFiles(f.fileInput).always(function(c){f.files=
c;a.options.replaceFileInput&&a._replaceFileInput(f.fileInput);a._trigger("change",g.Event("change",{delegatedEvent:d}),f)!==!1&&a._onAdd(d,f)})},_onPaste:function(d){var a=d.originalEvent&&d.originalEvent.clipboardData&&d.originalEvent.clipboardData.items,f={files:[]};a&&a.length&&(g.each(a,function(a,b){var h=b.getAsFile&&b.getAsFile();h&&f.files.push(h)}),this._trigger("paste",g.Event("paste",{delegatedEvent:d}),f)!==!1&&this._onAdd(d,f))},_onDrop:function(d){d.dataTransfer=d.originalEvent&&d.originalEvent.dataTransfer;
var a=this,f=d.dataTransfer,c={};f&&f.files&&f.files.length&&(d.preventDefault(),this._getDroppedFiles(f).always(function(b){c.files=b;a._trigger("drop",g.Event("drop",{delegatedEvent:d}),c)!==!1&&a._onAdd(d,c)}))},_onDragOver:function(d){d.dataTransfer=d.originalEvent&&d.originalEvent.dataTransfer;var a=d.dataTransfer;if(a&&g.inArray("Files",a.types)!==-1&&this._trigger("dragover",g.Event("dragover",{delegatedEvent:d}))!==!1)d.preventDefault(),a.dropEffect="copy"},_initEventHandlers:function(){this._isXHRUpload(this.options)&&
(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste}));g.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop");this._off(this.options.pasteZone,"paste");this._off(this.options.fileInput,"change")},_setOption:function(d,a){var f=g.inArray(d,this._specialOptions)!==-1;f&&this._destroyEventHandlers();this._super(d,a);
f&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var d=this.options;if(d.fileInput===t)d.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]');else if(!(d.fileInput instanceof g))d.fileInput=g(d.fileInput);if(!(d.dropZone instanceof g))d.dropZone=g(d.dropZone);if(!(d.pasteZone instanceof g))d.pasteZone=g(d.pasteZone)},_getRegExp:function(d){var d=d.split("/"),a=d.pop();d.shift();return RegExp(d.join("/"),a)},_isRegExpOption:function(d,
a){return d!=="url"&&g.type(a)==="string"&&/^\/.*\/[igm]{0,3}$/.test(a)},_initDataAttributes:function(){var d=this,a=this.options,f=g(this.element[0].cloneNode(!1));g.each(f.data(),function(c,b){var h="data-"+c.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();f.attr(h)&&(d._isRegExpOption(c,b)&&(b=d._getRegExp(b)),a[c]=b)})},_create:function(){this._initDataAttributes();this._initSpecialOptions();this._slots=[];this._sequence=this._getXHRPromise(!0);this._sending=this._active=0;this._initProgressObject(this);
this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(d){var a=this;if(d&&!this.options.disabled)d.fileInput&&!d.files?this._getFileInputFiles(d.fileInput).always(function(f){d.files=f;a._onAdd(null,d)}):(d.files=g.makeArray(d.files),this._onAdd(null,d))},send:function(d){if(d&&!this.options.disabled){if(d.fileInput&&!d.files){var a=this,f=g.Deferred(),c=f.promise(),b,h;c.abort=function(){h=!0;if(b)return b.abort();f.reject(null,
"abort","abort");return c};this._getFileInputFiles(d.fileInput).always(function(e){if(!h)e.length?(d.files=e,b=a._onSend(null,d).then(function(b,e,a){f.resolve(b,e,a)},function(b,e,a){f.reject(b,e,a)})):f.reject()});return this._enhancePromise(c)}d.files=g.makeArray(d.files);if(d.files.length)return this._onSend(null,d)}return this._getXHRPromise(!1,d&&d.context)}})})})})})(function(){var s=window.AmazonUIPageJS||window.P,B=s._namespace||s.attributeErrors;return B?B("ProductCustomizationFileUploadAssets"):
s}(),window);
(function(s,B,t){s.execute(function(){s.when("A").register("fabric-js",function(n){var m=m||{};if(!n.capabilities.canvas)return{};var g=g||{version:"1.4.13"};if(typeof m!=="undefined")m.fabric=g;typeof document!=="undefined"&&typeof B!=="undefined"?(g.document=document,g.window=B):(g.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),g.window=g.document.createWindow?g.document.createWindow():g.document.parentWindow);g.isTouchSupported="ontouchstart"in g.document.documentElement;
g.isLikelyNode=typeof Buffer!=="undefined"&&typeof B==="undefined";g.SHARED_ATTRIBUTES="display,transform,fill,fill-opacity,fill-rule,opacity,stroke,stroke-dasharray,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width".split(",");g.DPI=96;g.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)";(function(){function d(b,a){if(this.__eventListeners[b])a?g.util.removeFromArray(this.__eventListeners[b],a):this.__eventListeners[b].length=0}function a(b,a){if(!this.__eventListeners)this.__eventListeners=
{};if(arguments.length===1)for(var e in b)this.on(e,b[e]);else this.__eventListeners[b]||(this.__eventListeners[b]=[]),this.__eventListeners[b].push(a);return this}function f(b,a){if(this.__eventListeners){if(arguments.length===0)this.__eventListeners={};else if(arguments.length===1&&typeof arguments[0]==="object")for(var e in b)d.call(this,e,b[e]);else d.call(this,b,a);return this}}function c(b,a){if(this.__eventListeners){var e=this.__eventListeners[b];if(e){for(var c=0,f=e.length;c<f;c++)e[c].call(this,
a||{});return this}}}g.Observable={observe:a,stopObserving:f,fire:c,on:a,off:f,trigger:c}})();g.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var d=0,a=arguments.length;d<a;d++)this._onObjectAdded(arguments[d]);this.renderOnAddRemove&&this.renderAll();return this},insertAt:function(d,a,f){var c=this.getObjects();f?c[a]=d:c.splice(a,0,d);this._onObjectAdded(d);this.renderOnAddRemove&&this.renderAll();return this},remove:function(){for(var d=this.getObjects(),a,f=
0,c=arguments.length;f<c;f++)a=d.indexOf(arguments[f]),a!==-1&&(d.splice(a,1),this._onObjectRemoved(arguments[f]));this.renderOnAddRemove&&this.renderAll();return this},forEachObject:function(d,a){for(var f=this.getObjects(),c=f.length;c--;)d.call(a,f[c],c,f);return this},getObjects:function(d){return typeof d==="undefined"?this._objects:this._objects.filter(function(a){return a.type===d})},item:function(d){return this.getObjects()[d]},isEmpty:function(){return this.getObjects().length===0},size:function(){return this.getObjects().length},
contains:function(d){return this.getObjects().indexOf(d)>-1},complexity:function(){return this.getObjects().reduce(function(d,a){d+=a.complexity?a.complexity():0;return d},0)}};(function(d){var a=Math.sqrt,f=Math.atan2,c=Math.PI/180;g.util={removeFromArray:function(b,a){var e=b.indexOf(a);e!==-1&&b.splice(e,1);return b},getRandomInt:function(b,a){return Math.floor(Math.random()*(a-b+1))+b},degreesToRadians:function(b){return b*c},radiansToDegrees:function(b){return b/c},rotatePoint:function(b,a,e){var c=
Math.sin(e),e=Math.cos(e);b.subtractEquals(a);return(new g.Point(b.x*e-b.y*c,b.x*c+b.y*e)).addEquals(a)},transformPoint:function(b,a,e){return e?new g.Point(a[0]*b.x+a[1]*b.y,a[2]*b.x+a[3]*b.y):new g.Point(a[0]*b.x+a[1]*b.y+a[4],a[2]*b.x+a[3]*b.y+a[5])},invertTransform:function(b){var a=b.slice(),a=1/(b[0]*b[3]-b[1]*b[2]),a=[a*b[3],-a*b[1],-a*b[2],a*b[0],0,0],b=g.util.transformPoint({x:b[4],y:b[5]},a);a[4]=-b.x;a[5]=-b.y;return a},toFixed:function(b,a){return parseFloat(Number(b).toFixed(a))},parseUnit:function(b,
a){var e=/\D{0,2}$/.exec(b),c=parseFloat(b);if(!a)a=g.Text.DEFAULT_SVG_FONT_SIZE;switch(e[0]){case "mm":return c*g.DPI/25.4;case "cm":return c*g.DPI/2.54;case "in":return c*g.DPI;case "pt":return c*g.DPI/72;case "pc":return c*g.DPI/72*12;case "em":return c*a;default:return c}},falseFunction:function(){return!1},getKlass:function(b,a){b=g.util.string.camelize(b.charAt(0).toUpperCase()+b.slice(1));return g.util.resolveNamespace(a)[b]},resolveNamespace:function(b){if(!b)return g;for(var b=b.split("."),
a=b.length,e=d||g.window,c=0;c<a;++c)e=e[b[c]];return e},loadImage:function(b,a,e,c){if(b){var f=g.util.createImage();f.onload=function(){var h;a&&a.call(e,f);h=f.onload=f.onerror=null,f=h};f.onerror=function(){var h;g.log("Error loading "+f.src);a&&a.call(e,null,!0);h=f.onload=f.onerror=null,f=h};if(b.indexOf("data")!==0&&typeof c!=="undefined")f.crossOrigin=c;f.src=b}else a&&a.call(e,b)},enlivenObjects:function(b,a,e,c){function f(){++o===i&&a&&a(d)}var b=b||[],d=[],o=0,i=b.length;i?b.forEach(function(b,
a){if(!b||!b.type)f();else{var h=g.util.getKlass(b.type,e);h.async?h.fromObject(b,function(e,h){h||(d[a]=e,c&&c(b,d[a]));f()}):(d[a]=h.fromObject(b),c&&c(b,d[a]),f())}}):a&&a(d)},groupSVGElements:function(b,a,e){b=new g.PathGroup(b,a);typeof e!=="undefined"&&b.setSourcePath(e);return b},populateWithProperties:function(b,a,e){if(e&&Object.prototype.toString.call(e)==="[object Array]")for(var c=0,f=e.length;c<f;c++)e[c]in b&&(a[e[c]]=b[e[c]])},drawDashedLine:function(b,c,e,j,d,g){j-=c;var o=d-e,d=a(j*
j+o*o),j=f(o,j),o=g.length,i=0,p=!0;b.save();b.translate(c,e);b.moveTo(0,0);b.rotate(j);for(c=0;d>c;)c+=g[i++%o],c>d&&(c=d),b[p?"lineTo":"moveTo"](c,0),p=!p;b.restore()},createCanvasElement:function(b){b||(b=g.document.createElement("canvas"));!b.getContext&&typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(b);return b},createImage:function(){return g.isLikelyNode?new (require("canvas").Image):g.document.createElement("img")},createAccessors:function(b){for(var b=b.prototype,
a=b.stateProperties.length;a--;){var e=b.stateProperties[a],c=e.charAt(0).toUpperCase()+e.slice(1),f="set"+c,c="get"+c;b[c]||(b[c]=new Function('return this.get("'+e+'")'));b[f]||(b[f]=new Function("value",'return this.set("'+e+'", value)'))}},clipContext:function(b,a){a.save();a.beginPath();b.clipTo(a);a.clip()},multiplyTransformMatrices:function(b,a){for(var e=[[b[0],b[2],b[4]],[b[1],b[3],b[5]],[0,0,1]],c=[[a[0],a[2],a[4]],[a[1],a[3],a[5]],[0,0,1]],f=[],d=0;d<3;d++){f[d]=[];for(var g=0;g<3;g++){for(var i=
0,p=0;p<3;p++)i+=e[d][p]*c[p][g];f[d][g]=i}}return[f[0][0],f[1][0],f[0][1],f[1][1],f[0][2],f[1][2]]},getFunctionBody:function(b){return(String(b).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(b,a,e,c){c>0&&(a>c?a-=c:a=0,e>c?e-=c:e=0);for(var f=!0,b=b.getImageData(a,e,c*2||1,c*2||1),a=3,e=b.data.length;a<e;a+=4)if(f=b.data[a]<=0,f===!1)break;return f}}})(typeof m!=="undefined"?m:this);(function(){function d(e,c,h,d,g,z,x){var C=j.call(arguments);if(b[C])return b[C];var E=Math.PI,
m=x*E/180,n=Math.sin(m),m=Math.cos(m),A=0,v=0,h=Math.abs(h),d=Math.abs(d),D=-m*e*0.5-n*c*0.5,r=-m*c*0.5+n*e*0.5,q=h*h,u=d*d,F=r*r,y=D*D,G=q*u-q*F-u*y,H=0;G<0?(q=Math.sqrt(1-G/(q*u)),h*=q,d*=q):H=(g===z?-1:1)*Math.sqrt(G/(q*F+u*y));F=H*h*r/d;y=-H*d*D/h;H=m*F-n*y+e*0.5;q=n*F+m*y+c*0.5;u=f(1,0,(D-F)/h,(r-y)/d);r=f((D-F)/h,(r-y)/d,(-D-F)/h,(-r-y)/d);z===0&&r>0?r-=2*E:z===1&&r<0&&(r+=2*E);E=Math.ceil(Math.abs(r/E*2));D=[];r/=E;F=8/3*Math.sin(r/4)*Math.sin(r/4)/Math.sin(r/2);y=u+r;for(G=0;G<E;G++)D[G]=
a(u,y,m,n,h,d,H,q,F,A,v),A=D[G][4],v=D[G][5],u=y,y+=r;return b[C]=D}function a(b,e,a,c,f,d,g,C,E,m,n){var A=j.call(arguments);if(h[A])return h[A];var v=Math.cos(b),D=Math.sin(b),r=Math.cos(e),q=Math.sin(e),u=a*f*r-c*d*q+g,F=c*f*r+a*d*q+C;h[A]=[m+E*(-a*f*D-c*d*v),n+E*(-c*f*D+a*d*v),u+E*(a*f*q+c*d*r),F+E*(c*f*q-a*d*r),u,F];return h[A]}function f(b,e,a,c){b=Math.atan2(e,b);a=Math.atan2(c,a);return a>=b?a-b:2*Math.PI-(b-a)}function c(b,a,c,f,h,d,g,C){var m=j.call(arguments);if(e[m])return e[m];var n=
Math.sqrt,w=Math.min,A=Math.max,v=Math.abs,D=[],r=[[],[]],q,u,F,y,G;u=6*b-12*c+6*h;q=-3*b+9*c-9*h+3*g;F=3*c-3*b;for(var H=0;H<2;++H)H>0&&(u=6*a-12*f+6*d,q=-3*a+9*f-9*d+3*C,F=3*f-3*a),v(q)<1.0E-12?v(u)<1.0E-12||(y=-F/u,0<y&&y<1&&D.push(y)):(y=u*u-4*F*q,y<0||(G=n(y),y=(-u+G)/(2*q),0<y&&y<1&&D.push(y),y=(-u-G)/(2*q),0<y&&y<1&&D.push(y)));for(v=n=D.length;n--;)y=D[n],u=1-y,q=u*u*u*b+3*u*u*y*c+3*u*y*y*h+y*y*y*g,r[0][n]=q,q=u*u*u*a+3*u*u*y*f+3*u*y*y*d+y*y*y*C,r[1][n]=q;r[0][v]=b;r[1][v]=a;r[0][v+1]=g;r[1][v+
1]=C;w=[{x:w.apply(null,r[0]),y:w.apply(null,r[1])},{x:A.apply(null,r[0]),y:A.apply(null,r[1])}];return e[m]=w}var b={},h={},e={},j=Array.prototype.join;g.util.drawArc=function(b,e,a,c){for(var f=[[],[],[],[]],c=d(c[5]-e,c[6]-a,c[0],c[1],c[3],c[4],c[2]),h=0,j=c.length;h<j;h++)f[h][0]=c[h][0]+e,f[h][1]=c[h][1]+a,f[h][2]=c[h][2]+e,f[h][3]=c[h][3]+a,f[h][4]=c[h][4]+e,f[h][5]=c[h][5]+a,b.bezierCurveTo.apply(b,f[h])};g.util.getBoundsOfArc=function(b,e,a,f,h,j,g,C,m){for(var n=0,w=0,A=[],v=[],a=d(C-b,m-
e,a,f,j,g,h),f=0,h=a.length;f<h;f++)A=c(n,w,a[f][0],a[f][1],a[f][2],a[f][3],a[f][4],a[f][5]),A[0].x+=b,A[0].y+=e,A[1].x+=b,A[1].y+=e,v.push(A[0]),v.push(A[1]),n=a[f][4],w=a[f][5];return v};g.util.getBoundsOfCurve=c})();(function(){function d(a,c,b){if(a&&a.length!==0){var h=a.length-1,e=c?a[h][c]:a[h];if(c)for(;h--;)b(a[h][c],e)&&(e=a[h][c]);else for(;h--;)b(a[h],e)&&(e=a[h]);return e}}var a=Array.prototype.slice;if(!Array.prototype.indexOf)Array.prototype.indexOf=function(a){if(this===void 0||this===
null)throw new TypeError;var c=Object(this),b=c.length>>>0;if(b===0)return-1;var h=0;arguments.length>0&&(h=Number(arguments[1]),h!==h?h=0:h!==0&&h!==Number.POSITIVE_INFINITY&&h!==Number.NEGATIVE_INFINITY&&(h=(h>0||-1)*Math.floor(Math.abs(h))));if(h>=b)return-1;for(h=h>=0?h:Math.max(b-Math.abs(h),0);h<b;h++)if(h in c&&c[h]===a)return h;return-1};if(!Array.prototype.forEach)Array.prototype.forEach=function(a,c){for(var b=0,h=this.length>>>0;b<h;b++)b in this&&a.call(c,this[b],b,this)};if(!Array.prototype.map)Array.prototype.map=
function(a,c){for(var b=[],h=0,e=this.length>>>0;h<e;h++)h in this&&(b[h]=a.call(c,this[h],h,this));return b};if(!Array.prototype.every)Array.prototype.every=function(a,c){for(var b=0,h=this.length>>>0;b<h;b++)if(b in this&&!a.call(c,this[b],b,this))return!1;return!0};if(!Array.prototype.some)Array.prototype.some=function(a,c){for(var b=0,h=this.length>>>0;b<h;b++)if(b in this&&a.call(c,this[b],b,this))return!0;return!1};if(!Array.prototype.filter)Array.prototype.filter=function(a,c){for(var b=[],
h,e=0,j=this.length>>>0;e<j;e++)e in this&&(h=this[e],a.call(c,h,e,this)&&b.push(h));return b};if(!Array.prototype.reduce)Array.prototype.reduce=function(a){var c=this.length>>>0,b=0,h;if(arguments.length>1)h=arguments[1];else{do{if(b in this){h=this[b++];break}if(++b>=c)throw new TypeError;}while(1)}for(;b<c;b++)b in this&&(h=a.call(null,h,this[b],b,this));return h};g.util.array={invoke:function(f,c){for(var b=a.call(arguments,2),h=[],e=0,j=f.length;e<j;e++)h[e]=b.length?f[e][c].apply(f[e],b):f[e][c].call(f[e]);
return h},min:function(a,c){return d(a,c,function(b,a){return b<a})},max:function(a,c){return d(a,c,function(b,a){return b>=a})}}})();(function(){function d(a,f){for(var c in f)a[c]=f[c];return a}g.util.object={extend:d,clone:function(a){return d({},a)}}})();(function(){if(!String.prototype.trim)String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")};g.util.string={camelize:function(d){return d.replace(/-+(.)?/g,function(a,f){return f?f.toUpperCase():""})},
capitalize:function(d,a){return d.charAt(0).toUpperCase()+(a?d.slice(1):d.slice(1).toLowerCase())},escapeXml:function(d){return d.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}})();(function(){var d=Array.prototype.slice,a=Function.prototype.apply,f=function(){};if(!Function.prototype.bind)Function.prototype.bind=function(c){var b=this,h=d.call(arguments,1),e;e=h.length?function(){return a.call(b,this instanceof f?this:c,h.concat(d.call(arguments)))}:
function(){return a.call(b,this instanceof f?this:c,arguments)};f.prototype=this.prototype;e.prototype=new f;return e}})();(function(){function d(){}function a(b){var a=this.constructor.superclass.prototype[b];return arguments.length>1?a.apply(this,f.call(arguments,1)):a.call(this)}var f=Array.prototype.slice,c=function(){},b=function(){for(var b in{toString:1})if(b==="toString")return!1;return!0}(),h=function(e,a,c){for(var f in a)if(e.prototype[f]=f in e.prototype&&typeof e.prototype[f]==="function"&&
(a[f]+"").indexOf("callSuper")>-1?function(b){return function(){var e=this.constructor.superclass;this.constructor.superclass=c;var f=a[b].apply(this,arguments);this.constructor.superclass=e;if(b!=="initialize")return f}}(f):a[f],b){if(a.toString!==Object.prototype.toString)e.prototype.toString=a.toString;if(a.valueOf!==Object.prototype.valueOf)e.prototype.valueOf=a.valueOf}};g.util.createClass=function(){function b(){this.initialize.apply(this,arguments)}var j=null,g=f.call(arguments,0);typeof g[0]===
"function"&&(j=g.shift());b.superclass=j;b.subclasses=[];if(j)d.prototype=j.prototype,b.prototype=new d,j.subclasses.push(b);for(var l=0,o=g.length;l<o;l++)h(b,g[l],j);if(!b.prototype.initialize)b.prototype.initialize=c;b.prototype.constructor=b;b.prototype.callSuper=a;return b}})();(function(){function d(b){var e=Array.prototype.slice.call(arguments,1),a,c,f=e.length;for(c=0;c<f;c++)if(a=typeof b[e[c]],!/^(?:function|object|unknown)$/.test(a))return!1;return!0}function a(e,a){return function(c){a.call(b(e),
c||g.window.event)}}function f(b,e){return function(a){if(o[b]&&o[b][e])for(var c=o[b][e],f=0,h=c.length;f<h;f++)c[f].call(this,a||g.window.event)}}function c(b,e,a){var c=b.type==="touchend"?"changedTouches":"touches";return b[c]&&b[c][0]?b[c][0][e]-(b[c][0][e]-b[c][0][a])||b[a]:b[a]}var b,h,e=function(){var b=0;return function(e){return e.__uniqueID||(e.__uniqueID="uniqueID__"+b++)}}();(function(){var e={};b=function(b){return e[b]};h=function(b,a){e[b]=a}})();var j=d(g.document.documentElement,
"addEventListener","removeEventListener")&&d(g.window,"addEventListener","removeEventListener"),k=d(g.document.documentElement,"attachEvent","detachEvent")&&d(g.window,"attachEvent","detachEvent"),l={},o={};j?(j=function(b,e,a){b.addEventListener(e,a,!1)},k=function(b,e,a){b.removeEventListener(e,a,!1)}):k?(j=function(b,c,f){var j=e(b);h(j,b);l[j]||(l[j]={});l[j][c]||(l[j][c]=[]);f={handler:f,wrappedHandler:a(j,f)};l[j][c].push(f);b.attachEvent("on"+c,f.wrappedHandler)},k=function(b,a,c){var f=e(b),
h;if(l[f]&&l[f][a])for(var j=0,d=l[f][a].length;j<d;j++)if((h=l[f][a][j])&&h.handler===c)b.detachEvent("on"+a,h.wrappedHandler),l[f][a][j]=null}):(j=function(b,a,c){var h=e(b);o[h]||(o[h]={});if(!o[h][a]){o[h][a]=[];var j=b["on"+a];j&&o[h][a].push(j);b["on"+a]=f(h,a)}o[h][a].push(c)},k=function(b,a,c){b=e(b);if(o[b]&&o[b][a])for(var a=o[b][a],b=0,f=a.length;b<f;b++)a[b]===c&&a.splice(b,1)});g.util.addListener=j;g.util.removeListener=k;var i=function(b){return typeof b.clientX!=="unknown"?b.clientX:
0},p=function(b){return typeof b.clientY!=="unknown"?b.clientY:0};g.isTouchSupported&&(i=function(b){return c(b,"pageX","clientX")},p=function(b){return c(b,"pageY","clientY")});g.util.getPointer=function(b,a){b||(b=g.window.event);var e=g.util.getScrollLeftTop(b.target||(typeof b.srcElement!=="unknown"?b.srcElement:null),a);return{x:i(b)+e.left,y:p(b)+e.top}};g.util.object.extend(g.util,g.Observable)})();(function(){var d=g.document.createElement("div"),a=typeof d.style.filter==="string",f=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,
c=function(b){return b};typeof d.style.opacity==="string"?c=function(b,a){b.style.opacity=a;return b}:a&&(c=function(b,a){var e=b.style;if(b.currentStyle&&!b.currentStyle.hasLayout)e.zoom=1;f.test(e.filter)?e.filter=e.filter.replace(f,a>=0.9999?"":"alpha(opacity="+a*100+")"):e.filter+=" alpha(opacity="+a*100+")";return b});g.util.setStyle=function(b,a){var e=b.style;if(!e)return b;if(typeof a==="string")return b.style.cssText+=";"+a,a.indexOf("opacity")>-1?c(b,a.match(/opacity:\s*(\d?\.?\d*)/)[1]):
b;for(var f in a)f==="opacity"?c(b,a[f]):e[f==="float"||f==="cssFloat"?typeof e.styleFloat==="undefined"?"cssFloat":"styleFloat":f]=a[f];return b}})();(function(){function d(b,a){var c=g.document.createElement(b),f;for(f in a)f==="class"?c.className=a[f]:f==="for"?c.htmlFor=a[f]:c.setAttribute(f,a[f]);return c}var a=Array.prototype.slice,f,c=function(b){return a.call(b,0)};try{f=c(g.document.childNodes)instanceof Array}catch(b){}f||(c=function(b){for(var a=Array(b.length),c=b.length;c--;)a[c]=b[c];
return a});var h;h=g.document.defaultView&&g.document.defaultView.getComputedStyle?function(b,a){var c=g.document.defaultView.getComputedStyle(b,null);return c?c[a]:t}:function(b,a){var c=b.style[a];!c&&b.currentStyle&&(c=b.currentStyle[a]);return c};(function(){var b=g.document.documentElement.style,a="userSelect"in b?"userSelect":"MozUserSelect"in b?"MozUserSelect":"WebkitUserSelect"in b?"WebkitUserSelect":"KhtmlUserSelect"in b?"KhtmlUserSelect":"";g.util.makeElementUnselectable=function(b){if(typeof b.onselectstart!==
"undefined")b.onselectstart=g.util.falseFunction;if(a)b.style[a]="none";else if(typeof b.unselectable==="string")b.unselectable="on";return b};g.util.makeElementSelectable=function(b){if(typeof b.onselectstart!=="undefined")b.onselectstart=null;if(a)b.style[a]="";else if(typeof b.unselectable==="string")b.unselectable="";return b}})();(function(){g.util.getScript=function(b,a){var c=g.document.getElementsByTagName("head")[0],f=g.document.createElement("script"),h=!0;f.onload=f.onreadystatechange=
function(b){var e;if(h&&!(typeof this.readyState==="string"&&this.readyState!=="loaded"&&this.readyState!=="complete"))h=!1,a(b||g.window.event),e=f.onload=f.onreadystatechange=null,f=e};f.src=b;c.appendChild(f)}})();g.util.getById=function(b){return typeof b==="string"?g.document.getElementById(b):b};g.util.toArray=c;g.util.makeElement=d;g.util.addClass=function(b,a){b&&(" "+b.className+" ").indexOf(" "+a+" ")===-1&&(b.className+=(b.className?" ":"")+a)};g.util.wrapElement=function(b,a,c){typeof a===
"string"&&(a=d(a,c));b.parentNode&&b.parentNode.replaceChild(a,b);a.appendChild(b);return a};g.util.getScrollLeftTop=function(b,a){var c,f,h=0,d=0,p=g.document.documentElement,z=g.document.body||{scrollLeft:0,scrollTop:0};for(f=b;b&&b.parentNode&&!c;)b=b.parentNode,b.nodeType===1&&g.util.getElementStyle(b,"position")==="fixed"&&(c=b),b.nodeType===1&&f!==a&&g.util.getElementStyle(b,"position")==="absolute"?d=h=0:b===g.document?(h=z.scrollLeft||p.scrollLeft||0,d=z.scrollTop||p.scrollTop||0):(h+=b.scrollLeft||
0,d+=b.scrollTop||0);return{left:h,top:d}};g.util.getElementOffset=function(b){var a;a=b&&b.ownerDocument;var c={left:0,top:0},f={left:0,top:0},d={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!a)return{left:0,top:0};for(var i in d)f[d[i]]+=parseInt(h(b,i),10)||0;a=a.documentElement;typeof b.getBoundingClientRect!=="undefined"&&(c=b.getBoundingClientRect());b=g.util.getScrollLeftTop(b,null);return{left:c.left+b.left-(a.clientLeft||0)+f.left,top:c.top+b.top-(a.clientTop||
0)+f.top}};g.util.getElementStyle=h})();(function(){function d(){}var a=function(){for(var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],c=a.length;c--;)try{if(a[c]())return a[c]}catch(b){}}();g.util.request=function(f,c){c||(c={});var b=c.method?c.method.toUpperCase():"GET",h=c.onComplete||function(){},e=a(),j;e.onreadystatechange=
function(){if(e.readyState===4)h(e),e.onreadystatechange=d};b==="GET"&&(j=null,typeof c.parameters==="string"&&(f=f+(/\?/.test(f)?"&":"?")+c.parameters));e.open(b,f,!0);(b==="POST"||b==="PUT")&&e.setRequestHeader("Content-Type","application/x-www-form-urlencoded");e.send(j);return e}})();g.log=function(){};g.warn=function(){};typeof console!=="undefined"&&["log","warn"].forEach(function(d){typeof console[d]!=="undefined"&&console[d].apply&&(g[d]=function(){return console[d].apply(console,arguments)})});
(function(){function d(){return a.apply(g.window,arguments)}var a=g.window.requestAnimationFrame||g.window.webkitRequestAnimationFrame||g.window.mozRequestAnimationFrame||g.window.oRequestAnimationFrame||g.window.msRequestAnimationFrame||function(a){g.window.setTimeout(a,1E3/60)};g.util.animate=function(a){d(function(c){a||(a={});var b=c||+new Date,h=a.duration||500,e=b+h,j,g=a.onChange||function(){},l=a.abort||function(){return!1},o=a.easing||function(b,a,e,c){return-e*Math.cos(b/c*(Math.PI/2))+
e+a},i="startValue"in a?a.startValue:0,c="endValue"in a?a.endValue:100,p=a.byValue||c-i;a.onStart&&a.onStart();(function x(c){j=c||+new Date;c=j>e?h:j-b;l()?a.onComplete&&a.onComplete():(g(o(c,i,p,h)),j>e?a.onComplete&&a.onComplete():d(x))})(b)})};g.util.requestAnimFrame=d})();(function(){function d(b,a,e,c){b<Math.abs(a)?(b=a,c=e/4):c=e/(2*Math.PI)*Math.asin(a/b);return{a:b,c:a,p:e,s:c}}function a(b,a,e){return b.a*Math.pow(2,10*(a-=1))*Math.sin((a*e-b.s)*2*Math.PI/b.p)}function f(b,a,e,f){return e-
c(f-b,0,e,f)+a}function c(b,a,e,c){return(b/=c)<1/2.75?e*7.5625*b*b+a:b<2/2.75?e*(7.5625*(b-=1.5/2.75)*b+0.75)+a:b<2.5/2.75?e*(7.5625*(b-=2.25/2.75)*b+0.9375)+a:e*(7.5625*(b-=2.625/2.75)*b+0.984375)+a}g.util.ease={easeInQuad:function(b,a,e,c){return e*(b/=c)*b+a},easeOutQuad:function(b,a,e,c){return-e*(b/=c)*(b-2)+a},easeInOutQuad:function(b,a,e,c){b/=c/2;return b<1?e/2*b*b+a:-e/2*(--b*(b-2)-1)+a},easeInCubic:function(b,a,e,c){return e*(b/=c)*b*b+a},easeOutCubic:function(b,a,e,c){return e*((b=b/c-
1)*b*b+1)+a},easeInOutCubic:function(b,a,e,c){b/=c/2;return b<1?e/2*b*b*b+a:e/2*((b-=2)*b*b+2)+a},easeInQuart:function(b,a,e,c){return e*(b/=c)*b*b*b+a},easeOutQuart:function(b,a,e,c){return-e*((b=b/c-1)*b*b*b-1)+a},easeInOutQuart:function(b,a,e,c){b/=c/2;return b<1?e/2*b*b*b*b+a:-e/2*((b-=2)*b*b*b-2)+a},easeInQuint:function(b,a,e,c){return e*(b/=c)*b*b*b*b+a},easeOutQuint:function(b,a,e,c){return e*((b=b/c-1)*b*b*b*b+1)+a},easeInOutQuint:function(b,a,e,c){b/=c/2;return b<1?e/2*b*b*b*b*b+a:e/2*((b-=
2)*b*b*b*b+2)+a},easeInSine:function(b,a,e,c){return-e*Math.cos(b/c*(Math.PI/2))+e+a},easeOutSine:function(b,a,e,c){return e*Math.sin(b/c*(Math.PI/2))+a},easeInOutSine:function(b,a,e,c){return-e/2*(Math.cos(Math.PI*b/c)-1)+a},easeInExpo:function(b,a,e,c){return b===0?a:e*Math.pow(2,10*(b/c-1))+a},easeOutExpo:function(b,a,e,c){return b===c?a+e:e*(-Math.pow(2,-10*b/c)+1)+a},easeInOutExpo:function(b,a,e,c){if(b===0)return a;if(b===c)return a+e;b/=c/2;return b<1?e/2*Math.pow(2,10*(b-1))+a:e/2*(-Math.pow(2,
-10*--b)+2)+a},easeInCirc:function(b,a,e,c){return-e*(Math.sqrt(1-(b/=c)*b)-1)+a},easeOutCirc:function(b,a,e,c){return e*Math.sqrt(1-(b=b/c-1)*b)+a},easeInOutCirc:function(b,a,e,c){b/=c/2;return b<1?-e/2*(Math.sqrt(1-b*b)-1)+a:e/2*(Math.sqrt(1-(b-=2)*b)+1)+a},easeInElastic:function(b,c,e,f){var g=0;if(b===0)return c;b/=f;if(b===1)return c+e;g||(g=f*0.3);e=d(e,e,g,1.70158);return-a(e,b,f)+c},easeOutElastic:function(b,a,e,c){var f=0;if(b===0)return a;b/=c;if(b===1)return a+e;f||(f=c*0.3);e=d(e,e,f,
1.70158);return e.a*Math.pow(2,-10*b)*Math.sin((b*c-e.s)*2*Math.PI/e.p)+e.c+a},easeInOutElastic:function(b,c,e,f){var g=0;if(b===0)return c;b/=f/2;if(b===2)return c+e;g||(g=f*0.3*1.5);e=d(e,e,g,1.70158);return b<1?-0.5*a(e,b,f)+c:e.a*Math.pow(2,-10*(b-=1))*Math.sin((b*f-e.s)*2*Math.PI/e.p)*0.5+e.c+c},easeInBack:function(b,a,e,c,f){f===t&&(f=1.70158);return e*(b/=c)*b*((f+1)*b-f)+a},easeOutBack:function(b,a,e,c,f){f===t&&(f=1.70158);return e*((b=b/c-1)*b*((f+1)*b+f)+1)+a},easeInOutBack:function(b,
a,e,c,f){f===t&&(f=1.70158);b/=c/2;return b<1?e/2*b*b*(((f*=1.525)+1)*b-f)+a:e/2*((b-=2)*b*(((f*=1.525)+1)*b+f)+2)+a},easeInBounce:f,easeOutBounce:c,easeInOutBounce:function(b,a,e,d){return b<d/2?f(b*2,0,e,d)*0.5+a:c(b*2-d,0,e,d)*0.5+e*0.5+a}}})();(function(d){function a(b){return b in w?w[b]:b}function f(b,a,e,c){var f=Object.prototype.toString.call(a)==="[object Array]",h;(b==="fill"||b==="stroke")&&a==="none"?a="":b==="strokeDashArray"?a=a.replace(/,/g," ").split(/\s+/).map(function(b){return parseFloat(b)}):
b==="transformMatrix"?a=e&&e.transformMatrix?n(e.transformMatrix,i.parseTransformAttribute(a)):i.parseTransformAttribute(a):b==="visible"?(a=a==="none"||a==="hidden"?!1:!0,e&&e.visible===!1&&(a=!1)):b==="originX"?a=a==="start"?"left":a==="end"?"right":"center":h=f?a.map(E):E(a,c);return!f&&isNaN(h)?a:h}function c(b){for(var a in A)if(b[a]&&typeof b[A[a]]!=="undefined"&&b[a].indexOf("url(")!==0){var e=new i.Color(b[a]);b[a]=e.setAlpha(C(e.getAlpha()*b[A[a]],2)).toRgba()}return b}function b(b,e){var c,
h;b.replace(/;$/,"").split(";").forEach(function(b){b=b.split(":");c=a(b[0].trim().toLowerCase());h=f(c,b[1].trim());e[c]=h})}function h(b,a){var c={},f;for(f in i.cssRules[a]){var h=b,d=f.split(" "),j=void 0,g=!0;if((j=e(h,d.pop()))&&d.length){for(var g=d,k=void 0,l=!0;h.parentNode&&h.parentNode.nodeType===1&&g.length;)l&&(k=g.pop()),h=h.parentNode,l=e(h,k);g=g.length===0}if(j&&g&&d.length===0)for(var o in i.cssRules[a][f])c[o]=i.cssRules[a][f][o]}return c}function e(b,a){var e=b.nodeName,c=b.getAttribute("class"),
f=b.getAttribute("id"),a=a.replace(RegExp("^"+e,"i"),"");f&&a.length&&(a=a.replace(RegExp("#"+f+"(?![a-zA-Z\\-]+)","i"),""));if(c&&a.length){c=c.split(" ");for(f=c.length;f--;)e=RegExp("\\."+c[f]+"(?![a-zA-Z\\-]+)","i"),a=a.replace(e,"")}return a.length===0}function j(b){for(var a=b.getElementsByTagName("use");a.length;){for(var e=a[0],c=e.getAttribute("xlink:href").substr(1),f=e.getAttribute("x")||0,h=e.getAttribute("y")||0,c=b.getElementById(c).cloneNode(!0),f=(c.getAttribute("transform")||"")+
" translate("+f+", "+h+")",h=0,d=e.attributes,j=d.length;h<j;h++){var g=d.item(h);g.nodeName==="x"||g.nodeName==="y"||g.nodeName==="xlink:href"||(g.nodeName==="transform"?f=g.nodeValue+" "+f:c.setAttribute(g.nodeName,g.nodeValue))}c.setAttribute("transform",f);c.setAttribute("instantiated_by_use","1");c.removeAttribute("id");e.parentNode.replaceChild(c,e)}}function g(b,a,e){var c=RegExp("^\\s*("+i.reNum+"+)\\s*,?\\s*("+i.reNum+"+)\\s*,?\\s*("+i.reNum+"+)\\s*,?\\s*("+i.reNum+"+)\\s*$"),f=b.getAttribute("viewBox"),
h=1,d=1,j=0,k=0;if(f&&(f=f.match(c)))if(j=-parseFloat(f[1]),k=-parseFloat(f[2]),c=parseFloat(f[3]),f=parseFloat(f[4]),a&&a!==c&&(h=a/c),e&&e!==f&&(d=e/f),d=h=h>d?d:h,h!==1||d!==1||j!==0||k!==0){a="matrix("+h+" 0 0 "+d+" "+j*h+" "+k*d+")";if(b.tagName==="svg"){for(e=b.ownerDocument.createElement("g");b.firstChild!=null;)e.appendChild(b.firstChild);b.appendChild(e)}else e=b,a+=e.getAttribute("transform");e.setAttribute("transform",a)}}function l(b){var a=b.objects,b=b.options,a=a.map(function(b){return i[m(b.type)].fromObject(b)});
return{objects:a,options:b}}function o(b,a,e){a[e]&&a[e].toSVG&&b.push('<pattern x="0" y="0" id="',e,'Pattern" ','width="',a[e].source.width,'" height="',a[e].source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',a[e].source.width,'" height="',a[e].source.height,'" xlink:href="',a[e].source.src,'"></image></pattern>')}var i=d.fabric||(d.fabric={}),p=i.util.object.extend,m=i.util.string.capitalize,x=i.util.object.clone,C=i.util.toFixed,E=i.util.parseUnit,n=i.util.multiplyTransformMatrices,
w={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration",
"text-anchor":"originX"},A={stroke:"strokeOpacity",fill:"fillOpacity"};i.cssRules={};i.gradientDefs={};i.parseTransformAttribute=function(){function b(a,e){var c=e[0];a[0]=Math.cos(c);a[1]=Math.sin(c);a[2]=-Math.sin(c);a[3]=Math.cos(c)}function a(b,e){var c=e.length===2?e[1]:e[0];b[0]=e[0];b[3]=c}function e(b,a){b[4]=a[0];a.length===2&&(b[5]=a[1])}var c=[1,0,0,1,0,0],f=i.reNum,h="(?:"+("(?:(matrix)\\s*\\(\\s*("+f+")(?:\\s+,?\\s*|,\\s*)("+f+")(?:\\s+,?\\s*|,\\s*)("+f+")(?:\\s+,?\\s*|,\\s*)("+f+")(?:\\s+,?\\s*|,\\s*)("+
f+")(?:\\s+,?\\s*|,\\s*)("+f+")\\s*\\))")+"|"+("(?:(translate)\\s*\\(\\s*("+f+")(?:(?:\\s+,?\\s*|,\\s*)("+f+"))?\\s*\\))")+"|"+("(?:(scale)\\s*\\(\\s*("+f+")(?:(?:\\s+,?\\s*|,\\s*)("+f+"))?\\s*\\))")+"|"+("(?:(rotate)\\s*\\(\\s*("+f+")(?:(?:\\s+,?\\s*|,\\s*)("+f+")(?:\\s+,?\\s*|,\\s*)("+f+"))?\\s*\\))")+"|"+("(?:(skewX)\\s*\\(\\s*("+f+")\\s*\\))")+"|"+("(?:(skewY)\\s*\\(\\s*("+f+")\\s*\\))")+")",d=RegExp("^\\s*(?:"+("(?:"+h+"(?:(?:\\s+,?\\s*|,\\s*)"+h+")*)")+"?)\\s*$"),j=RegExp(h,"g");return function(f){var g=
c.concat(),k=[];if(!f||f&&!d.test(f))return g;f.replace(j,function(f){var d=RegExp(h).exec(f).filter(function(b){return b!==""&&b!=null}),f=d[1],d=d.slice(2).map(parseFloat);switch(f){case "translate":e(g,d);break;case "rotate":d[0]=i.util.degreesToRadians(d[0]);b(g,d);break;case "scale":a(g,d);break;case "skewX":g[2]=Math.tan(i.util.degreesToRadians(d[0]));break;case "skewY":g[1]=Math.tan(i.util.degreesToRadians(d[0]));break;case "matrix":g=d}k.push(g.concat());g=c.concat()});for(f=k[0];k.length>
1;)k.shift(),f=i.util.multiplyTransformMatrices(f,k[0]);return f}}();i.parseSVGDocument=function(){var b=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,a=/^(symbol|image|marker|pattern|view)$/;return function(e,c,f){if(e){j(e);var h=new Date,d=i.Object.__uid++,l=E(e.getAttribute("width")||"100%"),o=E(e.getAttribute("height")||"100%");g(e,l,o);var p=i.util.toArray(e.getElementsByTagName("*"));if(p.length===0&&i.isLikelyNode){for(var p=e.selectNodes('//*[name(.)!="svg"]'),m=[],z=0,
C=p.length;z<C;z++)m[z]=p[z];p=m}p=p.filter(function(e){a.test(e.tagName)&&g(e,0,0);var c;if(c=b.test(e.tagName)){a:{for(c=/^(?:pattern|defs|symbol)$/;e&&(e=e.parentNode);)if(c.test(e.nodeName)&&!e.getAttribute("instantiated_by_use")){e=!0;break a}e=!1}c=!e}return c});if(!p||p&&!p.length)c&&c([],{});else{var n={width:l,height:o,widthAttr:l,heightAttr:o,svgUid:d};i.gradientDefs[d]=i.getGradientDefs(e);i.cssRules[d]=i.getCSSRules(e);i.parseElements(p,function(b){i.documentParsingTime=new Date-h;c&&
c(b,n)},x(n),f)}}}}();var v={has:function(b,a){a(!1)},get:function(){},set:function(){}};p(i,{parseFontDeclaration:function(b,a){var e=b.match("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+i.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+i.reNum+"))?\\s+(.*)");if(e){var c=e[1],f=e[3],h=e[4],d=e[5],e=e[6];if(c)a.fontStyle=c;if(f)a.fontWeight=isNaN(parseFloat(f))?f:parseFloat(f);if(h)a.fontSize=E(h);if(e)a.fontFamily=e;if(d)a.lineHeight=
d==="normal"?1:d}},getGradientDefs:function(b){var a=b.getElementsByTagName("linearGradient"),e=b.getElementsByTagName("radialGradient"),c,f=0,h,d=[],b={},j={};d.length=a.length+e.length;for(c=a.length;c--;)d[f++]=a[c];for(c=e.length;c--;)d[f++]=e[c];for(;f--;)a=d[f],e=a.getAttribute("xlink:href"),h=a.getAttribute("id"),e&&(j[h]=e.substr(1)),b[h]=a;for(h in j){f=b[j[h]].cloneNode(!0);for(a=b[h];f.firstChild;)a.appendChild(f.firstChild)}return b},parseAttributes:function(b,e,d){if(b){var j,g={},k;
typeof d==="undefined"&&(d=b.getAttribute("svgUid"));b.parentNode&&/^symbol|[g|a]$/i.test(b.parentNode.nodeName)&&(g=i.parseAttributes(b.parentNode,e,d));k=g&&g.fontSize||b.getAttribute("font-size")||i.Text.DEFAULT_SVG_FONT_SIZE;e=e.reduce(function(e,c){if(j=b.getAttribute(c))c=a(c),j=f(c,j,g,k),e[c]=j;return e},{});e=p(e,p(h(b,d),i.parseStyleAttribute(b)));e.font&&i.parseFontDeclaration(e.font,e);return c(p(g,e))}},parseElements:function(b,a,e,c){(new i.ElementsParser(b,a,e,c)).parse()},parseStyleAttribute:function(e){var c=
{},e=e.getAttribute("style");if(!e)return c;if(typeof e==="string")b(e,c);else{var h,d,j;for(j in e)typeof e[j]!=="undefined"&&(h=a(j.toLowerCase()),d=f(h,e[j]),c[h]=d)}return c},parsePointsAttribute:function(b){if(!b)return null;var b=b.replace(/,/g," ").trim(),b=b.split(/\s+/),a=[],e,c;e=0;for(c=b.length;e<c;e+=2)a.push({x:parseFloat(b[e]),y:parseFloat(b[e+1])});return a},getCSSRules:function(b){for(var b=b.getElementsByTagName("style"),e={},c,h=0,d=b.length;h<d;h++)c=b[h].textContent,c=c.replace(/\/\*[\s\S]*?\*\//g,
""),c.trim()!==""&&(c=c.match(/[^{]*\{[\s\S]*?\}/g),c=c.map(function(b){return b.trim()}),c.forEach(function(b){for(var b=b.match(/([\s\S]*?)\s*\{([^}]*)\}/),c={},h=b[2].trim().replace(/;$/,"").split(/\s*;\s*/),d=0,j=h.length;d<j;d++){var g=h[d].split(/\s*:\s*/),k=a(g[0]),g=f(k,g[1],g[0]);c[k]=g}b=b[1];b.split(",").forEach(function(b){b=b.replace(/^svg/i,"").trim();b!==""&&(e[b]=i.util.object.clone(c))})}));return e},loadSVGFromURL:function(b,a,e){function c(f){var h=f.responseXML;if(h&&!h.documentElement&&
i.window.ActiveXObject&&f.responseText)h=new ActiveXObject("Microsoft.XMLDOM"),h.async="false",h.loadXML(f.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""));h&&h.documentElement&&i.parseSVGDocument(h.documentElement,function(e,c){v.set(b,{objects:i.util.array.invoke(e,"toObject"),options:c});a(e,c)},e)}b=b.replace(/^\n\s*/,"").trim();v.has(b,function(e){e?v.get(b,function(b){b=l(b);a(b.objects,b.options)}):new i.util.request(b,{method:"get",onComplete:c})})},loadSVGFromString:function(b,
a,e){var b=b.trim(),c;if(typeof DOMParser!=="undefined"){var f=new DOMParser;f&&f.parseFromString&&(c=f.parseFromString(b,"text/xml"))}else if(i.window.ActiveXObject)c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""));i.parseSVGDocument(c.documentElement,function(b,e){a(b,e)},e)},createSVGFontFacesMarkup:function(b){for(var a="",e=0,c=b.length;e<c;e++)b[e].type==="text"&&b[e].path&&(a+=["@font-face {font-family: ",b[e].fontFamily,"; src: url('",
b[e].path,"')}"].join(""));a&&(a=['<style type="text/css"><![CDATA[',a,"]]\></style>"].join(""));return a},createSVGRefElementsMarkup:function(b){var a=[];o(a,b,"backgroundColor");o(a,b,"overlayColor");return a.join("")}})})(typeof m!=="undefined"?m:this);g.ElementsParser=function(d,a,f,c){this.elements=d;this.callback=a;this.options=f;this.reviver=c;this.svgUid=f&&f.svgUid||0};g.ElementsParser.prototype.parse=function(){this.instances=Array(this.elements.length);this.numElements=this.elements.length;
this.createObjects()};g.ElementsParser.prototype.createObjects=function(){for(var d=0,a=this.elements.length;d<a;d++)this.elements[d].setAttribute("svgUid",this.svgUid),function(a,c){setTimeout(function(){a.createObject(a.elements[c],c)},0)}(this,d)};g.ElementsParser.prototype.createObject=function(d,a){var f=g[g.util.string.capitalize(d.tagName)];if(f&&f.fromElement)try{this._createObject(f,d,a)}catch(c){g.log(c)}else this.checkIfDone()};g.ElementsParser.prototype._createObject=function(d,a,f){d.async?
d.fromElement(a,this.createCallback(f,a),this.options):(d=d.fromElement(a,this.options),this.resolveGradient(d,"fill"),this.resolveGradient(d,"stroke"),this.reviver&&this.reviver(a,d),this.instances[f]=d,this.checkIfDone())};g.ElementsParser.prototype.createCallback=function(d,a){var f=this;return function(c){f.resolveGradient(c,"fill");f.resolveGradient(c,"stroke");f.reviver&&f.reviver(a,c);f.instances[d]=c;f.checkIfDone()}};g.ElementsParser.prototype.resolveGradient=function(d,a){var f=d.get(a);
/^url\(/.test(f)&&(f=f.slice(5,f.length-1),g.gradientDefs[this.svgUid][f]&&d.set(a,g.Gradient.fromElement(g.gradientDefs[this.svgUid][f],d)))};g.ElementsParser.prototype.checkIfDone=function(){if(--this.numElements===0)this.instances=this.instances.filter(function(d){return d!=null}),this.callback(this.instances)};(function(d){function a(a,c){this.x=a;this.y=c}d=d.fabric||(d.fabric={});d.Point?d.warn("fabric.Point is already defined"):(d.Point=a,a.prototype={constructor:a,add:function(f){return new a(this.x+
f.x,this.y+f.y)},addEquals:function(a){this.x+=a.x;this.y+=a.y;return this},scalarAdd:function(f){return new a(this.x+f,this.y+f)},scalarAddEquals:function(a){this.x+=a;this.y+=a;return this},subtract:function(f){return new a(this.x-f.x,this.y-f.y)},subtractEquals:function(a){this.x-=a.x;this.y-=a.y;return this},scalarSubtract:function(f){return new a(this.x-f,this.y-f)},scalarSubtractEquals:function(a){this.x-=a;this.y-=a;return this},multiply:function(f){return new a(this.x*f,this.y*f)},multiplyEquals:function(a){this.x*=
a;this.y*=a;return this},divide:function(f){return new a(this.x/f,this.y/f)},divideEquals:function(a){this.x/=a;this.y/=a;return this},eq:function(a){return this.x===a.x&&this.y===a.y},lt:function(a){return this.x<a.x&&this.y<a.y},lte:function(a){return this.x<=a.x&&this.y<=a.y},gt:function(a){return this.x>a.x&&this.y>a.y},gte:function(a){return this.x>=a.x&&this.y>=a.y},lerp:function(f,c){return new a(this.x+(f.x-this.x)*c,this.y+(f.y-this.y)*c)},distanceFrom:function(a){var c=this.x-a.x,a=this.y-
a.y;return Math.sqrt(c*c+a*a)},midPointFrom:function(f){return new a(this.x+(f.x-this.x)/2,this.y+(f.y-this.y)/2)},min:function(f){return new a(Math.min(this.x,f.x),Math.min(this.y,f.y))},max:function(f){return new a(Math.max(this.x,f.x),Math.max(this.y,f.y))},toString:function(){return this.x+","+this.y},setXY:function(a,c){this.x=a;this.y=c},setFromPoint:function(a){this.x=a.x;this.y=a.y},swap:function(a){var c=this.x,b=this.y;this.x=a.x;this.y=a.y;a.x=c;a.y=b}})})(typeof m!=="undefined"?m:this);
(function(d){function a(a){this.status=a;this.points=[]}var f=d.fabric||(d.fabric={});f.Intersection?f.warn("fabric.Intersection is already defined"):(f.Intersection=a,f.Intersection.prototype={appendPoint:function(a){this.points.push(a)},appendPoints:function(a){this.points=this.points.concat(a)}},f.Intersection.intersectLineLine=function(c,b,h,e){var d,g=(e.x-h.x)*(c.y-h.y)-(e.y-h.y)*(c.x-h.x);d=(b.x-c.x)*(c.y-h.y)-(b.y-c.y)*(c.x-h.x);h=(e.y-h.y)*(b.x-c.x)-(e.x-h.x)*(b.y-c.y);h!==0?(g/=h,d/=h,0<=
g&&g<=1&&0<=d&&d<=1?(d=new a("Intersection"),d.points.push(new f.Point(c.x+g*(b.x-c.x),c.y+g*(b.y-c.y)))):d=new a):d=g===0||d===0?new a("Coincident"):new a("Parallel");return d},f.Intersection.intersectLinePolygon=function(c,b,f){for(var e=new a,d=f.length,g=0;g<d;g++){var l=a.intersectLineLine(c,b,f[g],f[(g+1)%d]);e.appendPoints(l.points)}if(e.points.length>0)e.status="Intersection";return e},f.Intersection.intersectPolygonPolygon=function(c,b){for(var f=new a,e=c.length,d=0;d<e;d++){var g=a.intersectLinePolygon(c[d],
c[(d+1)%e],b);f.appendPoints(g.points)}if(f.points.length>0)f.status="Intersection";return f},f.Intersection.intersectPolygonRectangle=function(c,b,h){var e=b.min(h),d=b.max(h),h=new f.Point(d.x,e.y),g=new f.Point(e.x,d.y),b=a.intersectLinePolygon(e,h,c),h=a.intersectLinePolygon(h,d,c),d=a.intersectLinePolygon(d,g,c),c=a.intersectLinePolygon(g,e,c),e=new a;e.appendPoints(b.points);e.appendPoints(h.points);e.appendPoints(d.points);e.appendPoints(c.points);if(e.points.length>0)e.status="Intersection";
return e})})(typeof m!=="undefined"?m:this);(function(d){function a(b){b?this._tryParsingColor(b):this.setSource([0,0,0,1])}function f(b,a,e){e<0&&(e+=1);e>1&&(e-=1);return e<1/6?b+(a-b)*6*e:e<0.5?a:e<2/3?b+(a-b)*(2/3-e)*6:b}var c=d.fabric||(d.fabric={});c.Color?c.warn("fabric.Color is already defined."):(c.Color=a,c.Color.prototype={_tryParsingColor:function(b){var c;b in a.colorNameMap&&(b=a.colorNameMap[b]);b==="transparent"?this.setSource([255,255,255,0]):((c=a.sourceFromHex(b))||(c=a.sourceFromRgb(b)),
c||(c=a.sourceFromHsl(b)),c&&this.setSource(c))},_rgbToHsl:function(b,a,e){b/=255;a/=255;e/=255;var f,d,g,o=c.util.array.max([b,a,e]);d=c.util.array.min([b,a,e]);g=(o+d)/2;if(o===d)f=d=0;else{var i=o-d;d=g>0.5?i/(2-o-d):i/(o+d);switch(o){case b:f=(a-e)/i+(a<e?6:0);break;case a:f=(e-b)/i+2;break;case e:f=(b-a)/i+4}f/=6}return[Math.round(f*360),Math.round(d*100),Math.round(g*100)]},getSource:function(){return this._source},setSource:function(b){this._source=b},toRgb:function(){var b=this.getSource();
return"rgb("+b[0]+","+b[1]+","+b[2]+")"},toRgba:function(){var b=this.getSource();return"rgba("+b[0]+","+b[1]+","+b[2]+","+b[3]+")"},toHsl:function(){var b=this.getSource(),b=this._rgbToHsl(b[0],b[1],b[2]);return"hsl("+b[0]+","+b[1]+"%,"+b[2]+"%)"},toHsla:function(){var b=this.getSource(),a=this._rgbToHsl(b[0],b[1],b[2]);return"hsla("+a[0]+","+a[1]+"%,"+a[2]+"%,"+b[3]+")"},toHex:function(){var b=this.getSource(),a,e;a=b[0].toString(16);a=a.length===1?"0"+a:a;e=b[1].toString(16);e=e.length===1?"0"+
e:e;b=b[2].toString(16);b=b.length===1?"0"+b:b;return a.toUpperCase()+e.toUpperCase()+b.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(b){var a=this.getSource();a[3]=b;this.setSource(a);return this},toGrayscale:function(){var b=this.getSource(),a=parseInt((b[0]*0.3+b[1]*0.59+b[2]*0.11).toFixed(0),10);this.setSource([a,a,a,b[3]]);return this},toBlackWhite:function(b){var a=this.getSource(),e=(a[0]*0.3+a[1]*0.59+a[2]*0.11).toFixed(0),a=a[3],e=Number(e)<Number(b||127)?
0:255;this.setSource([e,e,e,a]);return this},overlayWith:function(b){b instanceof a||(b=new a(b));for(var c=[],e=this.getAlpha(),f=this.getSource(),b=b.getSource(),d=0;d<3;d++)c.push(Math.round(f[d]*0.5+b[d]*0.5));c[3]=e;this.setSource(c);return this}},c.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,c.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,
c.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,c.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},c.Color.fromRgb=function(b){return a.fromSource(a.sourceFromRgb(b))},c.Color.sourceFromRgb=function(b){if(b=b.match(a.reRGBa)){var c=parseInt(b[1],10)/(/%$/.test(b[1])?
100:1)*(/%$/.test(b[1])?255:1),e=parseInt(b[2],10)/(/%$/.test(b[2])?100:1)*(/%$/.test(b[2])?255:1),f=parseInt(b[3],10)/(/%$/.test(b[3])?100:1)*(/%$/.test(b[3])?255:1);return[parseInt(c,10),parseInt(e,10),parseInt(f,10),b[4]?parseFloat(b[4]):1]}},c.Color.fromRgba=a.fromRgb,c.Color.fromHsl=function(b){return a.fromSource(a.sourceFromHsl(b))},c.Color.sourceFromHsl=function(b){if(b=b.match(a.reHSLa)){var c=(parseFloat(b[1])%360+360)%360/360,e=parseFloat(b[2])/(/%$/.test(b[2])?100:1),d=parseFloat(b[3])/
(/%$/.test(b[3])?100:1);if(e===0)d=e=c=d;else var g=d<=0.5?d*(e+1):d+e-d*e,l=d*2-g,d=f(l,g,c+1/3),e=f(l,g,c),c=f(l,g,c-1/3);return[Math.round(d*255),Math.round(e*255),Math.round(c*255),b[4]?parseFloat(b[4]):1]}},c.Color.fromHsla=a.fromHsl,c.Color.fromHex=function(b){return a.fromSource(a.sourceFromHex(b))},c.Color.sourceFromHex=function(b){if(b.match(a.reHex)){var c=b.slice(b.indexOf("#")+1),e=c.length===3,b=e?c.charAt(0)+c.charAt(0):c.substring(0,2),f=e?c.charAt(1)+c.charAt(1):c.substring(2,4),c=
e?c.charAt(2)+c.charAt(2):c.substring(4,6);return[parseInt(b,16),parseInt(f,16),parseInt(c,16),1]}},c.Color.fromSource=function(b){var c=new a;c.setSource(b);return c})})(typeof m!=="undefined"?m:this);(function(){function d(a){var c=a.getAttribute("style"),b=a.getAttribute("offset"),h,e,b=parseFloat(b)/(/%$/.test(b)?100:1),b=b<0?0:b>1?1:b;if(c){c=c.split(/\s*;\s*/);c[c.length-1]===""&&c.pop();for(var d=c.length;d--;){var k=c[d].split(/\s*:\s*/),l=k[0].trim(),k=k[1].trim();l==="stop-color"?h=k:l===
"stop-opacity"&&(e=k)}}h||(h=a.getAttribute("stop-color")||"rgb(0,0,0)");e||(e=a.getAttribute("stop-opacity"));h=new g.Color(h);a=h.getAlpha();e=isNaN(parseFloat(e))?1:parseFloat(e);e*=a;return{offset:b,color:h.toRgb(),opacity:e}}function a(a,c,b){var h,e=0,d=1,g="",l;for(l in c){h=parseFloat(c[l],10);d=typeof c[l]==="string"&&/^\d+%$/.test(c[l])?0.01:1;if(l==="x1"||l==="x2"||l==="r2")d*=b==="objectBoundingBox"?a.width:1,e=b==="objectBoundingBox"?a.left||0:0;else if(l==="y1"||l==="y2")d*=b==="objectBoundingBox"?
a.height:1,e=b==="objectBoundingBox"?a.top||0:0;c[l]=h*d+e}a.type==="ellipse"&&c.r2!==null&&b==="objectBoundingBox"&&a.rx!==a.ry&&(a=a.ry/a.rx,g=" scale(1, "+a+")",c.y1&&(c.y1/=a),c.y2&&(c.y2/=a));return g}g.Gradient=g.util.createClass({offsetX:0,offsetY:0,initialize:function(a){a||(a={});var c={};this.id=g.Object.__uid++;this.type=a.type||"linear";c={x1:a.coords.x1||0,y1:a.coords.y1||0,x2:a.coords.x2||0,y2:a.coords.y2||0};if(this.type==="radial")c.r1=a.coords.r1||0,c.r2=a.coords.r2||0;this.coords=
c;this.colorStops=a.colorStops.slice();if(a.gradientTransform)this.gradientTransform=a.gradientTransform;this.offsetX=a.offsetX||this.offsetX;this.offsetY=a.offsetY||this.offsetY},addColorStop:function(a){for(var c in a){var b=new g.Color(a[c]);this.colorStops.push({offset:c,color:b.toRgb(),opacity:b.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(a){var c=g.util.object.clone(this.coords),
b;this.colorStops.sort(function(b,a){return b.offset-a.offset});if(!(a.group&&a.group.type==="path-group"))for(var h in c)if(h==="x1"||h==="x2"||h==="r2")c[h]+=this.offsetX-a.width/2;else if(h==="y1"||h==="y2")c[h]+=this.offsetY-a.height/2;a='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"';this.gradientTransform&&(a+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" ');this.type==="linear"?b=["<linearGradient ",a,' x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,'">\n']:
this.type==="radial"&&(b=["<radialGradient ",a,' cx="',c.x2,'" cy="',c.y2,'" r="',c.r2,'" fx="',c.x1,'" fy="',c.y1,'">\n']);for(c=0;c<this.colorStops.length;c++)b.push("<stop ",'offset="',this.colorStops[c].offset*100+"%",'" style="stop-color:',this.colorStops[c].color,this.colorStops[c].opacity!=null?";stop-opacity: "+this.colorStops[c].opacity:";",'"/>\n');b.push(this.type==="linear"?"</linearGradient>\n":"</radialGradient>\n");return b.join("")},toLive:function(a,c){var b,h=g.util.object.clone(this.coords);
if(this.type){if(c.group&&c.group.type==="path-group")for(var e in h)if(e==="x1"||e==="x2")h[e]+=-this.offsetX+c.width/2;else if(e==="y1"||e==="y2")h[e]+=-this.offsetY+c.height/2;this.type==="linear"?b=a.createLinearGradient(h.x1,h.y1,h.x2,h.y2):this.type==="radial"&&(b=a.createRadialGradient(h.x1,h.y1,h.r1,h.x2,h.y2,h.r2));h=0;for(e=this.colorStops.length;h<e;h++){var d=this.colorStops[h].color,k=this.colorStops[h].opacity,l=this.colorStops[h].offset;typeof k!=="undefined"&&(d=(new g.Color(d)).setAlpha(k).toRgba());
b.addColorStop(parseFloat(l),d)}return b}}});g.util.object.extend(g.Gradient,{fromElement:function(f,c){var b=f.getElementsByTagName("stop"),h=f.nodeName==="linearGradient"?"linear":"radial",e=f.getAttribute("gradientUnits")||"objectBoundingBox",j=f.getAttribute("gradientTransform"),k=[],l={};h==="linear"?l={x1:f.getAttribute("x1")||0,y1:f.getAttribute("y1")||0,x2:f.getAttribute("x2")||"100%",y2:f.getAttribute("y2")||0}:h==="radial"&&(l={x1:f.getAttribute("fx")||f.getAttribute("cx")||"50%",y1:f.getAttribute("fy")||
f.getAttribute("cy")||"50%",r1:0,x2:f.getAttribute("cx")||"50%",y2:f.getAttribute("cy")||"50%",r2:f.getAttribute("r")||"50%"});for(var o=b.length;o--;)k.push(d(b[o]));b=a(c,l,e);h=new g.Gradient({type:h,coords:l,colorStops:k,offsetX:-c.left,offsetY:-c.top});if(j||b!=="")h.gradientTransform=g.parseTransformAttribute((j||"")+b);return h},forObject:function(f,c){c||(c={});a(f,c.coords,"userSpaceOnUse");return new g.Gradient(c)}})})();g.Pattern=g.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,
initialize:function(d){d||(d={});this.id=g.Object.__uid++;if(d.source)if(typeof d.source==="string")if(typeof g.util.getFunctionBody(d.source)!=="undefined")this.source=new Function(g.util.getFunctionBody(d.source));else{var a=this;this.source=g.util.createImage();g.util.loadImage(d.source,function(f){a.source=f})}else this.source=d.source;if(d.repeat)this.repeat=d.repeat;if(d.offsetX)this.offsetX=d.offsetX;if(d.offsetY)this.offsetY=d.offsetY},toObject:function(){var d;if(typeof this.source==="function")d=
String(this.source);else if(typeof this.source.src==="string")d=this.source.src;return{source:d,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(d){var a=typeof this.source==="function"?this.source():this.source,f=a.width/d.getWidth(),c=a.height/d.getHeight(),b=this.offsetX/d.getWidth(),d=this.offsetY/d.getHeight(),h="";if(this.repeat==="repeat-x"||this.repeat==="no-repeat")c=1;if(this.repeat==="repeat-y"||this.repeat==="no-repeat")f=1;a.src?h=a.src:a.toDataURL&&(h=a.toDataURL());
return'<pattern id="SVGID_'+this.id+'" x="'+b+'" y="'+d+'" width="'+f+'" height="'+c+'">\n<image x="0" y="0" width="'+a.width+'" height="'+a.height+'" xlink:href="'+h+'"></image>\n</pattern>\n'},toLive:function(d){var a=typeof this.source==="function"?this.source():this.source;if(!a)return"";if(typeof a.src!=="undefined"){if(!a.complete)return"";if(a.naturalWidth===0||a.naturalHeight===0)return""}return d.createPattern(a,this.repeat)}});(function(d){var a=d.fabric||(d.fabric={});a.Shadow?a.warn("fabric.Shadow is already defined."):
(a.Shadow=a.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(f){typeof f==="string"&&(f=this._parseShadow(f));for(var c in f)this[c]=f[c];this.id=a.Object.__uid++},_parseShadow:function(f){var f=f.trim(),c=a.Shadow.reOffsetsAndBlur.exec(f)||[];return{color:(f.replace(a.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseInt(c[1],10)||0,offsetY:parseInt(c[2],10)||0,blur:parseInt(c[3],10)||0}},toString:function(){return[this.offsetX,
this.offsetY,this.blur,this.color].join("px ")},toSVG:function(a){var c="SourceAlpha",b=40,h=40;if(a&&(a.fill===this.color||a.stroke===this.color))c="SourceGraphic";a.width&&a.height&&(b=Math.abs(this.offsetX/a.getWidth())*100+20,h=Math.abs(this.offsetY/a.getHeight())*100+20);return'<filter id="SVGID_'+this.id+'" y="-'+h+'%" height="'+(100+2*h)+'%" x="-'+b+'%" width="'+(100+2*b)+'%" >\n\t<feGaussianBlur in="'+c+'" stdDeviation="'+(this.blur?this.blur/3:0)+'"></feGaussianBlur>\n\t<feOffset dx="'+this.offsetX+
'" dy="'+this.offsetY+'"></feOffset>\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY};var f={},c=a.Shadow.prototype;if(this.color!==c.color)f.color=this.color;if(this.blur!==c.blur)f.blur=this.blur;if(this.offsetX!==c.offsetX)f.offsetX=this.offsetX;if(this.offsetY!==c.offsetY)f.offsetY=this.offsetY;
return f}}),a.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)})(typeof m!=="undefined"?m:this);(function(){if(g.StaticCanvas)g.warn("fabric.StaticCanvas is already defined.");else{var d=g.util.object.extend,a=g.util.getElementOffset,f=g.util.removeFromArray,c=Error("Could not initialize `canvas` element");g.StaticCanvas=g.util.createClass({initialize:function(b,a){a||(a={});this._initStatic(b,a);g.StaticCanvas.activeInstance=this},
backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,preserveObjectStacking:!1,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},_initStatic:function(b,a){this._objects=[];this._createLowerCanvas(b);this._initOptions(a);this._setImageSmoothing();a.overlayImage&&this.setOverlayImage(a.overlayImage,this.renderAll.bind(this));
a.backgroundImage&&this.setBackgroundImage(a.backgroundImage,this.renderAll.bind(this));a.backgroundColor&&this.setBackgroundColor(a.backgroundColor,this.renderAll.bind(this));a.overlayColor&&this.setOverlayColor(a.overlayColor,this.renderAll.bind(this));this.calcOffset()},calcOffset:function(){this._offset=a(this.lowerCanvasEl);return this},setOverlayImage:function(b,a,e){return this.__setBgOverlayImage("overlayImage",b,a,e)},setBackgroundImage:function(b,a,e){return this.__setBgOverlayImage("backgroundImage",
b,a,e)},setOverlayColor:function(b,a){return this.__setBgOverlayColor("overlayColor",b,a)},setBackgroundColor:function(b,a){return this.__setBgOverlayColor("backgroundColor",b,a)},_setImageSmoothing:function(){var b=this.getContext();b.imageSmoothingEnabled=this.imageSmoothingEnabled;b.webkitImageSmoothingEnabled=this.imageSmoothingEnabled;b.mozImageSmoothingEnabled=this.imageSmoothingEnabled;b.msImageSmoothingEnabled=this.imageSmoothingEnabled;b.oImageSmoothingEnabled=this.imageSmoothingEnabled},
__setBgOverlayImage:function(b,a,e,c){typeof a==="string"?g.util.loadImage(a,function(a){this[b]=new g.Image(a,c);e&&e()},this,c&&c.crossOrigin):(this[b]=a,e&&e());return this},__setBgOverlayColor:function(b,a,e){if(a&&a.source){var c=this;g.util.loadImage(a.source,function(f){c[b]=new g.Pattern({source:f,repeat:a.repeat,offsetX:a.offsetX,offsetY:a.offsetY});e&&e()})}else this[b]=a,e&&e();return this},_createCanvasElement:function(){var b=g.document.createElement("canvas");if(!b.style)b.style={};
if(!b)throw c;this._initCanvasElement(b);return b},_initCanvasElement:function(b){g.util.createCanvasElement(b);if(typeof b.getContext==="undefined")throw c;},_initOptions:function(b){for(var a in b)this[a]=b[a];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;if(this.lowerCanvasEl.style)this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=
this.height+"px",this.viewportTransform=this.viewportTransform.slice()},_createLowerCanvas:function(b){this.lowerCanvasEl=g.util.getById(b)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);g.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(b,a){return this.setDimensions({width:b},
a)},setHeight:function(b,a){return this.setDimensions({height:b},a)},setDimensions:function(b,a){var e,a=a||{},c;for(c in b)e=b[c],a.cssOnly||(this._setBackstoreDimension(c,b[c]),e+="px"),a.backstoreOnly||this._setCssDimension(c,e);a.cssOnly||this.renderAll();this.calcOffset();return this},_setBackstoreDimension:function(b,a){this.lowerCanvasEl[b]=a;this.upperCanvasEl&&(this.upperCanvasEl[b]=a);this.cacheCanvasEl&&(this.cacheCanvasEl[b]=a);this[b]=a;return this},_setCssDimension:function(b,a){this.lowerCanvasEl.style[b]=
a;this.upperCanvasEl&&(this.upperCanvasEl.style[b]=a);this.wrapperEl&&(this.wrapperEl.style[b]=a);return this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(b){this.viewportTransform=b;this.renderAll();for(var b=0,a=this._objects.length;b<a;b++)this._objects[b].setCoords();return this},zoomToPoint:function(b,a){var e=b,b=g.util.transformPoint(b,g.util.invertTransform(this.viewportTransform));this.viewportTransform[0]=a;this.viewportTransform[3]=
a;var c=g.util.transformPoint(b,this.viewportTransform);this.viewportTransform[4]+=e.x-c.x;this.viewportTransform[5]+=e.y-c.y;this.renderAll();e=0;for(c=this._objects.length;e<c;e++)this._objects[e].setCoords();return this},setZoom:function(b){this.zoomToPoint(new g.Point(0,0),b);return this},absolutePan:function(b){this.viewportTransform[4]=-b.x;this.viewportTransform[5]=-b.y;this.renderAll();for(var b=0,a=this._objects.length;b<a;b++)this._objects[b].setCoords();return this},relativePan:function(b){return this.absolutePan(new g.Point(-b.x-
this.viewportTransform[4],-b.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(b,a){if(a){b.save();var e=this.viewportTransform;b.transform(e[0],e[1],e[2],e[3],e[4],e[5]);this._shouldRenderObject(a)&&a.render(b);b.restore();this.controlsAboveOverlay||a._renderControls(b)}},_shouldRenderObject:function(b){return!b?!1:b!==this.getActiveGroup()||!this.preserveObjectStacking},_onObjectAdded:function(b){this.stateful&&
b.setupState();b.canvas=this;b.setCoords();this.fire("object:added",{target:b});b.fire("added")},_onObjectRemoved:function(b){this.getActiveObject()===b&&(this.fire("before:selection:cleared",{target:b}),this._discardActiveObject(),this.fire("selection:cleared"));this.fire("object:removed",{target:b});b.fire("removed")},clearContext:function(b){b.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;this.discardActiveGroup&&
this.discardActiveGroup();this.discardActiveObject&&this.discardActiveObject();this.clearContext(this.contextContainer);this.contextTop&&this.clearContext(this.contextTop);this.fire("canvas:cleared");this.renderAll();return this},renderAll:function(b){var a=this[b===!0&&this.interactive?"contextTop":"contextContainer"],e=this.getActiveGroup();this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop);b||this.clearContext(a);this.fire("before:render");this.clipTo&&g.util.clipContext(this,
a);this._renderBackground(a);this._renderObjects(a,e);this._renderActiveGroup(a,e);this.clipTo&&a.restore();this._renderOverlay(a);this.controlsAboveOverlay&&this.interactive&&this.drawControls(a);this.fire("after:render");return this},_renderObjects:function(b,a){var e,c;if(!a||this.preserveObjectStacking)for(e=0,c=this._objects.length;e<c;++e)this._draw(b,this._objects[e]);else for(e=0,c=this._objects.length;e<c;++e)this._objects[e]&&!a.contains(this._objects[e])&&this._draw(b,this._objects[e])},
_renderActiveGroup:function(b,a){if(a){var e=[];this.forEachObject(function(b){a.contains(b)&&e.push(b)});a._set("objects",e);this._draw(b,a)}},_renderBackground:function(b){if(this.backgroundColor)b.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(b):this.backgroundColor,b.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height);this.backgroundImage&&this._draw(b,this.backgroundImage)},_renderOverlay:function(b){if(this.overlayColor)b.fillStyle=
this.overlayColor.toLive?this.overlayColor.toLive(b):this.overlayColor,b.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height);this.overlayImage&&this._draw(b,this.overlayImage)},renderTop:function(){var b=this.contextTop||this.contextContainer;this.clearContext(b);this.selection&&this._groupSelector&&this._drawSelection();var a=this.getActiveGroup();a&&a.render(b);this._renderOverlay(b);this.fire("after:render");return this},getCenter:function(){return{top:this.getHeight()/
2,left:this.getWidth()/2}},centerObjectH:function(b){this._centerObject(b,new g.Point(this.getCenter().left,b.getCenterPoint().y));this.renderAll();return this},centerObjectV:function(b){this._centerObject(b,new g.Point(b.getCenterPoint().x,this.getCenter().top));this.renderAll();return this},centerObject:function(b){var a=this.getCenter();this._centerObject(b,new g.Point(a.left,a.top));this.renderAll();return this},_centerObject:function(b,a){b.setPositionByOrigin(a,"center","center");return this},
toDatalessJSON:function(b){return this.toDatalessObject(b)},toObject:function(b){return this._toObjectMethod("toObject",b)},toDatalessObject:function(b){return this._toObjectMethod("toDatalessObject",b)},_toObjectMethod:function(b,a){var e=this.getActiveGroup();e&&this.discardActiveGroup();var c={objects:this._toObjects(b,a)};d(c,this.__serializeBgOverlay());g.util.populateWithProperties(this,c,a);if(e&&(this.setActiveGroup(new g.Group(e.getObjects(),{originX:"center",originY:"center"})),e.forEachObject(function(b){b.set("active",
!0)}),this._currentTransform))this._currentTransform.target=this.getActiveGroup();return c},_toObjects:function(b,a){return this.getObjects().map(function(e){return this._toObject(e,b,a)},this)},_toObject:function(b,a,e){var c;if(!this.includeDefaultValues)c=b.includeDefaultValues,b.includeDefaultValues=!1;a=b[a](e);if(!this.includeDefaultValues)b.includeDefaultValues=c;return a},__serializeBgOverlay:function(){var b={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():
this.backgroundColor};if(this.overlayColor)b.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor;if(this.backgroundImage)b.backgroundImage=this.backgroundImage.toObject();if(this.overlayImage)b.overlayImage=this.overlayImage.toObject();return b},svgViewportTransformation:!0,toSVG:function(b,a){b||(b={});var e=[];this._setSVGPreamble(e,b);this._setSVGHeader(e,b);this._setSVGBgOverlayColor(e,"backgroundColor");this._setSVGBgOverlayImage(e,"backgroundImage");this._setSVGObjects(e,
a);this._setSVGBgOverlayColor(e,"overlayColor");this._setSVGBgOverlayImage(e,"overlayImage");e.push("</svg>");return e.join("")},_setSVGPreamble:function(b,a){a.suppressPreamble||b.push('<?xml version="1.0" encoding="',a.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(b,a){var e,c,f;if(a.viewBox)e=a.viewBox.width,c=a.viewBox.height;else if(e=this.width,c=this.height,!this.svgViewportTransformation)f=
this.viewportTransform,e/=f[0],c/=f[3];b.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',e,'" ','height="',c,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,a.viewBox?'viewBox="'+a.viewBox.x+" "+a.viewBox.y+" "+a.viewBox.width+" "+a.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",g.version,"</desc>","<defs>",g.createSVGFontFacesMarkup(this.getObjects()),
g.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(b,a){var e=this.getActiveGroup();e&&this.discardActiveGroup();for(var c=0,f=this.getObjects(),d=f.length;c<d;c++)b.push(f[c].toSVG(a));e&&(this.setActiveGroup(new g.Group(e.getObjects())),e.forEachObject(function(b){b.set("active",!0)}))},_setSVGBgOverlayImage:function(b,a){this[a]&&this[a].toSVG&&b.push(this[a].toSVG())},_setSVGBgOverlayColor:function(b,a){this[a]&&this[a].source?b.push('<rect x="',this[a].offsetX,'" y="',this[a].offsetY,
'" ','width="',this[a].repeat==="repeat-y"||this[a].repeat==="no-repeat"?this[a].source.width:this.width,'" height="',this[a].repeat==="repeat-x"||this[a].repeat==="no-repeat"?this[a].source.height:this.height,'" fill="url(#'+a+'Pattern)"',"></rect>"):this[a]&&a==="overlayColor"&&b.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[a],'"',"></rect>")},sendToBack:function(a){f(this._objects,a);this._objects.unshift(a);return this.renderAll&&this.renderAll()},bringToFront:function(a){f(this._objects,
a);this._objects.push(a);return this.renderAll&&this.renderAll()},sendBackwards:function(a,c){var e=this._objects.indexOf(a);e!==0&&(e=this._findNewLowerIndex(a,e,c),f(this._objects,a),this._objects.splice(e,0,a),this.renderAll&&this.renderAll());return this},_findNewLowerIndex:function(a,c,e){if(e){e=c;for(c-=1;c>=0;--c)if(a.intersectsWithObject(this._objects[c])||a.isContainedWithinObject(this._objects[c])||this._objects[c].isContainedWithinObject(a)){e=c;break}}else e=c-1;return e},bringForward:function(a,
c){var e=this._objects.indexOf(a);e!==this._objects.length-1&&(e=this._findNewUpperIndex(a,e,c),f(this._objects,a),this._objects.splice(e,0,a),this.renderAll&&this.renderAll());return this},_findNewUpperIndex:function(a,c,e){if(e){e=c;for(c+=1;c<this._objects.length;++c)if(a.intersectsWithObject(this._objects[c])||a.isContainedWithinObject(this._objects[c])||this._objects[c].isContainedWithinObject(a)){e=c;break}}else e=c+1;return e},moveTo:function(a,c){f(this._objects,a);this._objects.splice(c,
0,a);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();this.interactive&&this.removeListeners();return this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});d(g.StaticCanvas.prototype,g.Observable);d(g.StaticCanvas.prototype,g.Collection);d(g.StaticCanvas.prototype,g.DataURLExporter);d(g.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var c=g.util.createCanvasElement();
if(!c||!c.getContext)return null;var e=c.getContext("2d");if(!e)return null;switch(a){case "getImageData":return typeof e.getImageData!=="undefined";case "setLineDash":return typeof e.setLineDash!=="undefined";case "toDataURL":return typeof c.toDataURL!=="undefined";case "toDataURLWithQuality":try{return c.toDataURL("image/jpeg",0),!0}catch(f){}return!1;default:return null}}});g.StaticCanvas.prototype.toJSON=g.StaticCanvas.prototype.toObject}})();g.BaseBrush=g.util.createClass({color:"rgb(0, 0, 0)",
width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",setShadow:function(d){this.shadow=new g.Shadow(d);return this},_setBrushStyles:function(){var d=this.canvas.contextTop;d.strokeStyle=this.color;d.lineWidth=this.width;d.lineCap=this.strokeLineCap;d.lineJoin=this.strokeLineJoin},_setShadow:function(){if(this.shadow){var d=this.canvas.contextTop;d.shadowColor=this.shadow.color;d.shadowBlur=this.shadow.blur;d.shadowOffsetX=this.shadow.offsetX;d.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var d=
this.canvas.contextTop;d.shadowColor="";d.shadowBlur=d.shadowOffsetX=d.shadowOffsetY=0}});(function(){g.PencilBrush=g.util.createClass(g.BaseBrush,{initialize:function(d){this.canvas=d;this._points=[]},onMouseDown:function(d){this._prepareForDrawing(d);this._captureDrawingPath(d);this._render()},onMouseMove:function(d){this._captureDrawingPath(d);this.canvas.clearContext(this.canvas.contextTop);this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(d){d=new g.Point(d.x,
d.y);this._reset();this._addPoint(d);this.canvas.contextTop.moveTo(d.x,d.y)},_addPoint:function(d){this._points.push(d)},_reset:function(){this._points.length=0;this._setBrushStyles();this._setShadow()},_captureDrawingPath:function(d){this._addPoint(new g.Point(d.x,d.y))},_render:function(){var d=this.canvas.contextTop,a=this.canvas.viewportTransform,f=this._points[0],c=this._points[1];d.save();d.transform(a[0],a[1],a[2],a[3],a[4],a[5]);d.beginPath();this._points.length===2&&f.x===c.x&&f.y===c.y&&
(f.x-=0.5,c.x+=0.5);d.moveTo(f.x,f.y);for(var a=1,b=this._points.length;a<b;a++)c=f.midPointFrom(c),d.quadraticCurveTo(f.x,f.y,c.x,c.y),f=this._points[a],c=this._points[a+1];d.lineTo(f.x,f.y);d.stroke();d.restore()},convertPointsToSVGPath:function(d){var a=[],f=new g.Point(d[0].x,d[0].y),c=new g.Point(d[1].x,d[1].y);a.push("M ",d[0].x," ",d[0].y," ");for(var b=1,h=d.length;b<h;b++){var e=f.midPointFrom(c);a.push("Q ",f.x," ",f.y," ",e.x," ",e.y," ");f=new g.Point(d[b].x,d[b].y);b+1<d.length&&(c=new g.Point(d[b+
1].x,d[b+1].y))}a.push("L ",f.x," ",f.y," ");return a},createPath:function(d){d=new g.Path(d,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,originX:"center",originY:"center"});if(this.shadow)this.shadow.affectStroke=!0,d.setShadow(this.shadow);return d},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var d=this.convertPointsToSVGPath(this._points).join("");d==="M 0 0 Q 0 0 0 0 L 0 0"?this.canvas.renderAll():
(d=this.createPath(d),this.canvas.add(d),d.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:d}))}})})();g.CircleBrush=g.util.createClass(g.BaseBrush,{width:10,initialize:function(d){this.canvas=d;this.points=[]},drawDot:function(d){var d=this.addPoint(d),a=this.canvas.contextTop,f=this.canvas.viewportTransform;a.save();a.transform(f[0],f[1],f[2],f[3],f[4],f[5]);a.fillStyle=d.fill;a.beginPath();a.arc(d.x,
d.y,d.radius,0,Math.PI*2,!1);a.closePath();a.fill();a.restore()},onMouseDown:function(d){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(d)},onMouseMove:function(d){this.drawDot(d)},onMouseUp:function(){var d=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var a=[],f=0,c=this.points.length;f<c;f++){var b=this.points[f],b=new g.Circle({radius:b.radius,left:b.x,top:b.y,originX:"center",originY:"center",fill:b.fill});this.shadow&&
b.setShadow(this.shadow);a.push(b)}a=new g.Group(a,{originX:"center",originY:"center"});a.canvas=this.canvas;this.canvas.add(a);this.canvas.fire("path:created",{path:a});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=d;this.canvas.renderAll()},addPoint:function(d){var d=new g.Point(d.x,d.y),a=g.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,f=(new g.Color(this.color)).setAlpha(g.util.getRandomInt(0,100)/100).toRgba();d.radius=a;d.fill=
f;this.points.push(d);return d}});g.SprayBrush=g.util.createClass(g.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(d){this.canvas=d;this.sprayChunks=[]},onMouseDown:function(d){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(d);this.render()},onMouseMove:function(d){this.addSprayChunk(d);this.render()},onMouseUp:function(){var d=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=
!1;for(var a=[],f=0,c=this.sprayChunks.length;f<c;f++)for(var b=this.sprayChunks[f],h=0,e=b.length;h<e;h++){var j=new g.Rect({width:b[h].width,height:b[h].width,left:b[h].x+1,top:b[h].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&j.setShadow(this.shadow);a.push(j)}this.optimizeOverlapping&&(a=this._getOptimizedRects(a));a=new g.Group(a,{originX:"center",originY:"center"});a.canvas=this.canvas;this.canvas.add(a);this.canvas.fire("path:created",{path:a});this.canvas.clearContext(this.canvas.contextTop);
this._resetShadow();this.canvas.renderOnAddRemove=d;this.canvas.renderAll()},_getOptimizedRects:function(d){for(var a={},f,c=0,b=d.length;c<b;c++)f=d[c].left+""+d[c].top,a[f]||(a[f]=d[c]);d=[];for(f in a)d.push(a[f]);return d},render:function(){var d=this.canvas.contextTop;d.fillStyle=this.color;var a=this.canvas.viewportTransform;d.save();d.transform(a[0],a[1],a[2],a[3],a[4],a[5]);for(var a=0,f=this.sprayChunkPoints.length;a<f;a++){var c=this.sprayChunkPoints[a];if(typeof c.opacity!=="undefined")d.globalAlpha=
c.opacity;d.fillRect(c.x,c.y,c.width,c.width)}d.restore()},addSprayChunk:function(d){this.sprayChunkPoints=[];for(var a,f,c,b=this.width/2,h=0;h<this.density;h++){a=g.util.getRandomInt(d.x-b,d.x+b);f=g.util.getRandomInt(d.y-b,d.y+b);c=this.dotWidthVariance?g.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;a=new g.Point(a,f);a.width=c;if(this.randomOpacity)a.opacity=g.util.getRandomInt(0,100)/100;this.sprayChunkPoints.push(a)}this.sprayChunks.push(this.sprayChunkPoints)}});
g.PatternBrush=g.util.createClass(g.PencilBrush,{getPatternSrc:function(){var d=g.document.createElement("canvas"),a=d.getContext("2d");d.width=d.height=25;a.fillStyle=this.color;a.beginPath();a.arc(10,10,10,0,Math.PI*2,!1);a.closePath();a.fill();return d},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles");
this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(d){d=this.callSuper("createPath",d);d.stroke=new g.Pattern({source:this.source||this.getPatternSrcFunction()});return d}});(function(){var d=g.util.getPointer,a=g.util.degreesToRadians,f=g.util.radiansToDegrees,c=Math.atan2,b=Math.abs;g.Canvas=g.util.createClass(g.StaticCanvas,{initialize:function(a,b){b||(b={});this._initStatic(a,b);this._initInteractive();this._createCacheCanvas();g.Canvas.activeInstance=this},uniScaleTransform:!1,
centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._groupSelector=this._currentTransform=null;this._initWrapperElement();
this._createUpperCanvas();this._initEventListeners();this.freeDrawingBrush=g.PencilBrush&&new g.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(a){var b=this._currentTransform;b.target.set({scaleX:b.original.scaleX,scaleY:b.original.scaleY,left:b.original.left,top:b.original.top});if(this._shouldCenterTransform(a,b.target))if(b.action==="rotate")this._setOriginToCenter(b.target);else{if(b.originX!=="center")b.mouseXSign=b.originX==="right"?-1:1;if(b.originY!=="center")b.mouseYSign=
b.originY==="bottom"?-1:1;b.originX="center";b.originY="center"}else b.originX=b.original.originX,b.originY=b.original.originY},containsPoint:function(a,b){var c=this.getPointer(a,!0),f=this._normalizePointer(b,c);return b.containsPoint(f)||b._findTargetCorner(c)},_normalizePointer:function(a,b){var c=this.getActiveGroup(),f=b.x,d=b.y;c&&a.type!=="group"&&c.contains(a)&&(c=new g.Point(c.left,c.top),c=g.util.transformPoint(c,this.viewportTransform,!0),f-=c.x,d-=c.y);return{x:f,y:d}},isTargetTransparent:function(a,
b,c){var f=a.hasBorders,d=a.transparentCorners;a.hasBorders=a.transparentCorners=!1;this._draw(this.contextCache,a);a.hasBorders=f;a.transparentCorners=d;a=g.util.isTransparent(this.contextCache,b,c,this.targetFindTolerance);this.clearContext(this.contextCache);return a},_shouldClearSelection:function(a,b){var c=this.getActiveGroup(),f=this.getActiveObject();return!b||b&&c&&!c.contains(b)&&c!==b&&!a.shiftKey||b&&!b.evented||b&&!b.selectable&&f&&f!==b},_shouldCenterTransform:function(a,b){if(b){var c=
this._currentTransform,f;c.action==="scale"||c.action==="scaleX"||c.action==="scaleY"?f=this.centeredScaling||b.centeredScaling:c.action==="rotate"&&(f=this.centeredRotation||b.centeredRotation);return f?!a.altKey:a.altKey}},_getOriginFromCorner:function(a,b){var c={x:a.originX,y:a.originY};if(b==="ml"||b==="tl"||b==="bl")c.x="right";else if(b==="mr"||b==="tr"||b==="br")c.x="left";if(b==="tl"||b==="mt"||b==="tr")c.y="bottom";else if(b==="bl"||b==="mb"||b==="br")c.y="top";return c},_getActionFromCorner:function(a,
b){var c="drag";b&&(c=b==="ml"||b==="mr"?"scaleX":b==="mt"||b==="mb"?"scaleY":b==="mtr"?"rotate":"scale");return c},_setupCurrentTransform:function(b,c){if(c){var f=this.getPointer(b),d=c._findTargetCorner(this.getPointer(b,!0)),h=this._getActionFromCorner(c,d),d=this._getOriginFromCorner(c,d);this._currentTransform={target:c,action:h,scaleX:c.scaleX,scaleY:c.scaleY,offsetX:f.x-c.left,offsetY:f.y-c.top,originX:d.x,originY:d.y,ex:f.x,ey:f.y,left:c.left,top:c.top,theta:a(c.angle),width:c.width*c.scaleX,
mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:c.left,top:c.top,scaleX:c.scaleX,scaleY:c.scaleY,originX:d.x,originY:d.y};this._resetCurrentTransform(b)}},_translateObject:function(a,b){var c=this._currentTransform.target;c.get("lockMovementX")||c.set("left",a-this._currentTransform.offsetX);c.get("lockMovementY")||c.set("top",b-this._currentTransform.offsetY)},_scaleObject:function(a,b,c){var f=this._currentTransform,d=f.target,h=d.get("lockScalingX"),p=d.get("lockScalingY"),m=d.get("lockScalingFlip");
if(!h||!p){var x=d.translateToOriginPoint(d.getCenterPoint(),f.originX,f.originY),a=d.toLocalPoint(new g.Point(a,b),f.originX,f.originY);this._setLocalMouse(a,f);this._setObjectScale(a,f,h,p,c,m);d.setPositionByOrigin(x,f.originX,f.originY)}},_setObjectScale:function(a,b,c,f,d,h){var g=b.target,m=!1,x=!1,C=g.stroke?g.strokeWidth:0;b.newScaleX=a.x/(g.width+C/2);b.newScaleY=a.y/(g.height+C/2);h&&b.newScaleX<=0&&b.newScaleX<g.scaleX&&(m=!0);h&&b.newScaleY<=0&&b.newScaleY<g.scaleY&&(x=!0);d==="equally"&&
!c&&!f?m||x||this._scaleObjectEqually(a,g,b):d?d==="x"&&!g.get("lockUniScaling")?m||c||g.set("scaleX",b.newScaleX):d==="y"&&!g.get("lockUniScaling")&&(x||f||g.set("scaleY",b.newScaleY)):(m||c||g.set("scaleX",b.newScaleX),x||f||g.set("scaleY",b.newScaleY));m||x||this._flipObject(b,d)},_scaleObjectEqually:function(a,b,c){var a=a.y+a.x,f=b.stroke?b.strokeWidth:0,f=(b.height+f/2)*c.original.scaleY+(b.width+f/2)*c.original.scaleX;c.newScaleX=c.original.scaleX*a/f;c.newScaleY=c.original.scaleY*a/f;b.set("scaleX",
c.newScaleX);b.set("scaleY",c.newScaleY)},_flipObject:function(a,b){if(a.newScaleX<0&&b!=="y")if(a.originX==="left")a.originX="right";else if(a.originX==="right")a.originX="left";if(a.newScaleY<0&&b!=="x")if(a.originY==="top")a.originY="bottom";else if(a.originY==="bottom")a.originY="top"},_setLocalMouse:function(a,c){var f=c.target;if(c.originX==="right")a.x*=-1;else if(c.originX==="center"&&(a.x*=c.mouseXSign*2,a.x<0))c.mouseXSign=-c.mouseXSign;if(c.originY==="bottom")a.y*=-1;else if(c.originY===
"center"&&(a.y*=c.mouseYSign*2,a.y<0))c.mouseYSign=-c.mouseYSign;b(a.x)>f.padding?a.x<0?a.x+=f.padding:a.x-=f.padding:a.x=0;b(a.y)>f.padding?a.y<0?a.y+=f.padding:a.y-=f.padding:a.y=0},_rotateObject:function(a,b){var d=this._currentTransform;if(!d.target.get("lockRotation")){var h=c(d.ey-d.top,d.ex-d.left),g=c(b-d.top,a-d.left),h=f(g-h+d.theta);h<0&&(h=360+h);d.target.angle=h%360}},setCursor:function(a){this.upperCanvasEl.style.cursor=a},_resetObjectTransform:function(a){a.scaleX=1;a.scaleY=1;a.setAngle(0)},
_drawSelection:function(){var a=this.contextTop,c=this._groupSelector,f=c.left,d=c.top,h=b(f),i=b(d);a.fillStyle=this.selectionColor;a.fillRect(c.ex-(f>0?0:-f),c.ey-(d>0?0:-d),h,i);a.lineWidth=this.selectionLineWidth;a.strokeStyle=this.selectionBorderColor;this.selectionDashArray.length>1?(f=c.ex+0.5-(f>0?0:h),c=c.ey+0.5-(d>0?0:i),a.beginPath(),g.util.drawDashedLine(a,f,c,f+h,c,this.selectionDashArray),g.util.drawDashedLine(a,f,c+i-1,f+h,c+i-1,this.selectionDashArray),g.util.drawDashedLine(a,f,c,
f,c+i,this.selectionDashArray),g.util.drawDashedLine(a,f+h-1,c,f+h-1,c+i,this.selectionDashArray),a.closePath(),a.stroke()):a.strokeRect(c.ex+0.5-(f>0?0:h),c.ey+0.5-(d>0?0:i),h,i)},_isLastRenderedObject:function(a){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(a,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(a,
!0))},findTarget:function(a,b){if(!this.skipTargetFind){if(this._isLastRenderedObject(a))return this.lastRenderedObjectWithControlsAboveOverlay;var c=this.getActiveGroup();if(c&&!b&&this.containsPoint(a,c))return c;c=this._searchPossibleTargets(a);this._fireOverOutEvents(c);return c}},_fireOverOutEvents:function(a){if(a){if(this._hoveredTarget!==a)this.fire("mouse:over",{target:a}),a.fire("mouseover"),this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout")),
this._hoveredTarget=a}else if(this._hoveredTarget)this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null},_checkTarget:function(a,b,c){if(b&&b.visible&&b.evented&&this.containsPoint(a,b))if((this.perPixelTargetFind||b.perPixelTargetFind)&&!b.isEditing){if(!this.isTargetTransparent(b,c.x,c.y))return!0}else return!0},_searchPossibleTargets:function(a){for(var b,c=this.getPointer(a,!0),f=this._objects.length;f--;)if(this._checkTarget(a,this._objects[f],
c)){this.relatedTarget=this._objects[f];b=this._objects[f];break}return b},getPointer:function(a,b,c){var f,h;if(!c)c=this.upperCanvasEl;var a=d(a,c),i=c.getBoundingClientRect(),p=i.width||0,m=i.height||0;if(!p||!m)"top"in i&&"bottom"in i&&(m=Math.abs(i.top-i.bottom)),"right"in i&&"left"in i&&(p=Math.abs(i.right-i.left));this.calcOffset();a.x-=this._offset.left;a.y-=this._offset.top;b||(a=g.util.transformPoint(a,g.util.invertTransform(this.viewportTransform)));p===0||m===0?(f=1,h=1):(f=c.width/p,
h=c.height/m);return{x:a.x*f,y:a.y*h}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();g.util.addClass(this.upperCanvasEl,"upper-canvas "+a);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();
this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=g.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});g.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});g.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var b=this.getWidth()||a.width,
c=this.getHeight()||a.height;g.util.setStyle(a,{position:"absolute",width:b+"px",height:c+"px",left:0,top:0});a.width=b;a.height=c;g.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,b){b.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(a){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=a;a.set("active",!0)},setActiveObject:function(a,b){this._setActiveObject(a);
this.renderAll();this.fire("object:selected",{target:a,e:b});a.fire("selected",{e:b});return this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=null},discardActiveObject:function(a){this._discardActiveObject();this.renderAll();this.fire("selection:cleared",{e:a});return this},_setActiveGroup:function(a){(this._activeGroup=a)&&a.set("active",!0)},setActiveGroup:function(a,b){this._setActiveGroup(a);
a&&(this.fire("object:selected",{target:a,e:b}),a.fire("selected",{e:b}));return this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var a=this.getActiveGroup();a&&a.destroy();this.setActiveGroup(null)},discardActiveGroup:function(a){this._discardActiveGroup();this.fire("selection:cleared",{e:a});return this},deactivateAll:function(){for(var a=this.getObjects(),b=0,c=a.length;b<c;b++)a[b].set("active",!1);this._discardActiveGroup();this._discardActiveObject();
return this},deactivateAllWithDispatch:function(a){var b=this.getActiveGroup()||this.getActiveObject();b&&this.fire("before:selection:cleared",{target:b,e:a});this.deactivateAll();b&&this.fire("selection:cleared",{e:a});return this},drawControls:function(a){var b=this.getActiveGroup();b?this._drawGroupControls(a,b):this._drawObjectsControls(a)},_drawGroupControls:function(a,b){b._renderControls(a)},_drawObjectsControls:function(a){for(var b=0,c=this._objects.length;b<c;++b)if(this._objects[b]&&this._objects[b].active)this._objects[b]._renderControls(a),
this.lastRenderedObjectWithControlsAboveOverlay=this._objects[b]}});for(var h in g.StaticCanvas)h!=="prototype"&&(g.Canvas[h]=g.StaticCanvas[h]);if(g.isTouchSupported)g.Canvas.prototype._setCursorFromEvent=function(){};g.Element=g.Canvas})();(function(){var d={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},a=g.util.addListener,f=g.util.removeListener;g.util.object.extend(g.Canvas.prototype,{cursorMap:"n-resize,ne-resize,e-resize,se-resize,s-resize,sw-resize,w-resize,nw-resize".split(","),_initEventListeners:function(){this._bindEvents();
a(g.window,"resize",this._onResize);a(this.upperCanvasEl,"mousedown",this._onMouseDown);a(this.upperCanvasEl,"mousemove",this._onMouseMove);a(this.upperCanvasEl,"mousewheel",this._onMouseWheel);a(this.upperCanvasEl,"touchstart",this._onMouseDown);a(this.upperCanvasEl,"touchmove",this._onMouseMove);typeof Event!=="undefined"&&"add"in Event&&(Event.add(this.upperCanvasEl,"gesture",this._onGesture),Event.add(this.upperCanvasEl,"drag",this._onDrag),Event.add(this.upperCanvasEl,"orientation",this._onOrientationChange),
Event.add(this.upperCanvasEl,"shake",this._onShake),Event.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onLongPress=this._onLongPress.bind(this);this._onOrientationChange=
this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){f(g.window,"resize",this._onResize);f(this.upperCanvasEl,"mousedown",this._onMouseDown);f(this.upperCanvasEl,"mousemove",this._onMouseMove);f(this.upperCanvasEl,"mousewheel",this._onMouseWheel);f(this.upperCanvasEl,"touchstart",this._onMouseDown);f(this.upperCanvasEl,"touchmove",this._onMouseMove);typeof Event!=="undefined"&&"remove"in Event&&(Event.remove(this.upperCanvasEl,"gesture",
this._onGesture),Event.remove(this.upperCanvasEl,"drag",this._onDrag),Event.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.remove(this.upperCanvasEl,"shake",this._onShake),Event.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(a,b){this.__onTransformGesture&&this.__onTransformGesture(a,b)},_onDrag:function(a,b){this.__onDrag&&this.__onDrag(a,b)},_onMouseWheel:function(a,b){this.__onMouseWheel&&this.__onMouseWheel(a,b)},_onOrientationChange:function(a,
b){this.__onOrientationChange&&this.__onOrientationChange(a,b)},_onShake:function(a,b){this.__onShake&&this.__onShake(a,b)},_onLongPress:function(a,b){this.__onLongPress&&this.__onLongPress(a,b)},_onMouseDown:function(c){this.__onMouseDown(c);a(g.document,"touchend",this._onMouseUp);a(g.document,"touchmove",this._onMouseMove);f(this.upperCanvasEl,"mousemove",this._onMouseMove);f(this.upperCanvasEl,"touchmove",this._onMouseMove);c.type==="touchstart"?f(this.upperCanvasEl,"mousedown",this._onMouseDown):
(a(g.document,"mouseup",this._onMouseUp),a(g.document,"mousemove",this._onMouseMove))},_onMouseUp:function(c){this.__onMouseUp(c);f(g.document,"mouseup",this._onMouseUp);f(g.document,"touchend",this._onMouseUp);f(g.document,"mousemove",this._onMouseMove);f(g.document,"touchmove",this._onMouseMove);a(this.upperCanvasEl,"mousemove",this._onMouseMove);a(this.upperCanvasEl,"touchmove",this._onMouseMove);if(c.type==="touchend"){var b=this;setTimeout(function(){a(b.upperCanvasEl,"mousedown",b._onMouseDown)},
400)}},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault();this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a,b){var f=this.getActiveGroup()||this.getActiveObject();return!!(a&&(a.isMoving||a!==f)||!a&&f||!a&&!f&&!this._groupSelector||b&&this._previousPointer&&this.selection&&(b.x!==this._previousPointer.x||b.y!==this._previousPointer.y))},__onMouseUp:function(a){var b;if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(a);
else{this._currentTransform?(this._finalizeCurrentTransform(),b=this._currentTransform.target):b=this.findTarget(a,!0);var f=this._shouldRender(b,this.getPointer(a));this._maybeGroupObjects(a);if(b)b.isMoving=!1;f&&this.renderAll();this._handleCursorAndEvent(a,b)}},_handleCursorAndEvent:function(a,b){this._setCursorFromEvent(a,b);var f=this;setTimeout(function(){f._setCursorFromEvent(a,b)},50);this.fire("mouse:up",{target:b,e:a});b&&b.fire("mouseup",{e:a})},_finalizeCurrentTransform:function(){var a=
this._currentTransform.target;if(a._scaling)a._scaling=!1;a.setCoords();this.stateful&&a.hasStateChanged()&&(this.fire("object:modified",{target:a}),a.fire("modified"));this._restoreOriginXY(a)},_restoreOriginXY:function(a){if(this._previousOriginX&&this._previousOriginY){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;a.originY=this._previousOriginY;a.left=b.x;a.top=b.y;this._previousOriginY=this._previousOriginX=null}},
_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0;this.discardActiveObject(a).renderAll();this.clipTo&&g.util.clipContext(this,this.contextTop);var b=g.util.invertTransform(this.viewportTransform);this.freeDrawingBrush.onMouseDown(g.util.transformPoint(this.getPointer(a,!0),b));this.fire("mouse:down",{e:a});b=this.findTarget(a);typeof b!=="undefined"&&b.fire("mousedown",{e:a,target:b})},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var b=g.util.invertTransform(this.viewportTransform);
this.freeDrawingBrush.onMouseMove(g.util.transformPoint(this.getPointer(a,!0),b))}this.setCursor(this.freeDrawingCursor);this.fire("mouse:move",{e:a});b=this.findTarget(a);typeof b!=="undefined"&&b.fire("mousemove",{e:a,target:b})},_onMouseUpInDrawingMode:function(a){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:a});var b=this.findTarget(a);typeof b!=="undefined"&&b.fire("mouseup",{e:a,target:b})},__onMouseDown:function(a){if(("which"in
a?a.which===1:a.button===1)||g.isTouchSupported)if(this.isDrawingMode)this._onMouseDownInDrawingMode(a);else if(!this._currentTransform){var b=this.findTarget(a),f=this.getPointer(a,!0);this._previousPointer=f;var e=this._shouldRender(b,f),d=this._shouldGroup(a,b);this._shouldClearSelection(a,b)?this._clearSelection(a,b,f):d&&(this._handleGrouping(a,b),b=this.getActiveGroup());b&&b.selectable&&!d&&(this._beforeTransform(a,b),this._setupCurrentTransform(a,b));e&&this.renderAll();this.fire("mouse:down",
{target:b,e:a});b&&b.fire("mousedown",{e:a})}},_beforeTransform:function(a,b){this.stateful&&b.saveState();if(b._findTargetCorner(this.getPointer(a)))this.onBeforeScaleRotate(b);b!==this.getActiveGroup()&&b!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(b,a))},_clearSelection:function(a,b,f){this.deactivateAllWithDispatch(a);if(b&&b.selectable)this.setActiveObject(b,a);else if(this.selection)this._groupSelector={ex:f.x,ey:f.y,top:0,left:0}},_setOriginToCenter:function(a){this._previousOriginX=
this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var b=a.getCenterPoint();a.originX="center";a.originY="center";a.left=b.x;a.top=b.y;this._currentTransform.left=a.left;this._currentTransform.top=a.top},_setCenterToOrigin:function(a){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;a.originY=this._previousOriginY;a.left=b.x;a.top=b.y;this._previousOriginY=this._previousOriginX=
null},__onMouseMove:function(a){var b,f;if(this.isDrawingMode)this._onMouseMoveInDrawingMode(a);else if(!(typeof a.touches!=="undefined"&&a.touches.length>1)){var e=this._groupSelector;e?(f=this.getPointer(a,!0),e.left=f.x-e.ex,e.top=f.y-e.ey,this.renderTop()):this._currentTransform?this._transformObject(a):(b=this.findTarget(a),!b||b&&!b.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(a,b));this.fire("mouse:move",{target:b,e:a});b&&b.fire("mousemove",{e:a})}},_transformObject:function(a){var b=
this.getPointer(a),f=this._currentTransform;f.reset=!1;f.target.isMoving=!0;this._beforeScaleTransform(a,f);this._performTransformAction(a,f,b);this.renderAll()},_performTransformAction:function(a,b,f){var e=f.x,f=f.y,d=b.target,g=b.action;g==="rotate"?(this._rotateObject(e,f),this._fire("rotating",d,a)):g==="scale"?(this._onScale(a,b,e,f),this._fire("scaling",d,a)):g==="scaleX"?(this._scaleObject(e,f,"x"),this._fire("scaling",d,a)):g==="scaleY"?(this._scaleObject(e,f,"y"),this._fire("scaling",d,
a)):(this._translateObject(e,f),this._fire("moving",d,a),this.setCursor(this.moveCursor))},_fire:function(a,b,f){this.fire("object:"+a,{target:b,e:f});b.fire(a,{e:f})},_beforeScaleTransform:function(a,b){if(b.action==="scale"||b.action==="scaleX"||b.action==="scaleY"){var f=this._shouldCenterTransform(a,b.target);if(f&&(b.originX!=="center"||b.originY!=="center")||!f&&b.originX==="center"&&b.originY==="center")this._resetCurrentTransform(a),b.reset=!0}},_onScale:function(a,b,f,e){(a.shiftKey||this.uniScaleTransform)&&
!b.target.get("lockUniScaling")?(b.currentAction="scale",this._scaleObject(f,e)):(!b.reset&&b.currentAction==="scale"&&this._resetCurrentTransform(a,b.target),b.currentAction="scaleEqually",this._scaleObject(f,e,"equally"))},_setCursorFromEvent:function(a,b){if(!b||!b.selectable)return this.setCursor(this.defaultCursor),!1;else{var f=this.getActiveGroup();(f=b._findTargetCorner&&(!f||!f.contains(b))&&b._findTargetCorner(this.getPointer(a,!0)))?this._setCornerCursor(f,b):this.setCursor(b.hoverCursor||
this.hoverCursor)}return!0},_setCornerCursor:function(a,b){if(a in d)this.setCursor(this._getRotatedCornerCursor(a,b));else if(a==="mtr"&&b.hasRotatingPoint)this.setCursor(this.rotationCursor);else return this.setCursor(this.defaultCursor),!1},_getRotatedCornerCursor:function(a,b){var f=Math.round(b.getAngle()%360/45);f<0&&(f+=8);f+=d[a];f%=8;return this.cursorMap[f]}})})();(function(){var d=Math.min,a=Math.max;g.util.object.extend(g.Canvas.prototype,{_shouldGroup:function(a,c){var b=this.getActiveObject();
return a.shiftKey&&(this.getActiveGroup()||b&&b!==c)&&this.selection},_handleGrouping:function(a,c){if(c===this.getActiveGroup()&&(c=this.findTarget(a,!0),!c||c.isType("group")))return;this.getActiveGroup()?this._updateActiveGroup(c,a):this._createActiveGroup(c,a);this._activeGroup&&this._activeGroup.saveCoords()},_updateActiveGroup:function(a,c){var b=this.getActiveGroup();if(b.contains(a)){if(b.removeWithUpdate(a),this._resetObjectTransform(b),a.set("active",!1),b.size()===1){this.discardActiveGroup(c);
this.setActiveObject(b.item(0));return}}else b.addWithUpdate(a),this._resetObjectTransform(b);this.fire("selection:created",{target:b,e:c});b.set("active",!0)},_createActiveGroup:function(a,c){if(this._activeObject&&a!==this._activeObject){var b=this._createGroup(a);b.addWithUpdate();this.setActiveGroup(b);this._activeObject=null;this.fire("selection:created",{target:b,e:c})}a.set("active",!0)},_createGroup:function(a){var c=this.getObjects(),a=c.indexOf(this._activeObject)<c.indexOf(a)?[this._activeObject,
a]:[a,this._activeObject];return new g.Group(a,{canvas:this})},_groupSelectedObjects:function(a){var c=this._collectObjects();c.length===1?this.setActiveObject(c[0],a):c.length>1&&(c=new g.Group(c.reverse(),{canvas:this}),c.addWithUpdate(),this.setActiveGroup(c,a),c.saveCoords(),this.fire("selection:created",{target:c}),this.renderAll())},_collectObjects:function(){var f=[],c;c=this._groupSelector.ex;for(var b=this._groupSelector.ey,h=c+this._groupSelector.left,e=b+this._groupSelector.top,j=new g.Point(d(c,
h),d(b,e)),k=new g.Point(a(c,h),a(b,e)),b=c===h&&b===e,h=this._objects.length;h--;)if((c=this._objects[h])&&c.selectable&&c.visible&&(c.intersectsWithRect(j,k)||c.isContainedWithinRect(j,k)||c.containsPoint(j)||c.containsPoint(k)))if(c.set("active",!0),f.push(c),b)break;return f},_maybeGroupObjects:function(a){this.selection&&this._groupSelector&&this._groupSelectedObjects(a);if(a=this.getActiveGroup())a.setObjectsCoords().setCoords(),a.isMoving=!1,this.setCursor(this.defaultCursor);this._currentTransform=
this._groupSelector=null}})})();g.util.object.extend(g.StaticCanvas.prototype,{toDataURL:function(d){d||(d={});var a=d.format||"png",f=d.quality||1,c=d.multiplier||1,d={left:d.left,top:d.top,width:d.width,height:d.height};return c!==1?this.__toDataURLWithMultiplier(a,f,d,c):this.__toDataURL(a,f,d)},__toDataURL:function(d,a,f){this.renderAll(!0);var c=this.upperCanvasEl||this.lowerCanvasEl,f=this.__getCroppedCanvas(c,f);d==="jpg"&&(d="jpeg");d=g.StaticCanvas.supports("toDataURLWithQuality")?(f||c).toDataURL("image/"+
d,a):(f||c).toDataURL("image/"+d);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return d},__getCroppedCanvas:function(d,a){var f,c;if("left"in a||"top"in a||"width"in a||"height"in a)f=g.util.createCanvasElement(),c=f.getContext("2d"),f.width=a.width||this.width,f.height=a.height||this.height,c.drawImage(d,-a.left||0,-a.top||0);return f},__toDataURLWithMultiplier:function(d,a,f,c){var b=this.getWidth(),h=this.getHeight(),e=b*c,g=h*c,k=this.getActiveObject(),l=this.getActiveGroup(),
o=this.contextTop||this.contextContainer;c>1&&this.setWidth(e).setHeight(g);o.scale(c,c);f.left&&(f.left*=c);f.top&&(f.top*=c);if(f.width)f.width*=c;else if(c<1)f.width=e;if(f.height)f.height*=c;else if(c<1)f.height=g;l?this._tempRemoveBordersControlsFromGroup(l):k&&this.deactivateAll&&this.deactivateAll();this.renderAll(!0);d=this.__toDataURL(d,a,f);this.width=b;this.height=h;o.scale(1/c,1/c);this.setWidth(b).setHeight(h);l?this._restoreBordersControlsOnGroup(l):k&&this.setActiveObject&&this.setActiveObject(k);
this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return d},toDataURLWithMultiplier:function(d,a,f){return this.toDataURL({format:d,multiplier:a,quality:f})},_tempRemoveBordersControlsFromGroup:function(d){d.origHasControls=d.hasControls;d.origBorderColor=d.borderColor;d.hasControls=!0;d.borderColor="rgba(0,0,0,0)";d.forEachObject(function(a){a.origBorderColor=a.borderColor;a.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(d){d.hideControls=d.origHideControls;
d.borderColor=d.origBorderColor;d.forEachObject(function(a){a.borderColor=a.origBorderColor;delete a.origBorderColor})}});g.util.object.extend(g.StaticCanvas.prototype,{loadFromDatalessJSON:function(d,a,f){return this.loadFromJSON(d,a,f)},loadFromJSON:function(d,a,f){if(d){var c=typeof d==="string"?JSON.parse(d):d;this.clear();var b=this;this._enlivenObjects(c.objects,function(){b._setBgOverlay(c,a)},f);return this}},_setBgOverlay:function(d,a){var f=this,c={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,
overlayImage:!1};if(!d.backgroundImage&&!d.overlayImage&&!d.background&&!d.overlay)a&&a();else{var b=function(){c.backgroundImage&&c.overlayImage&&c.backgroundColor&&c.overlayColor&&(f.renderAll(),a&&a())};this.__setBgOverlay("backgroundImage",d.backgroundImage,c,b);this.__setBgOverlay("overlayImage",d.overlayImage,c,b);this.__setBgOverlay("backgroundColor",d.background,c,b);this.__setBgOverlay("overlayColor",d.overlay,c,b);b()}},__setBgOverlay:function(d,a,f,c){var b=this;if(a)if(d==="backgroundImage"||
d==="overlayImage")g.Image.fromObject(a,function(a){b[d]=a;f[d]=!0;c&&c()});else this["set"+g.util.string.capitalize(d,!0)](a,function(){f[d]=!0;c&&c()});else f[d]=!0},_enlivenObjects:function(d,a,f){var c=this;if(!d||d.length===0)a&&a();else{var b=this.renderOnAddRemove;this.renderOnAddRemove=!1;g.util.enlivenObjects(d,function(f){f.forEach(function(a,b){c.insertAt(a,b,!0)});c.renderOnAddRemove=b;a&&a()},null,f)}},_toDataURL:function(d,a){this.clone(function(f){a(f.toDataURL(d))})},_toDataURLWithMultiplier:function(d,
a,f){this.clone(function(c){f(c.toDataURLWithMultiplier(d,a))})},clone:function(d,a){var f=JSON.stringify(this.toJSON(a));this.cloneWithoutData(function(a){a.loadFromJSON(f,function(){d&&d(a)})})},cloneWithoutData:function(d){var a=g.document.createElement("canvas");a.width=this.getWidth();a.height=this.getHeight();var f=new g.Canvas(a);f.clipTo=this.clipTo;this.backgroundImage?(f.setBackgroundImage(this.backgroundImage.src,function(){f.renderAll();d&&d(f)}),f.backgroundImageOpacity=this.backgroundImageOpacity,
f.backgroundImageStretch=this.backgroundImageStretch):d&&d(f)}});(function(d){var a=d.fabric||(d.fabric={}),d=a.util.object.extend,f=a.util.toFixed,c=a.util.string.capitalize,b=a.util.degreesToRadians,h=a.StaticCanvas.supports("setLineDash");if(!a.Object)a.Object=a.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",
cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,
includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor".split(" "),initialize:function(a){a&&this.setOptions(a)},_initGradient:function(b){b.fill&&
b.fill.colorStops&&!(b.fill instanceof a.Gradient)&&this.set("fill",new a.Gradient(b.fill))},_initPattern:function(b){b.fill&&b.fill.source&&!(b.fill instanceof a.Pattern)&&this.set("fill",new a.Pattern(b.fill));b.stroke&&b.stroke.source&&!(b.stroke instanceof a.Pattern)&&this.set("stroke",new a.Pattern(b.stroke))},_initClipping:function(b){if(b.clipTo&&typeof b.clipTo==="string"&&(b=a.util.getFunctionBody(b.clipTo),typeof b!=="undefined"))this.clipTo=new Function("ctx",b)},setOptions:function(a){for(var b in a)this.set(b,
a[b]);this._initGradient(a);this._initPattern(a);this._initClipping(a)},transform:function(a,c){this.group&&this.group.transform(a,c);var f=c?this._getLeftTopCoords():this.getCenterPoint();a.translate(f.x,f.y);a.rotate(b(this.angle));a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(b){var c=a.Object.NUM_FRACTION_DIGITS,c={type:this.type,originX:this.originX,originY:this.originY,left:f(this.left,c),top:f(this.top,c),width:f(this.width,c),height:f(this.height,
c),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:f(this.strokeWidth,c),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:f(this.strokeMiterLimit,c),scaleX:f(this.scaleX,c),scaleY:f(this.scaleY,c),angle:f(this.getAngle(),c),flipX:this.flipX,flipY:this.flipY,opacity:f(this.opacity,c),shadow:this.shadow&&this.shadow.toObject?
this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation};this.includeDefaultValues||(c=this._removeDefaultValues(c));a.util.populateWithProperties(this,c,b);return c},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(b){var c=a.util.getKlass(b.type).prototype;c.stateProperties.forEach(function(a){b[a]===c[a]&&delete b[a]});
return b},toString:function(){return"#<fabric."+c(this.type)+">"},get:function(a){return this[a]},_setObject:function(a){for(var b in a)this._set(b,a[b])},set:function(a,b){typeof a==="object"?this._setObject(a):typeof b==="function"&&a!=="clipTo"?this._set(a,b(this.get(a))):this._set(a,b);return this},_set:function(b,c){(b==="scaleX"||b==="scaleY")&&(c=this._constrainScale(c));b==="scaleX"&&c<0?(this.flipX=!this.flipX,c*=-1):b==="scaleY"&&c<0?(this.flipY=!this.flipY,c*=-1):b==="width"||b==="height"?
this.minScaleLimit=f(Math.min(0.1,1/Math.max(this.width,this.height)),2):b==="shadow"&&c&&!(c instanceof a.Shadow)&&(c=new a.Shadow(c));this[b]=c;return this},toggle:function(a){var b=this.get(a);typeof b==="boolean"&&this.set(a,!b);return this},setSourcePath:function(a){this.sourcePath=a;return this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(b,c){!(this.width===0&&this.height===0)&&this.visible&&
(b.save(),this._setupCompositeOperation(b),c||this.transform(b),this._setStrokeStyles(b),this._setFillStyles(b),this.group&&this.group.type==="path-group"&&b.translate(-this.group.width/2,-this.group.height/2),this.transformMatrix&&b.transform.apply(b,this.transformMatrix),this._setOpacity(b),this._setShadow(b),this.clipTo&&a.util.clipContext(this,b),this._render(b,c),this.clipTo&&b.restore(),this._removeShadow(b),this._restoreCompositeOperation(b),b.restore())},_setOpacity:function(a){this.group&&
this.group._setOpacity(a);a.globalAlpha*=this.opacity},_setStrokeStyles:function(a){if(this.stroke)a.lineWidth=this.strokeWidth,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a,this):this.stroke},_setFillStyles:function(a){if(this.fill)a.fillStyle=this.fill.toLive?this.fill.toLive(a,this):this.fill},_renderControls:function(c,f){var d=this.getViewportTransform();c.save();if(this.active&&!f){var h;this.group&&
(h=a.util.transformPoint(this.group.getCenterPoint(),d),c.translate(h.x,h.y),c.rotate(b(this.group.angle)));h=a.util.transformPoint(this.getCenterPoint(),d,null!=this.group);this.group&&(h.x*=this.group.scaleX,h.y*=this.group.scaleY);c.translate(h.x,h.y);c.rotate(b(this.angle));this.drawBorders(c);this.drawControls(c)}c.restore()},_setShadow:function(a){if(this.shadow){var b=this.canvas&&this.canvas._currentMultiplier||1;a.shadowColor=this.shadow.color;a.shadowBlur=this.shadow.blur*b*(this.scaleX+
this.scaleY)/2;a.shadowOffsetX=this.shadow.offsetX*b*this.scaleX;a.shadowOffsetY=this.shadow.offsetY*b*this.scaleY}},_removeShadow:function(a){if(this.shadow)a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0},_renderFill:function(a){this.fill&&(a.save(),this.fill.gradientTransform&&a.transform.apply(a,this.fill.gradientTransform),this.fill.toLive&&a.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),this.fillRule==="evenodd"?a.fill("evenodd"):a.fill(),
a.restore(),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a))},_renderStroke:function(a){this.stroke&&this.strokeWidth!==0&&(a.save(),this.strokeDashArray?(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),h?(a.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(a)):this._renderDashedStroke&&this._renderDashedStroke(a),a.stroke()):(this.stroke.gradientTransform&&a.transform.apply(a,this.stroke.gradientTransform),this._stroke?
this._stroke(a):a.stroke()),this._removeShadow(a),a.restore())},clone:function(b,c){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(c),b):new a.Object(this.toObject(c))},cloneAsImage:function(b){var c=this.toDataURL();a.util.loadImage(c,function(c){b&&b(new a.Image(c))});return this},toDataURL:function(b){b||(b={});var c=a.util.createCanvasElement(),f=this.getBoundingRect();c.width=f.width;c.height=f.height;a.util.wrapElement(c,"div");f=new a.Canvas(c);if(b.format==="jpg")b.format=
"jpeg";if(b.format==="jpeg")f.backgroundColor="#fff";var d={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1);this.setPositionByOrigin(new a.Point(c.width/2,c.height/2),"center","center");c=this.canvas;f.add(this);b=f.toDataURL(b);this.set(d).setCoords();this.canvas=c;f.dispose();return b},isType:function(a){return this.type===a},complexity:function(){return 0},toJSON:function(a){return this.toObject(a)},setGradient:function(b,c){c||(c={});var f={colorStops:[]};
f.type=c.type||(c.r1||c.r2?"radial":"linear");f.coords={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2};if(c.r1||c.r2)f.coords.r1=c.r1,f.coords.r2=c.r2;for(var d in c.colorStops){var h=new a.Color(c.colorStops[d]);f.colorStops.push({offset:d,color:h.toRgb(),opacity:h.getAlpha()})}return this.set(b,a.Gradient.forObject(this,f))},setPatternFill:function(b){return this.set("fill",new a.Pattern(b))},setShadow:function(b){return this.set("shadow",b?new a.Shadow(b):null)},setColor:function(a){this.set("fill",a);return this},
setAngle:function(a){var b=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;b&&this._setOriginToCenter();this.set("angle",a);b&&this._resetOrigin();return this},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){this.canvas.centerObject(this);return this},remove:function(){this.canvas.remove(this);return this},getLocalPointer:function(a,b){var b=b||this.canvas.getPointer(a),c=this.translateToOriginPoint(this.getCenterPoint(),
"left","top");return{x:b.x-c.x,y:b.y-c.y}},_setupCompositeOperation:function(a){if(this.globalCompositeOperation)this._prevGlobalCompositeOperation=a.globalCompositeOperation,a.globalCompositeOperation=this.globalCompositeOperation},_restoreCompositeOperation:function(a){if(this.globalCompositeOperation&&this._prevGlobalCompositeOperation)a.globalCompositeOperation=this._prevGlobalCompositeOperation}}),a.util.createAccessors(a.Object),a.Object.prototype.rotate=a.Object.prototype.setAngle,d(a.Object.prototype,
a.Observable),a.Object.NUM_FRACTION_DIGITS=2,a.Object.__uid=0})(typeof m!=="undefined"?m:this);(function(){var d=g.util.degreesToRadians;g.util.object.extend(g.Object.prototype,{translateToCenterPoint:function(a,f,c){var b=a.x,h=a.y,e=this.stroke?this.strokeWidth:0;f==="left"?b=a.x+(this.getWidth()+e*this.scaleX)/2:f==="right"&&(b=a.x-(this.getWidth()+e*this.scaleX)/2);c==="top"?h=a.y+(this.getHeight()+e*this.scaleY)/2:c==="bottom"&&(h=a.y-(this.getHeight()+e*this.scaleY)/2);return g.util.rotatePoint(new g.Point(b,
h),a,d(this.angle))},translateToOriginPoint:function(a,f,c){var b=a.x,h=a.y,e=this.stroke?this.strokeWidth:0;f==="left"?b=a.x-(this.getWidth()+e*this.scaleX)/2:f==="right"&&(b=a.x+(this.getWidth()+e*this.scaleX)/2);c==="top"?h=a.y-(this.getHeight()+e*this.scaleY)/2:c==="bottom"&&(h=a.y+(this.getHeight()+e*this.scaleY)/2);return g.util.rotatePoint(new g.Point(b,h),a,d(this.angle))},getCenterPoint:function(){return this.translateToCenterPoint(new g.Point(this.left,this.top),this.originX,this.originY)},
getPointByOrigin:function(a,f){return this.translateToOriginPoint(this.getCenterPoint(),a,f)},toLocalPoint:function(a,f,c){var b=this.getCenterPoint(),h=this.stroke?this.strokeWidth:0;f&&c?(f=f==="left"?b.x-(this.getWidth()+h*this.scaleX)/2:f==="right"?b.x+(this.getWidth()+h*this.scaleX)/2:b.x,c=c==="top"?b.y-(this.getHeight()+h*this.scaleY)/2:c==="bottom"?b.y+(this.getHeight()+h*this.scaleY)/2:b.y):(f=this.left,c=this.top);return g.util.rotatePoint(new g.Point(a.x,a.y),b,-d(this.angle)).subtractEquals(new g.Point(f,
c))},setPositionByOrigin:function(a,f,c){a=this.translateToOriginPoint(this.translateToCenterPoint(a,f,c),this.originX,this.originY);this.set("left",a.x);this.set("top",a.y)},adjustPosition:function(a){var f=d(this.angle),c=this.getWidth()/2,b=Math.cos(f)*c;c*=Math.sin(f);var h=this.getWidth(),e=Math.cos(f)*h,f=Math.sin(f)*h;this.originX==="center"&&a==="left"||this.originX==="right"&&a==="center"?(this.left-=b,this.top-=c):this.originX==="left"&&a==="center"||this.originX==="center"&&a==="right"?
(this.left+=b,this.top+=c):this.originX==="left"&&a==="right"?(this.left+=e,this.top+=f):this.originX==="right"&&a==="left"&&(this.left-=e,this.top-=f);this.setCoords();this.originX=a},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var a=this.getCenterPoint();this.originY=this.originX="center";this.left=a.x;this.top=a.y},_resetOrigin:function(){var a=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);
this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=a.x;this.top=a.y;this._originalOriginY=this._originalOriginX=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})})();(function(){var d=g.util.degreesToRadians;g.util.object.extend(g.Object.prototype,{oCoords:null,intersectsWithRect:function(a,f){var c=this.oCoords,b=new g.Point(c.tl.x,c.tl.y),d=new g.Point(c.tr.x,c.tr.y),e=new g.Point(c.bl.x,c.bl.y),c=new g.Point(c.br.x,
c.br.y);return g.Intersection.intersectPolygonRectangle([b,d,c,e],a,f).status==="Intersection"},intersectsWithObject:function(a){function f(a){return{tl:new g.Point(a.tl.x,a.tl.y),tr:new g.Point(a.tr.x,a.tr.y),bl:new g.Point(a.bl.x,a.bl.y),br:new g.Point(a.br.x,a.br.y)}}var c=f(this.oCoords),a=f(a.oCoords);return g.Intersection.intersectPolygonPolygon([c.tl,c.tr,c.br,c.bl],[a.tl,a.tr,a.br,a.bl]).status==="Intersection"},isContainedWithinObject:function(a){var f=a.getBoundingRect(),a=new g.Point(f.left,
f.top),f=new g.Point(f.left+f.width,f.top+f.height);return this.isContainedWithinRect(a,f)},isContainedWithinRect:function(a,f){var c=this.getBoundingRect();return c.left>=a.x&&c.left+c.width<=f.x&&c.top>=a.y&&c.top+c.height<=f.y},containsPoint:function(a){var f=this._getImageLines(this.oCoords),a=this._findCrossPoints(a,f);return a!==0&&a%2===1},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_findCrossPoints:function(a,
f){var c,b,d,e=0,g;for(g in f)if(d=f[g],!(d.o.y<a.y&&d.d.y<a.y)&&!(d.o.y>=a.y&&d.d.y>=a.y)&&(d.o.x===d.d.x&&d.o.x>=a.x?c=d.o.x:(c=(d.d.y-d.o.y)/(d.d.x-d.o.x),b=a.y-0*a.x,d=d.o.y-c*d.o.x,c=-(b-d)/(0-c)),c>=a.x&&(e+=1),e===2))break;return e},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var a=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],
f=g.util.array.min(a),a=g.util.array.max(a),a=Math.abs(f-a),c=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],b=g.util.array.min(c),c=g.util.array.max(c),c=Math.abs(b-c);return{left:f,top:b,width:a,height:c}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?a<0?-this.minScaleLimit:this.minScaleLimit:a},scale:function(a){a=this._constrainScale(a);if(a<0)this.flipX=
!this.flipX,this.flipY=!this.flipY,a*=-1;this.scaleY=this.scaleX=a;this.setCoords();return this},scaleToWidth:function(a){var f=this.getBoundingRectWidth()/this.getWidth();return this.scale(a/this.width/f)},scaleToHeight:function(a){var f=this.getBoundingRectHeight()/this.getHeight();return this.scale(a/this.height/f)},setCoords:function(){var a=this.strokeWidth,f=d(this.angle),c=this.getViewportTransform(),b=function(a){return g.util.transformPoint(a,c)},h=this.width,e=this.height,j=this.strokeLineCap===
"round"||this.strokeLineCap==="square",k=this.type==="line"&&this.width===0,l=this.type==="line"&&this.height===0,o=k||l;k?h=a:l&&(e=a);(j&&l||!o)&&(h+=h>0?a:-a);(j&&k||!o)&&(e+=e>0?a:-a);this.currentWidth=h*this.scaleX;this.currentHeight=e*this.scaleY;if(this.currentWidth<0)this.currentWidth=Math.abs(this.currentWidth);e=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2));a=Math.atan(isFinite(this.currentHeight/this.currentWidth)?this.currentHeight/this.currentWidth:0);h=
Math.cos(a+f)*e;e*=Math.sin(a+f);var l=Math.sin(f),o=Math.cos(f),j=this.getCenterPoint(),i=new g.Point(this.currentWidth,this.currentHeight),p=new g.Point(j.x-h,j.y-e),m=new g.Point(p.x+i.x*o,p.y+i.x*l),x=new g.Point(p.x-i.y*l,p.y+i.y*o),C=new g.Point(p.x+i.x/2*o,p.y+i.x/2*l),h=b(p),e=b(m),j=b(new g.Point(m.x-i.y*l,m.y+i.y*o)),k=b(x),p=b(new g.Point(p.x-i.y/2*l,p.y+i.y/2*o)),n=b(C),m=b(new g.Point(m.x-i.y/2*l,m.y+i.y/2*o)),l=b(new g.Point(x.x+i.x/2*o,x.y+i.x/2*l)),b=b(new g.Point(C.x,C.y)),o=Math.cos(a+
f)*this.padding*Math.sqrt(2),f=Math.sin(a+f)*this.padding*Math.sqrt(2),h=h.add(new g.Point(-o,-f)),e=e.add(new g.Point(f,-o)),j=j.add(new g.Point(o,f)),k=k.add(new g.Point(-f,o)),p=p.add(new g.Point((-o-f)/2,(-f+o)/2)),n=n.add(new g.Point((f-o)/2,-(f+o)/2)),m=m.add(new g.Point((f+o)/2,(f-o)/2)),l=l.add(new g.Point((o-f)/2,(o+f)/2)),b=b.add(new g.Point((f-o)/2,-(f+o)/2));this.oCoords={tl:h,tr:e,br:j,bl:k,ml:p,mt:n,mr:m,mb:l,mtr:b};this._setCornerCoords&&this._setCornerCoords();return this}})})();g.util.object.extend(g.Object.prototype,
{sendToBack:function(){this.group?g.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this);return this},bringToFront:function(){this.group?g.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this);return this},sendBackwards:function(d){this.group?g.StaticCanvas.prototype.sendBackwards.call(this.group,this,d):this.canvas.sendBackwards(this,d);return this},bringForward:function(d){this.group?g.StaticCanvas.prototype.bringForward.call(this.group,
this,d):this.canvas.bringForward(this,d);return this},moveTo:function(d){this.group?g.StaticCanvas.prototype.moveTo.call(this.group,this,d):this.canvas.moveTo(this,d);return this}});g.util.object.extend(g.Object.prototype,{getSvgStyles:function(){var d=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",a=this.fillRule,f=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",c=this.strokeWidth?this.strokeWidth:"0",b=this.strokeDashArray?this.strokeDashArray.join(" "):
"";return["stroke: ",f,"; stroke-width: ",c,"; stroke-dasharray: ",b,"; stroke-linecap: ",this.strokeLineCap?this.strokeLineCap:"butt","; stroke-linejoin: ",this.strokeLineJoin?this.strokeLineJoin:"miter","; stroke-miterlimit: ",this.strokeMiterLimit?this.strokeMiterLimit:"4","; fill: ",d,"; fill-rule: ",a,"; opacity: ",typeof this.opacity!=="undefined"?this.opacity:"1",";",this.shadow&&this.type!=="text"?"filter: url(#SVGID_"+this.shadow.id+");":"",this.visible?"":" visibility: hidden;"].join("")},
getSvgTransform:function(){if(this.group&&this.group.type==="path-group")return"";var d=g.util.toFixed,a=this.getAngle(),f=!this.canvas||this.canvas.svgViewportTransformation?this.getViewportTransform():[1,0,0,1,0,0],c=g.util.transformPoint(this.getCenterPoint(),f),b=g.Object.NUM_FRACTION_DIGITS,c=this.type==="path-group"?"":"translate("+d(c.x,b)+" "+d(c.y,b)+")",a=a!==0?" rotate("+d(a,b)+")":"",d=this.scaleX===1&&this.scaleY===1&&f[0]===1&&f[3]===1?"":" scale("+d(this.scaleX*f[0],b)+" "+d(this.scaleY*
f[3],b)+")",b=this.type==="path-group"?this.width*f[0]:0,f=this.type==="path-group"?this.height*f[3]:0;return[c,a,d,this.flipX?" matrix(-1 0 0 1 "+b+" 0) ":"",this.flipY?" matrix(1 0 0 -1 0 "+f+")":""].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+")":""},_createBaseSVGMarkup:function(){var d=[];this.fill&&this.fill.toLive&&d.push(this.fill.toSVG(this,!1));this.stroke&&this.stroke.toLive&&d.push(this.stroke.toSVG(this,!1));this.shadow&&
d.push(this.shadow.toSVG(this));return d}});g.util.object.extend(g.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(d){return this.get(d)!==this.originalState[d]},this)},saveState:function(d){this.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this);d&&d.stateProperties&&d.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this);return this},setupState:function(){this.originalState={};this.saveState();return this}});
(function(){var d=g.util.degreesToRadians;g.util.object.extend(g.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(a){if(!this.hasControls||!this.active)return!1;var f=a.x,a=a.y,c,b;for(b in this.oCoords)if(this.isControlVisible(b)&&(b!=="mtr"||this.hasRotatingPoint))if(!this.get("lockUniScaling")||!(b==="mt"||b==="mr"||b==="mb"||b==="ml"))if(c=this._getImageLines(this.oCoords[b].corner),c=this._findCrossPoints({x:f,y:a},c),c!==0&&c%2===1)return this.__corner=b;return!1},_setCornerCoords:function(){var a=
this.oCoords,f=d(this.angle),c=d(45-this.angle),b=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,h=b*Math.cos(c),c=b*Math.sin(c),b=Math.sin(f),f=Math.cos(f);a.tl.corner={tl:{x:a.tl.x-c,y:a.tl.y-h},tr:{x:a.tl.x+h,y:a.tl.y-c},bl:{x:a.tl.x-h,y:a.tl.y+c},br:{x:a.tl.x+c,y:a.tl.y+h}};a.tr.corner={tl:{x:a.tr.x-c,y:a.tr.y-h},tr:{x:a.tr.x+h,y:a.tr.y-c},br:{x:a.tr.x+c,y:a.tr.y+h},bl:{x:a.tr.x-h,y:a.tr.y+c}};a.bl.corner={tl:{x:a.bl.x-c,y:a.bl.y-h},bl:{x:a.bl.x-h,y:a.bl.y+c},br:{x:a.bl.x+c,y:a.bl.y+h},tr:{x:a.bl.x+
h,y:a.bl.y-c}};a.br.corner={tr:{x:a.br.x+h,y:a.br.y-c},bl:{x:a.br.x-h,y:a.br.y+c},br:{x:a.br.x+c,y:a.br.y+h},tl:{x:a.br.x-c,y:a.br.y-h}};a.ml.corner={tl:{x:a.ml.x-c,y:a.ml.y-h},tr:{x:a.ml.x+h,y:a.ml.y-c},bl:{x:a.ml.x-h,y:a.ml.y+c},br:{x:a.ml.x+c,y:a.ml.y+h}};a.mt.corner={tl:{x:a.mt.x-c,y:a.mt.y-h},tr:{x:a.mt.x+h,y:a.mt.y-c},bl:{x:a.mt.x-h,y:a.mt.y+c},br:{x:a.mt.x+c,y:a.mt.y+h}};a.mr.corner={tl:{x:a.mr.x-c,y:a.mr.y-h},tr:{x:a.mr.x+h,y:a.mr.y-c},bl:{x:a.mr.x-h,y:a.mr.y+c},br:{x:a.mr.x+c,y:a.mr.y+h}};
a.mb.corner={tl:{x:a.mb.x-c,y:a.mb.y-h},tr:{x:a.mb.x+h,y:a.mb.y-c},bl:{x:a.mb.x-h,y:a.mb.y+c},br:{x:a.mb.x+c,y:a.mb.y+h}};a.mtr.corner={tl:{x:a.mtr.x-c+b*this.rotatingPointOffset,y:a.mtr.y-h-f*this.rotatingPointOffset},tr:{x:a.mtr.x+h+b*this.rotatingPointOffset,y:a.mtr.y-c-f*this.rotatingPointOffset},bl:{x:a.mtr.x-h+b*this.rotatingPointOffset,y:a.mtr.y+c-f*this.rotatingPointOffset},br:{x:a.mtr.x+c+b*this.rotatingPointOffset,y:a.mtr.y+h-f*this.rotatingPointOffset}}},drawBorders:function(a){if(!this.hasBorders)return this;
var f=this.padding,c=f*2,b=this.getViewportTransform();a.save();a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=this.borderColor;var d=1/this._constrainScale(this.scaleX),e=1/this._constrainScale(this.scaleY);a.lineWidth=1/this.borderScaleFactor;var j=this.getWidth(),k=this.getHeight(),l=this.strokeWidth,o=this.strokeLineCap==="round"||this.strokeLineCap==="square",i=this.type==="line"&&this.width===0,p=this.type==="line"&&this.height===0,m=i||p;i?j=l/d:p&&(k=l/e);(o&&p||
!m)&&(j+=l/d);(o&&i||!m)&&(k+=l/e);d=g.util.transformPoint(new g.Point(j,k),b,!0);b=d.x;d=d.y;this.group&&(b*=this.group.scaleX,d*=this.group.scaleY);a.strokeRect(~~(-(b/2)-f)-0.5,~~(-(d/2)-f)-0.5,~~(b+c)+1,~~(d+c)+1);this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls&&(f=(-d-f*2)/2,a.beginPath(),a.moveTo(0,f),a.lineTo(0,f-this.rotatingPointOffset),a.closePath(),a.stroke());a.restore();return this},drawControls:function(a){if(!this.hasControls)return this;
var f=this.cornerSize,c=f/2,b=this.getViewportTransform(),d=this.strokeWidth,e=this.width,j=this.height,k=this.strokeLineCap==="round"||this.strokeLineCap==="square",l=this.type==="line"&&this.width===0,o=this.type==="line"&&this.height===0,i=l||o;l?e=d:o&&(j=d);(k&&o||!i)&&(e+=d);(k&&l||!i)&&(j+=d);e*=this.scaleX;j*=this.scaleY;d=g.util.transformPoint(new g.Point(e,j),b,!0);b=d.x;d=d.y;e=-(b/2);j=-(d/2);k=this.padding;f=c-f;l=this.transparentCorners?"strokeRect":"fillRect";a.save();a.lineWidth=1;
a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=a.fillStyle=this.cornerColor;this._drawControl("tl",a,l,e-c-k,j-c-k);this._drawControl("tr",a,l,e+b-c+k,j-c-k);this._drawControl("bl",a,l,e-c-k,j+d+f+k);this._drawControl("br",a,l,e+b+f+k,j+d+f+k);this.get("lockUniScaling")||(this._drawControl("mt",a,l,e+b/2-c,j-c-k),this._drawControl("mb",a,l,e+b/2-c,j+d+f+k),this._drawControl("mr",a,l,e+b+f+k,j+d/2-c),this._drawControl("ml",a,l,e-c-k,j+d/2-c));this.hasRotatingPoint&&this._drawControl("mtr",
a,l,e+b/2-c,j-this.rotatingPointOffset-this.cornerSize/2-k);a.restore();return this},_drawControl:function(a,f,c,b,d){var e=this.cornerSize;this.isControlVisible(a)&&(typeof G_vmlCanvasManager!=="undefined"||this.transparentCorners||f.clearRect(b,d,e,e),f[c](b,d,e,e))},isControlVisible:function(a){return this._getControlsVisibility()[a]},setControlVisible:function(a,f){this._getControlsVisibility()[a]=f;return this},setControlsVisibility:function(a){a||(a={});for(var f in a)this.setControlVisible(f,
a[f]);return this},_getControlsVisibility:function(){if(!this._controlsVisibility)this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0};return this._controlsVisibility}})})();g.util.object.extend(g.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(d,a){var a=a||{},f=function(){},c=a.onComplete||f,b=a.onChange||f,h=this;g.util.animate({startValue:d.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(a){d.set("left",a);h.renderAll();
b()},onComplete:function(){d.setCoords();c()}});return this},fxCenterObjectV:function(d,a){var a=a||{},f=function(){},c=a.onComplete||f,b=a.onChange||f,h=this;g.util.animate({startValue:d.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(a){d.set("top",a);h.renderAll();b()},onComplete:function(){d.setCoords();c()}});return this},fxRemove:function(d,a){var a=a||{},f=function(){},c=a.onComplete||f,b=a.onChange||f,h=this;g.util.animate({startValue:d.get("opacity"),
endValue:0,duration:this.FX_DURATION,onStart:function(){d.set("active",!1)},onChange:function(a){d.set("opacity",a);h.renderAll();b()},onComplete:function(){h.remove(d);c()}});return this}});g.util.object.extend(g.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]==="object"){var d=[],a,f;for(a in arguments[0])d.push(a);for(var c=0,b=d.length;c<b;c++)a=d[c],f=c!==b-1,this._animate(a,arguments[0][a],arguments[1],f)}else this._animate.apply(this,arguments);return this},_animate:function(d,
a,f,c){var b=this,h,a=a.toString(),f=f?g.util.object.clone(f):{};~d.indexOf(".")&&(h=d.split("."));var e=h?this.get(h[0])[h[1]]:this.get(d);if(!("from"in f))f.from=e;a=~a.indexOf("=")?e+parseFloat(a.replace("=","")):parseFloat(a);g.util.animate({startValue:f.from,endValue:a,byValue:f.by,easing:f.easing,duration:f.duration,abort:f.abort&&function(){return f.abort.call(b)},onChange:function(a){h?b[h[0]][h[1]]=a:b.set(d,a);c||f.onChange&&f.onChange()},onComplete:function(){c||(b.setCoords(),f.onComplete&&
f.onComplete())}})}});(function(d){function a(a,b){var c=a.origin,f=a.axis1,d=a.axis2,h=a.dimension,g=b.nearest,m=b.center,x=b.farthest;return function(){switch(this.get(c)){case g:return Math.min(this.get(f),this.get(d));case m:return Math.min(this.get(f),this.get(d))+0.5*this.get(h);case x:return Math.max(this.get(f),this.get(d))}}}var f=d.fabric||(d.fabric={}),c=f.util.object.extend,b={x1:1,x2:1,y1:1,y2:1},h=f.StaticCanvas.supports("setLineDash");f.Line?f.warn("fabric.Line is already defined"):
(f.Line=f.util.createClass(f.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(a,b){b=b||{};a||(a=[0,0,0,0]);this.callSuper("initialize",b);this.set("x1",a[0]);this.set("y1",a[1]);this.set("x2",a[2]);this.set("y2",a[3]);this._setWidthHeight(b)},_setWidthHeight:function(a){a||(a={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left="left"in a?a.left:this._getLeftToOriginX();this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(a,c){this.callSuper("_set",
a,c);typeof b[a]!=="undefined"&&this._setWidthHeight();return this},_getLeftToOriginX:a({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:a({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a,b){a.beginPath();if(b){var c=this.getCenterPoint();a.translate(c.x-this.strokeWidth/2,c.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&
h)c=this.calcLinePoints(),a.moveTo(c.x1,c.y1),a.lineTo(c.x2,c.y2);a.lineWidth=this.strokeWidth;c=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle;this.stroke&&this._renderStroke(a);a.strokeStyle=c},_renderDashedStroke:function(a){var b=this.calcLinePoints();a.beginPath();f.util.drawDashedLine(a,b.x1,b.y1,b.x2,b.y2,this.strokeDashArray);a.closePath()},toObject:function(a){return c(this.callSuper("toObject",a),this.calcLinePoints())},calcLinePoints:function(){var a=this.x1<=this.x2?-1:1,b=this.y1<=
this.y2?-1:1;return{x1:a*this.width*0.5,x2:a*this.width*-0.5,y1:b*this.height*0.5,y2:b*this.height*-0.5}},toSVG:function(a){var b=this._createBaseSVGMarkup(),c={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};this.group&&this.group.type==="path-group"||(c=this.calcLinePoints());b.push("<line ",'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},complexity:function(){return 1}}),
f.Line.ATTRIBUTE_NAMES=f.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),f.Line.fromElement=function(a,b){var d=f.parseAttributes(a,f.Line.ATTRIBUTE_NAMES);return new f.Line([d.x1||0,d.y1||0,d.x2||0,d.y2||0],c(d,b))},f.Line.fromObject=function(a){return new f.Line([a.x1,a.y1,a.x2,a.y2],a)})})(typeof m!=="undefined"?m:this);(function(d){var a=d.fabric||(d.fabric={}),f=Math.PI,c=a.util.object.extend;a.Circle?a.warn("fabric.Circle is already defined."):(a.Circle=a.util.createClass(a.Object,{type:"circle",
radius:0,startAngle:0,endAngle:f*2,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("radius",a.radius||0);this.startAngle=a.startAngle||this.startAngle;this.endAngle=a.endAngle||this.endAngle},_set:function(a,c){this.callSuper("_set",a,c);a==="radius"&&this.setRadius(c);return this},toObject:function(a){return c(this.callSuper("toObject",a),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(a){var c=this._createBaseSVGMarkup(),e=0,
d=0,g=(this.endAngle-this.startAngle)%(2*f);if(g===0)this.group&&this.group.type==="path-group"&&(e=this.left+this.radius,d=this.top+this.radius),c.push("<circle ",'cx="'+e+'" cy="'+d+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');else{var e=Math.cos(this.startAngle)*this.radius,d=Math.sin(this.startAngle)*this.radius,l=Math.cos(this.endAngle)*this.radius,o=Math.sin(this.endAngle)*this.radius;c.push('<path d="M '+
e+" "+d," A "+this.radius+" "+this.radius," 0 ",+(g>f?1:0)+" 1"," "+l+" "+o,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return a?a(c.join("")):c.join("")},_render:function(a,c){a.beginPath();a.arc(c?this.left+this.radius:0,c?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1);this._renderFill(a);this._renderStroke(a)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*
this.get("scaleY")},setRadius:function(a){this.radius=a;this.set("width",a*2).set("height",a*2)},complexity:function(){return 1}}),a.Circle.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),a.Circle.fromElement=function(b,f){f||(f={});var e=a.parseAttributes(b,a.Circle.ATTRIBUTE_NAMES);if(!("radius"in e&&e.radius>0))throw Error("value of `r` attribute is required and can not be negative");e.left=e.left||0;e.top=e.top||0;e=new a.Circle(c(e,f));e.left-=e.radius;e.top-=e.radius;return e},
a.Circle.fromObject=function(b){return new a.Circle(b)})})(typeof m!=="undefined"?m:this);(function(d){var a=d.fabric||(d.fabric={});a.Triangle?a.warn("fabric.Triangle is already defined"):(a.Triangle=a.util.createClass(a.Object,{type:"triangle",initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("width",a.width||100).set("height",a.height||100)},_render:function(a){var c=this.width/2,b=this.height/2;a.beginPath();a.moveTo(-c,b);a.lineTo(0,-b);a.lineTo(c,b);a.closePath();this._renderFill(a);
this._renderStroke(a)},_renderDashedStroke:function(f){var c=this.width/2,b=this.height/2;f.beginPath();a.util.drawDashedLine(f,-c,b,0,-b,this.strokeDashArray);a.util.drawDashedLine(f,0,-b,c,b,this.strokeDashArray);a.util.drawDashedLine(f,c,b,-c,b,this.strokeDashArray);f.closePath()},toSVG:function(a){var c=this._createBaseSVGMarkup(),b=this.width/2,d=this.height/2,b=[-b+" "+d,"0 "+-d,b+" "+d].join(",");c.push("<polygon ",'points="',b,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),
'"/>');return a?a(c.join("")):c.join("")},complexity:function(){return 1}}),a.Triangle.fromObject=function(f){return new a.Triangle(f)})})(typeof m!=="undefined"?m:this);(function(d){var a=d.fabric||(d.fabric={}),f=Math.PI*2,c=a.util.object.extend;a.Ellipse?a.warn("fabric.Ellipse is already defined."):(a.Ellipse=a.util.createClass(a.Object,{type:"ellipse",rx:0,ry:0,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("rx",a.rx||0);this.set("ry",a.ry||0)},_set:function(a,c){this.callSuper("_set",
a,c);switch(a){case "rx":this.rx=c;this.set("width",c*2);break;case "ry":this.ry=c,this.set("height",c*2)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(a){return c(this.callSuper("toObject",a),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(a){var c=this._createBaseSVGMarkup(),e=0,f=0;this.group&&this.group.type==="path-group"&&(e=this.left+this.rx,f=this.top+this.ry);c.push("<ellipse ",'cx="',
e,'" cy="',f,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(c.join("")):c.join("")},_render:function(a,c){a.beginPath();a.save();a.transform(1,0,0,this.ry/this.rx,0,0);a.arc(c?this.left+this.rx:0,c?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,f,!1);a.restore();this._renderFill(a);this._renderStroke(a)},complexity:function(){return 1}}),a.Ellipse.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),
a.Ellipse.fromElement=function(b,f){f||(f={});var e=a.parseAttributes(b,a.Ellipse.ATTRIBUTE_NAMES);e.left=e.left||0;e.top=e.top||0;e=new a.Ellipse(c(e,f));e.top-=e.ry;e.left-=e.rx;return e},a.Ellipse.fromObject=function(b){return new a.Ellipse(b)})})(typeof m!=="undefined"?m:this);(function(d){var a=d.fabric||(d.fabric={}),f=a.util.object.extend;a.Rect?console.warn("fabric.Rect is already defined"):(d=a.Object.prototype.stateProperties.concat(),d.push("rx","ry","x","y"),a.Rect=a.util.createClass(a.Object,
{stateProperties:d,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(a){a=a||{};this.callSuper("initialize",a);this._initRxRy()},_initRxRy:function(){if(this.rx&&!this.ry)this.ry=this.rx;else if(this.ry&&!this.rx)this.rx=this.ry},_render:function(a,b){if(this.width===1&&this.height===1)a.fillRect(0,0,1,1);else{var f=this.rx?Math.min(this.rx,this.width/2):0,e=this.ry?Math.min(this.ry,this.height/2):0,d=this.width,g=this.height,l=b?this.left:-this.width/2,o=b?this.top:-this.height/2,i=
f!==0||e!==0;a.beginPath();a.moveTo(l+f,o);a.lineTo(l+d-f,o);i&&a.bezierCurveTo(l+d-0.4477152502*f,o,l+d,o+0.4477152502*e,l+d,o+e);a.lineTo(l+d,o+g-e);i&&a.bezierCurveTo(l+d,o+g-0.4477152502*e,l+d-0.4477152502*f,o+g,l+d-f,o+g);a.lineTo(l+f,o+g);i&&a.bezierCurveTo(l+0.4477152502*f,o+g,l,o+g-0.4477152502*e,l,o+g-e);a.lineTo(l,o+e);i&&a.bezierCurveTo(l,o+0.4477152502*e,l+0.4477152502*f,o,l+f,o);a.closePath();this._renderFill(a);this._renderStroke(a)}},_renderDashedStroke:function(c){var b=-this.width/
2,f=-this.height/2,e=this.width,d=this.height;c.beginPath();a.util.drawDashedLine(c,b,f,b+e,f,this.strokeDashArray);a.util.drawDashedLine(c,b+e,f,b+e,f+d,this.strokeDashArray);a.util.drawDashedLine(c,b+e,f+d,b,f+d,this.strokeDashArray);a.util.drawDashedLine(c,b,f+d,b,f,this.strokeDashArray);c.closePath()},toObject:function(a){a=f(this.callSuper("toObject",a),{rx:this.get("rx")||0,ry:this.get("ry")||0});this.includeDefaultValues||this._removeDefaultValues(a);return a},toSVG:function(a){var b=this._createBaseSVGMarkup(),
f=this.left,e=this.top;this.group&&this.group.type==="path-group"||(f=-this.width/2,e=-this.height/2);b.push("<rect ",'x="',f,'" y="',e,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},complexity:function(){return 1}}),a.Rect.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),a.Rect.fromElement=
function(c,b){if(!c)return null;var b=b||{},d=a.parseAttributes(c,a.Rect.ATTRIBUTE_NAMES);d.left=d.left||0;d.top=d.top||0;return new a.Rect(f(b?a.util.object.clone(b):{},d))},a.Rect.fromObject=function(c){return new a.Rect(c)})})(typeof m!=="undefined"?m:this);(function(d){var a=d.fabric||(d.fabric={});a.Polyline?a.warn("fabric.Polyline is already defined"):(a.Polyline=a.util.createClass(a.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(f,c){return a.Polygon.prototype.initialize.call(this,
f,c)},_calcDimensions:function(){return a.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return a.Polygon.prototype._applyPointOffset.call(this)},toObject:function(f){return a.Polygon.prototype.toObject.call(this,f)},toSVG:function(f){return a.Polygon.prototype.toSVG.call(this,f)},_render:function(f){a.Polygon.prototype.commonRender.call(this,f);this._renderFill(f);this._renderStroke(f)},_renderDashedStroke:function(f){var c,b;f.beginPath();for(var d=0,e=this.points.length;d<
e;d++)c=this.points[d],b=this.points[d+1]||c,a.util.drawDashedLine(f,c.x,c.y,b.x,b.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),a.Polyline.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(),a.Polyline.fromElement=function(f,c){if(!f)return null;c||(c={});var b=a.parsePointsAttribute(f.getAttribute("points")),d=a.parseAttributes(f,a.Polyline.ATTRIBUTE_NAMES);return b===null?null:new a.Polyline(b,a.util.object.extend(d,c))},a.Polyline.fromObject=function(f){return new a.Polyline(f.points,
f,!0)})})(typeof m!=="undefined"?m:this);(function(d){var a=d.fabric||(d.fabric={}),f=a.util.object.extend,c=a.util.array.min,b=a.util.array.max,h=a.util.toFixed;a.Polygon?a.warn("fabric.Polygon is already defined"):(a.Polygon=a.util.createClass(a.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(a,b){b=b||{};this.points=a;this.callSuper("initialize",b);this._calcDimensions();if(!("top"in b))this.top=this.minY;if(!("left"in b))this.left=this.minX},_calcDimensions:function(){var a=
this.points,f=c(a,"x"),d=c(a,"y"),h=b(a,"x"),a=b(a,"y");this.width=h-f||1;this.height=a-d||1;this.minX=f;this.minY=d},_applyPointOffset:function(){this.points.forEach(function(a){a.x-=this.minX+this.width/2;a.y-=this.minY+this.height/2},this)},toObject:function(a){return f(this.callSuper("toObject",a),{points:this.points.concat()})},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),f=0,d=this.points.length;f<d;f++)b.push(h(this.points[f].x,2),",",h(this.points[f].y,2)," ");c.push("<",this.type,
" ",'points="',b.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');return a?a(c.join("")):c.join("")},_render:function(a){this.commonRender(a);this._renderFill(a);if(this.stroke||this.strokeDashArray)a.closePath(),this._renderStroke(a)},commonRender:function(a){var b;a.beginPath();if(this._applyPointOffset)this.group&&this.group.type==="path-group"||this._applyPointOffset(),this._applyPointOffset=null;a.moveTo(this.points[0].x,
this.points[0].y);for(var c=0,f=this.points.length;c<f;c++)b=this.points[c],a.lineTo(b.x,b.y)},_renderDashedStroke:function(b){a.Polyline.prototype._renderDashedStroke.call(this,b);b.closePath()},complexity:function(){return this.points.length}}),a.Polygon.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(),a.Polygon.fromElement=function(b,c){if(!b)return null;c||(c={});var d=a.parsePointsAttribute(b.getAttribute("points")),h=a.parseAttributes(b,a.Polygon.ATTRIBUTE_NAMES);return d===null?null:new a.Polygon(d,
f(h,c))},a.Polygon.fromObject=function(b){return new a.Polygon(b.points,b,!0)})})(typeof m!=="undefined"?m:this);(function(d){var a=d.fabric||(d.fabric={}),f=a.util.array.min,c=a.util.array.max,b=a.util.object.extend,h=Object.prototype.toString,e=a.util.drawArc,g={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},k={m:"l",M:"L"};a.Path?a.warn("fabric.Path is already defined"):(a.Path=a.util.createClass(a.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(a,b){b=b||{};this.setOptions(b);if(!a)throw Error("`path` argument is required");
var c=h.call(a)==="[object Array]";if(this.path=c?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)){if(!c)this.path=this._parsePath();c=this._parseDimensions();this.minX=c.left;this.minY=c.top;this.width=c.width;this.height=c.height;c.left+=this.originX==="center"?this.width/2:this.originX==="right"?this.width:0;c.top+=this.originY==="center"?this.height/2:this.originY==="bottom"?this.height:0;this.top=this.top||c.top;this.left=this.left||c.left;this.pathOffset=this.pathOffset||{x:this.minX+this.width/
2,y:this.minY+this.height/2};b.sourcePath&&this.setSourcePath(b.sourcePath)}},_render:function(a){var b,c=null,f=0,d=0,h=0,g=0,j=0,k=0,m,n,v,D,r=-this.pathOffset.x,q=-this.pathOffset.y;this.group&&this.group.type==="path-group"&&(q=r=0);a.beginPath();for(var u=0,s=this.path.length;u<s;++u){b=this.path[u];switch(b[0]){case "l":h+=b[1];g+=b[2];a.lineTo(h+r,g+q);break;case "L":h=b[1];g=b[2];a.lineTo(h+r,g+q);break;case "h":h+=b[1];a.lineTo(h+r,g+q);break;case "H":h=b[1];a.lineTo(h+r,g+q);break;case "v":g+=
b[1];a.lineTo(h+r,g+q);break;case "V":g=b[1];a.lineTo(h+r,g+q);break;case "m":h+=b[1];g+=b[2];f=h;d=g;a.moveTo(h+r,g+q);break;case "M":h=b[1];g=b[2];f=h;d=g;a.moveTo(h+r,g+q);break;case "c":m=h+b[5];n=g+b[6];j=h+b[3];k=g+b[4];a.bezierCurveTo(h+b[1]+r,g+b[2]+q,j+r,k+q,m+r,n+q);h=m;g=n;break;case "C":h=b[5];g=b[6];j=b[3];k=b[4];a.bezierCurveTo(b[1]+r,b[2]+q,j+r,k+q,h+r,g+q);break;case "s":m=h+b[3];n=g+b[4];j=j?2*h-j:h;k=k?2*g-k:g;a.bezierCurveTo(j+r,k+q,h+b[1]+r,g+b[2]+q,m+r,n+q);j=h+b[1];k=g+b[2];
h=m;g=n;break;case "S":m=b[3];n=b[4];j=2*h-j;k=2*g-k;a.bezierCurveTo(j+r,k+q,b[1]+r,b[2]+q,m+r,n+q);h=m;g=n;j=b[1];k=b[2];break;case "q":m=h+b[3];n=g+b[4];j=h+b[1];k=g+b[2];a.quadraticCurveTo(j+r,k+q,m+r,n+q);h=m;g=n;break;case "Q":m=b[3];n=b[4];a.quadraticCurveTo(b[1]+r,b[2]+q,m+r,n+q);h=m;g=n;j=b[1];k=b[2];break;case "t":m=h+b[1];n=g+b[2];c[0].match(/[QqTt]/)===null?(j=h,k=g):c[0]==="t"?(j=2*h-v,k=2*g-D):c[0]==="q"&&(j=2*h-j,k=2*g-k);v=j;D=k;a.quadraticCurveTo(j+r,k+q,m+r,n+q);h=m;g=n;j=h+b[1];
k=g+b[2];break;case "T":m=b[1];n=b[2];j=2*h-j;k=2*g-k;a.quadraticCurveTo(j+r,k+q,m+r,n+q);h=m;g=n;break;case "a":e(a,h+r,g+q,[b[1],b[2],b[3],b[4],b[5],b[6]+h+r,b[7]+g+q]);h+=b[6];g+=b[7];break;case "A":e(a,h+r,g+q,[b[1],b[2],b[3],b[4],b[5],b[6]+r,b[7]+q]);h=b[6];g=b[7];break;case "z":case "Z":h=f,g=d,a.closePath()}c=b}this._renderFill(a);this._renderStroke(a)},render:function(b,c){this.visible&&(b.save(),this._setupCompositeOperation(b),c||this.transform(b),this._setStrokeStyles(b),this._setFillStyles(b),
this.group&&this.group.type==="path-group"&&b.translate(-this.group.width/2,-this.group.height/2),this.transformMatrix&&b.transform.apply(b,this.transformMatrix),this._setOpacity(b),this._setShadow(b),this.clipTo&&a.util.clipContext(this,b),this._render(b,c),this.clipTo&&b.restore(),this._removeShadow(b),this._restoreCompositeOperation(b),b.restore())},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){a=b(this.callSuper("toObject",
a),{path:this.path.map(function(a){return a.slice()}),pathOffset:this.pathOffset});if(this.sourcePath)a.sourcePath=this.sourcePath;if(this.transformMatrix)a.transformMatrix=this.transformMatrix;return a},toDatalessObject:function(a){a=this.toObject(a);if(this.sourcePath)a.path=this.sourcePath;delete a.sourcePath;return a},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),e="",f=0,d=this.path.length;f<d;f++)b.push(this.path[f].join(" "));b=b.join(" ");this.group&&this.group.type==="path-group"||
(e="translate("+-this.pathOffset.x+", "+-this.pathOffset.y+")");c.push("<path ",'d="',b,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),e,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n");return a?a(c.join("")):c.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a=[],b=[],c,e,f=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,d,h=0,m=this.path.length;h<m;h++){c=this.path[h];d=c.slice(1).trim();for(b.length=0;e=f.exec(d);)b.push(e[0]);
c=[c.charAt(0)];d=0;for(var n=b.length;d<n;d++)e=parseFloat(b[d]),isNaN(e)||c.push(e);e=c[0];d=g[e.toLowerCase()];n=k[e]||e;if(c.length-1>d)for(var w=1,A=c.length;w<A;w+=d)a.push([e].concat(c.slice(w,w+d))),e=n;else a.push(c)}return a},_parseDimensions:function(){for(var b=[],e=[],d,h=null,g=0,j=0,k=0,m=0,n=0,w=0,A,v,D,r,q,u=0,s=this.path.length;u<s;++u){d=this.path[u];switch(d[0]){case "l":k+=d[1];m+=d[2];q=[];break;case "L":k=d[1];m=d[2];q=[];break;case "h":k+=d[1];q=[];break;case "H":k=d[1];q=
[];break;case "v":m+=d[1];q=[];break;case "V":m=d[1];q=[];break;case "m":k+=d[1];m+=d[2];g=k;j=m;q=[];break;case "M":k=d[1];m=d[2];g=k;j=m;q=[];break;case "c":A=k+d[5];v=m+d[6];n=k+d[3];w=m+d[4];q=a.util.getBoundsOfCurve(k,m,k+d[1],m+d[2],n,w,A,v);k=A;m=v;break;case "C":k=d[5];m=d[6];n=d[3];w=d[4];q=a.util.getBoundsOfCurve(k,m,d[1],d[2],n,w,k,m);break;case "s":A=k+d[3];v=m+d[4];n=n?2*k-n:k;w=w?2*m-w:m;q=a.util.getBoundsOfCurve(k,m,n,w,k+d[1],m+d[2],A,v);n=k+d[1];w=m+d[2];k=A;m=v;break;case "S":A=
d[3];v=d[4];n=2*k-n;w=2*m-w;q=a.util.getBoundsOfCurve(k,m,n,w,d[1],d[2],A,v);k=A;m=v;n=d[1];w=d[2];break;case "q":A=k+d[3];v=m+d[4];n=k+d[1];w=m+d[2];q=a.util.getBoundsOfCurve(k,m,n,w,n,w,A,v);k=A;m=v;break;case "Q":n=d[1];w=d[2];q=a.util.getBoundsOfCurve(k,m,n,w,n,w,d[3],d[4]);k=d[3];m=d[4];break;case "t":A=k+d[1];v=m+d[2];h[0].match(/[QqTt]/)===null?(n=k,w=m):h[0]==="t"?(n=2*k-D,w=2*m-r):h[0]==="q"&&(n=2*k-n,w=2*m-w);D=n;r=w;q=a.util.getBoundsOfCurve(k,m,n,w,n,w,A,v);k=A;m=v;n=k+d[1];w=m+d[2];break;
case "T":A=d[1];v=d[2];n=2*k-n;w=2*m-w;q=a.util.getBoundsOfCurve(k,m,n,w,n,w,A,v);k=A;m=v;break;case "a":q=a.util.getBoundsOfArc(k,m,d[1],d[2],d[3],d[4],d[5],d[6]+k,d[7]+m);k+=d[6];m+=d[7];break;case "A":q=a.util.getBoundsOfArc(k,m,d[1],d[2],d[3],d[4],d[5],d[6],d[7]);k=d[6];m=d[7];break;case "z":case "Z":k=g,m=j}h=d;q.forEach(function(a){b.push(a.x);e.push(a.y)});b.push(k);e.push(m)}d=f(b);h=f(e);g=c(b);j=c(e);return{left:d,top:h,width:g-d,height:j-h}}}),a.Path.fromObject=function(b,c){typeof b.path===
"string"?a.loadSVGFromURL(b.path,function(e){var e=e[0],f=b.path;delete b.path;a.util.object.extend(e,b);e.setSourcePath(f);c(e)}):c(new a.Path(b.path,b))},a.Path.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(["d"]),a.Path.fromElement=function(c,e,f){c=a.parseAttributes(c,a.Path.ATTRIBUTE_NAMES);e&&e(new a.Path(c.d,b(c,f)))},a.Path.async=!0)})(typeof m!=="undefined"?m:this);(function(d){var a=d.fabric||(d.fabric={}),f=a.util.object.extend,c=a.util.array.invoke,b=a.Object.prototype.toObject;a.PathGroup?
a.warn("fabric.PathGroup is already defined"):(a.PathGroup=a.util.createClass(a.Path,{type:"path-group",fill:"",initialize:function(a,b){b=b||{};this.paths=a||[];for(var c=this.paths.length;c--;)this.paths[c].group=this;this.setOptions(b);if(b.widthAttr)this.scaleX=b.widthAttr/b.width;if(b.heightAttr)this.scaleY=b.heightAttr/b.height;this.setCoords();b.sourcePath&&this.setSourcePath(b.sourcePath)},render:function(b){if(this.visible){b.save();var c=this.transformMatrix;c&&b.transform(c[0],c[1],c[2],
c[3],c[4],c[5]);this.transform(b);this._setShadow(b);this.clipTo&&a.util.clipContext(this,b);for(var c=0,f=this.paths.length;c<f;++c)this.paths[c].render(b,!0);this.clipTo&&b.restore();this._removeShadow(b);b.restore()}},_set:function(a,b){if(a==="fill"&&b&&this.isSameColor())for(var c=this.paths.length;c--;)this.paths[c]._set(a,b);return this.callSuper("_set",a,b)},toObject:function(a){a=f(b.call(this,a),{paths:c(this.getObjects(),"toObject",a)});if(this.sourcePath)a.sourcePath=this.sourcePath;return a},
toDatalessObject:function(a){a=this.toObject(a);if(this.sourcePath)a.paths=this.sourcePath;return a},toSVG:function(a){for(var b=this.getObjects(),c="translate("+this.left+" "+this.top+")",c=["<g ",'style="',this.getSvgStyles(),'" ','transform="',c,this.getSvgTransform(),'" ',">\n"],f=0,d=b.length;f<d;f++)c.push(b[f].toSVG(a));c.push("</g>\n");return a?a(c.join("")):c.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=
(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(b){return(b.get("fill")||"").toLowerCase()===a})},complexity:function(){return this.paths.reduce(function(a,b){return a+(b&&b.complexity?b.complexity():0)},0)},getObjects:function(){return this.paths}}),a.PathGroup.fromObject=function(b,c){typeof b.paths==="string"?a.loadSVGFromURL(b.paths,function(f){var d=b.paths;delete b.paths;f=a.util.groupSVGElements(f,b,d);c(f)}):a.util.enlivenObjects(b.paths,function(f){delete b.paths;
c(new a.PathGroup(f,b))})},a.PathGroup.async=!0)})(typeof m!=="undefined"?m:this);(function(d){var a=d.fabric||(d.fabric={}),f=a.util.object.extend,c=a.util.array.min,b=a.util.array.max,h=a.util.array.invoke;if(!a.Group){var e={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};a.Group=a.util.createClass(a.Object,a.Collection,{type:"group",initialize:function(a,b){b=b||{};this._objects=a||[];for(var c=this._objects.length;c--;)this._objects[c].group=
this;this.originalState={};this.callSuper("initialize");if(b.originX)this.originX=b.originX;if(b.originY)this.originY=b.originY;this._calcBounds();this._updateObjectsCoords();b&&f(this,b);this.setCoords();this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(a){var b=a.getLeft(),c=a.getTop(),e=this.getCenterPoint();a.set({originalLeft:b,originalTop:c,left:b-e.x,top:c-e.y});a.setCoords();a.__origHasControls=a.hasControls;
a.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){this._restoreObjectsState();if(a)this._objects.push(a),a.group=this;this.forEachObject(this._setObjectActive,this);this._calcBounds();this._updateObjectsCoords();return this},_setObjectActive:function(a){a.set("active",!0);a.group=this},removeWithUpdate:function(a){this._moveFlippedObject(a);this._restoreObjectsState();this.forEachObject(this._setObjectActive,this);this.remove(a);this._calcBounds();
this._updateObjectsCoords();return this},_onObjectAdded:function(a){a.group=this},_onObjectRemoved:function(a){delete a.group;a.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(a,b){if(a in this.delegatedProperties){var c=this._objects.length;for(this[a]=b;c--;)this._objects[c].set(a,b)}else this[a]=b},toObject:function(a){return f(this.callSuper("toObject",
a),{objects:h(this._objects,"toObject",a)})},render:function(b){if(this.visible){b.save();this.clipTo&&a.util.clipContext(this,b);for(var c=0,e=this._objects.length;c<e;c++)this._renderObject(this._objects[c],b);this.clipTo&&b.restore();b.restore()}},_renderControls:function(a,b){this.callSuper("_renderControls",a,b);for(var c=0,e=this._objects.length;c<e;c++)this._objects[c]._renderControls(a)},_renderObject:function(a,b){var c=a.hasRotatingPoint;if(a.visible)a.hasRotatingPoint=!1,a.render(b),a.hasRotatingPoint=
c},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},_moveFlippedObject:function(a){var b=a.get("originX"),c=a.get("originY"),e=a.getCenterPoint();a.set({originX:"center",originY:"center",left:e.x,top:e.y});this._toggleFlipping(a);e=a.getPointByOrigin(b,c);a.set({originX:b,originY:c,left:e.x,top:e.y});return this},_toggleFlipping:function(a){this.flipX&&(a.toggle("flipX"),a.set("left",-a.get("left")),a.setAngle(-a.getAngle()));this.flipY&&(a.toggle("flipY"),
a.set("top",-a.get("top")),a.setAngle(-a.getAngle()))},_restoreObjectState:function(a){this._setObjectPosition(a);a.setCoords();a.hasControls=a.__origHasControls;delete a.__origHasControls;a.set("active",!1);a.setCoords();delete a.group;return this},_setObjectPosition:function(a){var b=this.getCenterPoint(),c=this._getRotatedLeftTop(a);a.set({angle:a.getAngle()+this.getAngle(),left:b.x+c.left,top:b.y+c.top,scaleX:a.get("scaleX")*this.get("scaleX"),scaleY:a.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(a){var b=
this.getAngle()*(Math.PI/180);return{left:-Math.sin(b)*a.getTop()*this.get("scaleY")+Math.cos(b)*a.getLeft()*this.get("scaleX"),top:Math.cos(b)*a.getTop()*this.get("scaleY")+Math.sin(b)*a.getLeft()*this.get("scaleX")}},destroy:function(){this._objects.forEach(this._moveFlippedObject,this);return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==
this.get("top")},setObjectsCoords:function(){this.forEachObject(function(a){a.setCoords()});return this},_calcBounds:function(a){for(var b=[],c=[],e,f=0,d=this._objects.length;f<d;++f){e=this._objects[f];e.setCoords();for(var h in e.oCoords)b.push(e.oCoords[h].x),c.push(e.oCoords[h].y)}this.set(this._getBounds(b,c,a))},_getBounds:function(e,f,d){var h=a.util.invertTransform(this.getViewportTransform()),g=a.util.transformPoint(new a.Point(c(e),c(f)),h),e=a.util.transformPoint(new a.Point(b(e),b(f)),
h),e={width:e.x-g.x||0,height:e.y-g.y||0};if(!d)e.left=g.x||0,e.top=g.y||0,this.originX==="center"&&(e.left+=e.width/2),this.originX==="right"&&(e.left+=e.width),this.originY==="center"&&(e.top+=e.height/2),this.originY==="bottom"&&(e.top+=e.height);return e},toSVG:function(a){for(var b=["<g ",'transform="',this.getSvgTransform(),'">\n'],c=0,e=this._objects.length;c<e;c++)b.push(this._objects[c].toSVG(a));b.push("</g>\n");return a?a(b.join("")):b.join("")},get:function(a){if(a in e)if(this[a])return this[a];
else{for(var b=0,c=this._objects.length;b<c;b++)if(this._objects[b][a])return!0;return!1}else return a in this.delegatedProperties?this._objects[0]&&this._objects[0].get(a):this[a]}});a.Group.fromObject=function(b,c){a.util.enlivenObjects(b.objects,function(e){delete b.objects;c&&c(new a.Group(e,b))})};a.Group.async=!0}})(typeof m!=="undefined"?m:this);(function(d){var a=g.util.object.extend;if(!d.fabric)d.fabric={};d.fabric.Image?g.warn("fabric.Image is already defined."):(g.Image=g.util.createClass(g.Object,
{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",_lastScaleX:1,_lastScaleY:1,initialize:function(a,c){c||(c={});this.filters=[];this.resizeFilters=[];this.callSuper("initialize",c);this._initElement(a,c);this._initConfig(c);if(c.filters)this.filters=c.filters,this.applyFilters()},getElement:function(){return this._element},setElement:function(a,c,b){this._originalElement=this._element=a;this._initConfig(b);this.filters.length!==0?this.applyFilters(c):c&&c();return this},
setCrossOrigin:function(a){this.crossOrigin=a;this._element.crossOrigin=a;return this},getOriginalSize:function(){var a=this.getElement();return{width:a.width,height:a.height}},_stroke:function(a){a.save();this._setStrokeStyles(a);a.beginPath();a.strokeRect(-this.width/2,-this.height/2,this.width,this.height);a.closePath();a.restore()},_renderDashedStroke:function(a){var c=-this.width/2,b=-this.height/2,d=this.width,e=this.height;a.save();this._setStrokeStyles(a);a.beginPath();g.util.drawDashedLine(a,
c,b,c+d,b,this.strokeDashArray);g.util.drawDashedLine(a,c+d,b,c+d,b+e,this.strokeDashArray);g.util.drawDashedLine(a,c+d,b+e,c,b+e,this.strokeDashArray);g.util.drawDashedLine(a,c,b+e,c,b,this.strokeDashArray);a.closePath();a.restore()},toObject:function(f){return a(this.callSuper("toObject",f),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(a){return a&&a.toObject()}),crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice})},
toSVG:function(a){var c=[],b=-this.width/2,d=-this.height/2,e="none";if(this.group&&this.group.type==="path-group")b=this.left,d=this.top;this.alignX!=="none"&&this.alignY!=="none"&&(e="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice);c.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',b,'" y="',d,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',e,'"',"></image>\n");
if(this.stroke||this.strokeDashArray)e=this.fill,this.fill=null,c.push("<rect ",'x="',b,'" y="',d,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=e;c.push("</g>\n");return a?a(c.join("")):c.join("")},getSrc:function(){if(this.getElement())return this.getElement().src||this.getElement()._src},setSrc:function(a,c,b){g.util.loadImage(a,function(a){return this.setElement(a,c,b)},this,b&&b.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+
this.getSrc()+'" }>'},clone:function(a,c){this.constructor.fromObject(this.toObject(c),a)},applyFilters:function(a,c,b,d){c=c||this.filters;if(b=b||this._originalElement){var e=b,j=g.util.createCanvasElement(),k=g.util.createImage(),l=this;j.width=e.width;j.height=e.height;j.getContext("2d").drawImage(e,0,0,e.width,e.height);if(c.length===0)return this._element=b,a&&a(),j;c.forEach(function(a){a&&a.applyTo(j,a.scaleX||l.scaleX,a.scaleY||l.scaleY);!d&&a.type==="Resize"&&(l.width*=a.scaleX,l.height*=
a.scaleY)});k.width=j.width;k.height=j.height;g.isLikelyNode?(k.src=j.toBuffer(t,g.Image.pngCompression),l._element=k,!d&&(l._filteredEl=k),a&&a()):(k.onload=function(){l._element=k;!d&&(l._filteredEl=k);a&&a();k.onload=j=e=null},k.src=j.toDataURL("image/png"));return j}},_render:function(a,c){var b,d,e=this._findMargins(),g;b=c?this.left:-this.width/2;d=c?this.top:-this.height/2;this.meetOrSlice==="slice"&&(a.beginPath(),a.rect(b,d,this.width,this.height),a.clip());this.isMoving===!1&&this.resizeFilters.length&&
this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,g=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!1)):g=this._element;g&&a.drawImage(g,b+e.marginX,d+e.marginY,e.width,e.height);this._renderStroke(a)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var a=this.width,c=this.height,b=0,d=0;if(this.alignX!=="none"||this.alignY!=="none")a=[this.width/this._element.width,
this.height/this._element.height],c=this.meetOrSlice==="meet"?Math.min.apply(null,a):Math.max.apply(null,a),a=this._element.width*c,c*=this._element.height,this.alignX==="Mid"&&(b=(this.width-a)/2),this.alignX==="Max"&&(b=this.width-a),this.alignY==="Mid"&&(d=(this.height-c)/2),this.alignY==="Max"&&(d=this.height-c);return{width:a,height:c,marginX:b,marginY:d}},_resetWidthHeight:function(){var a=this.getElement();this.set("width",a.width);this.set("height",a.height)},_initElement:function(a){this.setElement(g.util.getById(a));
g.util.addClass(this.getElement(),g.Image.CSS_CANVAS)},_initConfig:function(a){a||(a={});this.setOptions(a);this._setWidthHeight(a);if(this._element&&this.crossOrigin)this._element.crossOrigin=this.crossOrigin},_initFilters:function(a,c){a.filters&&a.filters.length?g.util.enlivenObjects(a.filters,function(a){c&&c(a)},"fabric.Image.filters"):c&&c()},_setWidthHeight:function(a){this.width="width"in a?a.width:this.getElement()?this.getElement().width||0:0;this.height="height"in a?a.height:this.getElement()?
this.getElement().height||0:0},complexity:function(){return 1}}),g.Image.CSS_CANVAS="canvas-img",g.Image.prototype.getSvgSrc=g.Image.prototype.getSrc,g.Image.fromObject=function(a,c){g.util.loadImage(a.src,function(b){g.Image.prototype._initFilters.call(a,a,function(d){a.filters=d||[];d=new g.Image(b,a);c&&c(d)})},null,a.crossOrigin)},g.Image.fromURL=function(a,c,b){g.util.loadImage(a,function(a){c(new g.Image(a,b))},null,b&&b.crossOrigin)},g.Image.ATTRIBUTE_NAMES=g.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),
g.Image.fromElement=function(f,c,b){var f=g.parseAttributes(f,g.Image.ATTRIBUTE_NAMES),d="xMidYMid",e="meet",j;f.preserveAspectRatio&&(j=f.preserveAspectRatio.split(" "));j&&j.length&&(e=j.pop(),e!=="meet"&&e!=="slice"?(d=e,e="meet"):j.length&&(d=j.pop()));j=d!=="none"?d.slice(1,4):"none";d=d!=="none"?d.slice(5,8):"none";f.alignX=j;f.alignY=d;f.meetOrSlice=e;g.Image.fromURL(f["xlink:href"],c,a(b?g.util.object.clone(b):{},f))},g.Image.async=!0,g.Image.pngCompression=1)})(typeof m!=="undefined"?m:this);
g.util.object.extend(g.Object.prototype,{_getAngleValueForStraighten:function(){var d=this.getAngle()%360;return d>0?Math.round((d-1)/90)*90:Math.round(d/90)*90},straighten:function(){this.setAngle(this._getAngleValueForStraighten());return this},fxStraighten:function(d){var d=d||{},a=function(){},f=d.onComplete||a,c=d.onChange||a,b=this;g.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(a){b.setAngle(a);c()},onComplete:function(){b.setCoords();
f()},onStart:function(){b.set("active",!1)}});return this}});g.util.object.extend(g.StaticCanvas.prototype,{straightenObject:function(d){d.straighten();this.renderAll();return this},fxStraightenObject:function(d){d.fxStraighten({onChange:this.renderAll.bind(this)});return this}});g.Image.filters=g.Image.filters||{};g.Image.filters.BaseFilter=g.util.createClass({type:"BaseFilter",initialize:function(d){d&&this.setOptions(d)},setOptions:function(d){for(var a in d)this[a]=d[a]},toObject:function(){return{type:this.type}},
toJSON:function(){return this.toObject()}});(function(d){var a=d.fabric||(d.fabric={}),f=a.util.object.extend;a.Image.filters.Brightness=a.util.createClass(a.Image.filters.BaseFilter,{type:"Brightness",initialize:function(a){a=a||{};this.brightness=a.brightness||0},applyTo:function(a){for(var b=a.getContext("2d"),a=b.getImageData(0,0,a.width,a.height),f=a.data,e=this.brightness,d=0,g=f.length;d<g;d+=4)f[d]+=e,f[d+1]+=e,f[d+2]+=e;b.putImageData(a,0,0)},toObject:function(){return f(this.callSuper("toObject"),
{brightness:this.brightness})}});a.Image.filters.Brightness.fromObject=function(c){return new a.Image.filters.Brightness(c)}})(typeof m!=="undefined"?m:this);(function(d){var a=d.fabric||(d.fabric={}),f=a.util.object.extend;a.Image.filters.Convolute=a.util.createClass(a.Image.filters.BaseFilter,{type:"Convolute",initialize:function(c){c=c||{};this.opaque=c.opaque;this.matrix=c.matrix||[0,0,0,0,1,0,0,0,0];this.tmpCtx=a.util.createCanvasElement().getContext("2d")},_createImageData:function(a,b){return this.tmpCtx.createImageData(a,
b)},applyTo:function(a){for(var b=this.matrix,f=a.getContext("2d"),e=f.getImageData(0,0,a.width,a.height),a=Math.round(Math.sqrt(b.length)),d=Math.floor(a/2),g=e.data,l=e.width,e=e.height,o=this._createImageData(l,e),i=o.data,m=this.opaque?1:0,n=0;n<e;n++)for(var x=0;x<l;x++){for(var C=n,E=x,s=(n*l+x)*4,w=0,A=0,v=0,D=0,r=0;r<a;r++)for(var q=0;q<a;q++){var u=C+r-d,t=E+q-d;u<0||u>e||t<0||t>l||(u=(u*l+t)*4,t=b[r*a+q],w+=g[u]*t,A+=g[u+1]*t,v+=g[u+2]*t,D+=g[u+3]*t)}i[s]=w;i[s+1]=A;i[s+2]=v;i[s+3]=D+m*
(255-D)}f.putImageData(o,0,0)},toObject:function(){return f(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});a.Image.filters.Convolute.fromObject=function(c){return new a.Image.filters.Convolute(c)}})(typeof m!=="undefined"?m:this);(function(d){var a=d.fabric||(d.fabric={}),f=a.util.object.extend;a.Image.filters.GradientTransparency=a.util.createClass(a.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(a){a=a||{};this.threshold=a.threshold||100},applyTo:function(a){for(var b=
a.getContext("2d"),a=b.getImageData(0,0,a.width,a.height),f=a.data,e=this.threshold,d=f.length,g=0,l=f.length;g<l;g+=4)f[g+3]=e+255*(d-g)/d;b.putImageData(a,0,0)},toObject:function(){return f(this.callSuper("toObject"),{threshold:this.threshold})}});a.Image.filters.GradientTransparency.fromObject=function(c){return new a.Image.filters.GradientTransparency(c)}})(typeof m!=="undefined"?m:this);(function(d){var a=d.fabric||(d.fabric={});a.Image.filters.Grayscale=a.util.createClass(a.Image.filters.BaseFilter,
{type:"Grayscale",applyTo:function(a){for(var c=a.getContext("2d"),a=c.getImageData(0,0,a.width,a.height),b=a.data,d=a.width*a.height*4,e=0,g;e<d;)g=(b[e]+b[e+1]+b[e+2])/3,b[e]=g,b[e+1]=g,b[e+2]=g,e+=4;c.putImageData(a,0,0)}});a.Image.filters.Grayscale.fromObject=function(){return new a.Image.filters.Grayscale}})(typeof m!=="undefined"?m:this);(function(d){var a=d.fabric||(d.fabric={});a.Image.filters.Invert=a.util.createClass(a.Image.filters.BaseFilter,{type:"Invert",applyTo:function(a){var c=a.getContext("2d"),
a=c.getImageData(0,0,a.width,a.height),b=a.data,d=b.length,e;for(e=0;e<d;e+=4)b[e]=255-b[e],b[e+1]=255-b[e+1],b[e+2]=255-b[e+2];c.putImageData(a,0,0)}});a.Image.filters.Invert.fromObject=function(){return new a.Image.filters.Invert}})(typeof m!=="undefined"?m:this);(function(d){var a=d.fabric||(d.fabric={}),f=a.util.object.extend;a.Image.filters.Mask=a.util.createClass(a.Image.filters.BaseFilter,{type:"Mask",initialize:function(a){a=a||{};this.mask=a.mask;this.channel=[0,1,2,3].indexOf(a.channel)>
-1?a.channel:0},applyTo:function(c){if(this.mask){var b=c.getContext("2d"),c=b.getImageData(0,0,c.width,c.height),f=c.data,e=this.mask.getElement(),d=a.util.createCanvasElement(),g=this.channel,l=c.width*c.height*4;d.width=e.width;d.height=e.height;d.getContext("2d").drawImage(e,0,0,e.width,e.height);d=d.getContext("2d").getImageData(0,0,e.width,e.height).data;for(e=0;e<l;e+=4)f[e+3]=d[e+g];b.putImageData(c,0,0)}},toObject:function(){return f(this.callSuper("toObject"),{mask:this.mask.toObject(),
channel:this.channel})}});a.Image.filters.Mask.fromObject=function(c,b){a.util.loadImage(c.mask.src,function(f){c.mask=new a.Image(f,c.mask);b&&b(new a.Image.filters.Mask(c))})};a.Image.filters.Mask.async=!0})(typeof m!=="undefined"?m:this);(function(d){var a=d.fabric||(d.fabric={}),f=a.util.object.extend;a.Image.filters.Noise=a.util.createClass(a.Image.filters.BaseFilter,{type:"Noise",initialize:function(a){a=a||{};this.noise=a.noise||0},applyTo:function(a){for(var b=a.getContext("2d"),a=b.getImageData(0,
0,a.width,a.height),f=a.data,e=this.noise,d,g=0,l=f.length;g<l;g+=4)d=(0.5-Math.random())*e,f[g]+=d,f[g+1]+=d,f[g+2]+=d;b.putImageData(a,0,0)},toObject:function(){return f(this.callSuper("toObject"),{noise:this.noise})}});a.Image.filters.Noise.fromObject=function(c){return new a.Image.filters.Noise(c)}})(typeof m!=="undefined"?m:this);(function(d){var a=d.fabric||(d.fabric={}),f=a.util.object.extend;a.Image.filters.Pixelate=a.util.createClass(a.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(a){a=
a||{};this.blocksize=a.blocksize||4},applyTo:function(a){var b=a.getContext("2d"),a=b.getImageData(0,0,a.width,a.height),f=a.data,e=a.height,d=a.width,g,l,o,i,m,n,x;for(l=0;l<e;l+=this.blocksize)for(o=0;o<d;o+=this.blocksize){g=l*4*d+o*4;i=f[g];m=f[g+1];n=f[g+2];x=f[g+3];for(var C=l,E=l+this.blocksize;C<E;C++)for(var s=o,w=o+this.blocksize;s<w;s++)g=C*4*d+s*4,f[g]=i,f[g+1]=m,f[g+2]=n,f[g+3]=x}b.putImageData(a,0,0)},toObject:function(){return f(this.callSuper("toObject"),{blocksize:this.blocksize})}});
a.Image.filters.Pixelate.fromObject=function(c){return new a.Image.filters.Pixelate(c)}})(typeof m!=="undefined"?m:this);(function(d){var a=d.fabric||(d.fabric={}),f=a.util.object.extend;a.Image.filters.RemoveWhite=a.util.createClass(a.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(a){a=a||{};this.threshold=a.threshold||30;this.distance=a.distance||20},applyTo:function(a){for(var b=a.getContext("2d"),a=b.getImageData(0,0,a.width,a.height),f=a.data,e=this.distance,d=255-this.threshold,
g=Math.abs,l,o,i,m=0,n=f.length;m<n;m+=4)l=f[m],o=f[m+1],i=f[m+2],l>d&&o>d&&i>d&&g(l-o)<e&&g(l-i)<e&&g(o-i)<e&&(f[m+3]=1);b.putImageData(a,0,0)},toObject:function(){return f(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}});a.Image.filters.RemoveWhite.fromObject=function(c){return new a.Image.filters.RemoveWhite(c)}})(typeof m!=="undefined"?m:this);(function(d){var a=d.fabric||(d.fabric={});a.Image.filters.Sepia=a.util.createClass(a.Image.filters.BaseFilter,{type:"Sepia",
applyTo:function(a){var c=a.getContext("2d"),a=c.getImageData(0,0,a.width,a.height),b=a.data,d=b.length,e,g;for(e=0;e<d;e+=4)g=0.3*b[e]+0.59*b[e+1]+0.11*b[e+2],b[e]=g+100,b[e+1]=g+50,b[e+2]=g+255;c.putImageData(a,0,0)}});a.Image.filters.Sepia.fromObject=function(){return new a.Image.filters.Sepia}})(typeof m!=="undefined"?m:this);(function(d){var a=d.fabric||(d.fabric={});a.Image.filters.Sepia2=a.util.createClass(a.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(a){var c=a.getContext("2d"),
a=c.getImageData(0,0,a.width,a.height),b=a.data,d=b.length,e,g,k,l;for(e=0;e<d;e+=4)g=b[e],k=b[e+1],l=b[e+2],b[e]=(g*0.393+k*0.769+l*0.189)/1.351,b[e+1]=(g*0.349+k*0.686+l*0.168)/1.203,b[e+2]=(g*0.272+k*0.534+l*0.131)/2.14;c.putImageData(a,0,0)}});a.Image.filters.Sepia2.fromObject=function(){return new a.Image.filters.Sepia2}})(typeof m!=="undefined"?m:this);(function(d){var a=d.fabric||(d.fabric={}),f=a.util.object.extend;a.Image.filters.Tint=a.util.createClass(a.Image.filters.BaseFilter,{type:"Tint",
initialize:function(c){c=c||{};this.color=c.color||"#000000";this.opacity=typeof c.opacity!=="undefined"?c.opacity:(new a.Color(this.color)).getAlpha()},applyTo:function(c){var b=c.getContext("2d"),c=b.getImageData(0,0,c.width,c.height),f=c.data,e=f.length,d,g,l,o,i,m,n,x;d=(new a.Color(this.color)).getSource();g=d[0]*this.opacity;l=d[1]*this.opacity;o=d[2]*this.opacity;x=1-this.opacity;for(d=0;d<e;d+=4)i=f[d],m=f[d+1],n=f[d+2],f[d]=g+i*x,f[d+1]=l+m*x,f[d+2]=o+n*x;b.putImageData(c,0,0)},toObject:function(){return f(this.callSuper("toObject"),
{color:this.color,opacity:this.opacity})}});a.Image.filters.Tint.fromObject=function(c){return new a.Image.filters.Tint(c)}})(typeof m!=="undefined"?m:this);(function(d){var a=d.fabric||(d.fabric={}),f=a.util.object.extend;a.Image.filters.Multiply=a.util.createClass(a.Image.filters.BaseFilter,{type:"Multiply",initialize:function(a){a=a||{};this.color=a.color||"#000000"},applyTo:function(c){var b=c.getContext("2d"),c=b.getImageData(0,0,c.width,c.height),f=c.data,e=f.length,d,g;g=(new a.Color(this.color)).getSource();
for(d=0;d<e;d+=4)f[d]*=g[0]/255,f[d+1]*=g[1]/255,f[d+2]*=g[2]/255;b.putImageData(c,0,0)},toObject:function(){return f(this.callSuper("toObject"),{color:this.color})}});a.Image.filters.Multiply.fromObject=function(c){return new a.Image.filters.Multiply(c)}})(typeof m!=="undefined"?m:this);(function(d){var a=d.fabric;a.Image.filters.Blend=a.util.createClass({type:"Blend",initialize:function(a){a=a||{};this.color=a.color||"#000";this.image=a.image||!1;this.mode=a.mode||"multiply";this.alpha=a.alpha||
1},applyTo:function(d){var c=d.getContext("2d"),d=c.getImageData(0,0,d.width,d.height),b=d.data,g,e,j,k,l,o,i,m=!1;this.image?(m=!0,i=a.util.createCanvasElement(),i.width=this.image.width,i.height=this.image.height,i=new a.StaticCanvas(i),i.add(this.image),i=i.getContext("2d").getImageData(0,0,i.width,i.height).data):(i=(new a.Color(this.color)).getSource(),g=i[0]*this.alpha,e=i[1]*this.alpha,j=i[2]*this.alpha);for(var n=0,x=b.length;n<x;n+=4)switch(k=b[n],l=b[n+1],o=b[n+2],m&&(g=i[n]*this.alpha,
e=i[n+1]*this.alpha,j=i[n+2]*this.alpha),this.mode){case "multiply":b[n]=k*g/255;b[n+1]=l*e/255;b[n+2]=o*j/255;break;case "screen":b[n]=1-(1-k)*(1-g);b[n+1]=1-(1-l)*(1-e);b[n+2]=1-(1-o)*(1-j);break;case "add":b[n]=Math.min(255,k+g);b[n+1]=Math.min(255,l+e);b[n+2]=Math.min(255,o+j);break;case "diff":case "difference":b[n]=Math.abs(k-g);b[n+1]=Math.abs(l-e);b[n+2]=Math.abs(o-j);break;case "subtract":k-=g;l-=e;o-=j;b[n]=k<0?0:k;b[n+1]=l<0?0:l;b[n+2]=o<0?0:o;break;case "darken":b[n]=Math.min(k,g);b[n+
1]=Math.min(l,e);b[n+2]=Math.min(o,j);break;case "lighten":b[n]=Math.max(k,g),b[n+1]=Math.max(l,e),b[n+2]=Math.max(o,j)}c.putImageData(d,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}});a.Image.filters.Blend.fromObject=function(d){return new a.Image.filters.Blend(d)}})(typeof m!=="undefined"?m:this);(function(d){var a=d.fabric||(d.fabric={}),f=Math.pow,c=Math.floor,b=Math.sqrt,g=Math.abs,e=Math.max,j=Math.round,k=Math.sin,l=Math.ceil;a.Image.filters.Resize=
a.util.createClass(a.Image.filters.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(a,b,c){this.rcpScaleX=1/b;this.rcpScaleY=1/c;var e=a.width,d=a.height,b=j(e*b),c=j(d*c),f;this.resizeType==="sliceHack"&&(f=this.sliceByTwo(a,e,d,b,c));this.resizeType==="hermite"&&(f=this.hermiteFastResize(a,e,d,b,c));this.resizeType==="bilinear"&&(f=this.bilinearFiltering(a,e,d,b,c));this.resizeType==="lanczos"&&(f=this.lanczosResize(a,e,d,b,c));a.width=b;a.height=
c;a.getContext("2d").putImageData(f,0,0)},sliceByTwo:function(b,d,f,g,h){var j=b.getContext("2d"),k,l=0.5,m=0.5,n=1,v=1,s=!1,r=!1,q=d,u=f,t=a.util.createCanvasElement(),y=t.getContext("2d"),g=c(g),h=c(h);t.width=e(g,d);t.height=e(h,f);g>d&&(l=2,n=-1);h>f&&(m=2,v=-1);k=j.getImageData(0,0,d,f);b.width=e(g,d);b.height=e(h,f);for(j.putImageData(k,0,0);!s||!r;)d=q,f=u,g*n<c(q*l*n)?q=c(q*l):(q=g,s=!0),h*v<c(u*m*v)?u=c(u*m):(u=h,r=!0),k=j.getImageData(0,0,d,f),y.putImageData(k,0,0),j.clearRect(0,0,q,u),
j.drawImage(t,0,0,d,f,0,0,q,u);return j.getImageData(0,0,g,h)},lanczosResize:function(a,e,d,j,m){var n,s,t,w;function A(a){var k,l,o,v,N,U,S,T,V,M;t=(a+0.5)*B;n=c(t);for(k=0;k<m;k++){w=(k+0.5)*y;s=c(w);N=0;U=0;S=0;T=0;V=0;for(l=n-L;l<=n+L;l++)if(!(l<0||l>=e)){M=c(1E3*g(l-t));I[M]||(I[M]={});for(var O=s-P;O<=s+P;O++)O<0||O>=d||(o=c(1E3*g(O-w)),I[M][o]||(I[M][o]=u(b(f(M*G,2)+f(o*H,2))/1E3)),o=I[M][o],o>0&&(v=(O*e+l)*4,N+=o,U+=o*r[v],S+=o*r[v+1],T+=o*r[v+2],V+=o*r[v+3]))}v=(k*j+a)*4;q[v]=U/N;q[v+1]=
S/N;q[v+2]=T/N;q[v+3]=V/N}return++a<j?A(a):D}var a=a.getContext("2d"),v=a.getImageData(0,0,e,d),D=a.getImageData(0,0,j,m),r=v.data,q=D.data,u=function(a){return function(b){if(b>a)return 0;b*=Math.PI;if(g(b)<1.0E-16)return 1;var c=b/a;return k(b)*k(c)/b/c}}(this.lanczosLobes),B=this.rcpScaleX,y=this.rcpScaleY,G=2/this.rcpScaleX,H=2/this.rcpScaleY,L=l(B*this.lanczosLobes/2),P=l(y*this.lanczosLobes/2),I={};t=void 0;w=void 0;n=void 0;s=void 0;return A(0)},bilinearFiltering:function(a,b,e,d,f){var g,
h,j,k,l,m,n,r,q,u,s=0,t=this.rcpScaleX,B=this.rcpScaleY;n=a.getContext("2d");var a=4*(b-1),e=n.getImageData(0,0,b,e).data,H=n.getImageData(0,0,d,f),L=H.data;for(n=0;n<f;n++)for(r=0;r<d;r++){l=c(t*r);m=c(B*n);q=t*r-l;u=B*n-m;m=4*(m*b+l);for(l=0;l<4;l++)g=e[m+l],h=e[m+4+l],j=e[m+a+l],k=e[m+a+4+l],g=g*(1-q)*(1-u)+h*q*(1-u)+j*u*(1-q)+k*q*u,L[s++]=g}return H},hermiteFastResize:function(a,e,d,f,j){for(var k=this.rcpScaleX,m=this.rcpScaleY,n=l(k/2),s=l(m/2),a=a.getContext("2d"),d=a.getImageData(0,0,e,d).data,
a=a.getImageData(0,0,f,j),t=a.data,v=0;v<j;v++)for(var B=0;B<f;B++){for(var r=(B+v*f)*4,q=0,u=0,F=0,y=0,G=0,H=0,L=0,P=(v+0.5)*m,I=c(v*m);I<(v+1)*m;I++){var R=g(P-(I+0.5))/s,W=(B+0.5)*k;R*=R;for(var Q=c(B*k);Q<(B+1)*k;Q++){var J=g(W-(Q+0.5))/n,q=b(R+J*J);q>1&&q<-1||(q=2*q*q*q-3*q*q+1,q>0&&(J=4*(Q+I*e),L+=q*d[J+3],F+=q,d[J+3]<255&&(q=q*d[J+3]/250),y+=q*d[J],G+=q*d[J+1],H+=q*d[J+2],u+=q))}}t[r]=y/u;t[r+1]=G/u;t[r+2]=H/u;t[r+3]=L/F}return a}});a.Image.filters.Resize.fromObject=function(){return new a.Image.filters.Resize}})(typeof m!==
"undefined"?m:this);(function(d){var a=d.fabric||(d.fabric={}),f=a.util.object.extend,c=a.util.object.clone,b=a.util.toFixed,g=a.StaticCanvas.supports("setLineDash");a.Text?a.warn("fabric.Text is already defined"):(d=a.Object.prototype.stateProperties.concat(),d.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","useNative","path"),a.Text=a.util.createClass(a.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,
textDecoration:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.3,textBackgroundColor:"",path:null,useNative:!0,stateProperties:d,stroke:null,shadow:null,initialize:function(a,b){b=b||{};this.text=a;this.__skipDimension=!0;this.setOptions(b);this.__skipDimension=!1;this._initDimensions()},_initDimensions:function(){this.__skipDimension||
this._render(a.util.createCanvasElement().getContext("2d"))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(a){typeof Cufon==="undefined"||this.useNative===!0?this._renderViaNative(a):this._renderViaCufon(a)},_renderViaNative:function(b){var c=this.text.split(this._reNewline);this._setTextStyles(b);this.width=this._getTextWidth(b,c);this.height=this._getTextHeight(b,c);this.clipTo&&a.util.clipContext(this,
b);this._renderTextBackground(b,c);this._translateForTextAlign(b);this._renderText(b,c);this.textAlign!=="left"&&this.textAlign!=="justify"&&b.restore();this._renderTextDecoration(b,c);this.clipTo&&b.restore();this._setBoundaries(b,c);this._totalLineHeight=0},_renderText:function(a,b){a.save();this._setOpacity(a);this._setShadow(a);this._setupCompositeOperation(a);this._renderTextFill(a,b);this._renderTextStroke(a,b);this._restoreCompositeOperation(a);this._removeShadow(a);a.restore()},_translateForTextAlign:function(a){this.textAlign!==
"left"&&this.textAlign!=="justify"&&(a.save(),a.translate(this.textAlign==="center"?this.width/2:this.width,0))},_setBoundaries:function(a,b){this._boundaries=[];for(var c=0,d=b.length;c<d;c++){var f=this._getLineWidth(a,b[c]),g=this._getLineLeftOffset(f);this._boundaries.push({height:this.fontSize*this.lineHeight,width:f,left:g})}},_setTextStyles:function(a){this._setFillStyles(a);this._setStrokeStyles(a);a.textBaseline="alphabetic";if(!this.skipTextAlign)a.textAlign=this.textAlign;a.font=this._getFontDeclaration()},
_getTextHeight:function(a,b){return this.fontSize*b.length*this.lineHeight},_getTextWidth:function(a,b){for(var c=a.measureText(b[0]||"|").width,d=1,f=b.length;d<f;d++){var g=a.measureText(b[d]).width;g>c&&(c=g)}return c},_renderChars:function(a,b,c,d,f){b[a](c,d,f)},_renderTextLine:function(a,b,c,d,f,g){f-=this.fontSize/4;if(this.textAlign!=="justify")this._renderChars(a,b,c,d,f,g);else{var h=b.measureText(c).width,m=this.width;if(m>h)for(var h=c.split(/\s+/),c=b.measureText(c.replace(/\s+/g,"")).width,
m=(m-c)/(h.length-1),n=c=0,s=h.length;n<s;n++)this._renderChars(a,b,h[n],d+c,f,g),c+=b.measureText(h[n]).width+m;else this._renderChars(a,b,c,d,f,g)}},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(a,b){if(this.fill||this._skipFillStrokeCheck){this._boundaries=[];for(var c=0,d=0,f=b.length;d<f;d++){var g=this._getHeightOfLine(a,d,b);c+=g;this._renderTextLine("fillText",a,b[d],this._getLeftOffset(),this._getTopOffset()+c,d)}this.shadow&&
!this.shadow.affectStroke&&this._removeShadow(a)}},_renderTextStroke:function(a,b){if(this.stroke&&this.strokeWidth!==0||this._skipFillStrokeCheck){var c=0;a.save();this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),g&&a.setLineDash(this.strokeDashArray));a.beginPath();for(var d=0,f=b.length;d<f;d++){var i=this._getHeightOfLine(a,d,b);c+=i;this._renderTextLine("strokeText",a,b[d],this._getLeftOffset(),this._getTopOffset()+
c,d)}a.closePath();a.restore()}},_getHeightOfLine:function(){return this.fontSize*this.lineHeight},_renderTextBackground:function(a,b){this._renderTextBoxBackground(a);this._renderTextLinesBackground(a,b)},_renderTextBoxBackground:function(a){if(this.backgroundColor)a.save(),a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),a.restore()},_renderTextLinesBackground:function(a,b){if(this.textBackgroundColor){a.save();a.fillStyle=this.textBackgroundColor;
for(var c=0,d=b.length;c<d;c++)if(b[c]!==""){var f=this._getLineWidth(a,b[c]),g=this._getLineLeftOffset(f);a.fillRect(this._getLeftOffset()+g,this._getTopOffset()+c*this.fontSize*this.lineHeight,f,this.fontSize*this.lineHeight)}a.restore()}},_getLineLeftOffset:function(a){return this.textAlign==="center"?(this.width-a)/2:this.textAlign==="right"?this.width-a:0},_getLineWidth:function(a,b){return this.textAlign==="justify"?this.width:a.measureText(b).width},_renderTextDecoration:function(a,b){function c(g){for(var h=
0,k=b.length;h<k;h++){var m=f._getLineWidth(a,b[h]),n=f._getLineLeftOffset(m);a.fillRect(f._getLeftOffset()+n,~~(g+h*f._getHeightOfLine(a,h,b)-d),m,1)}}if(this.textDecoration){var d=this._getTextHeight(a,b)/2,f=this;this.textDecoration.indexOf("underline")>-1&&c(this.fontSize*this.lineHeight);this.textDecoration.indexOf("line-through")>-1&&c(this.fontSize*this.lineHeight-this.fontSize/2);this.textDecoration.indexOf("overline")>-1&&c(this.fontSize*this.lineHeight-this.fontSize)}},_getFontDeclaration:function(){return[a.isLikelyNode?
this.fontWeight:this.fontStyle,a.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",a.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(a,b){if(this.visible){a.save();b||this.transform(a);var c=this.group&&this.group.type==="path-group";c&&a.translate(-this.group.width/2,-this.group.height/2);this.transformMatrix&&a.transform.apply(a,this.transformMatrix);c&&a.translate(this.left,this.top);this._render(a);a.restore()}},toObject:function(a){a=f(this.callSuper("toObject",
a),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,path:this.path,textBackgroundColor:this.textBackgroundColor,useNative:this.useNative});this.includeDefaultValues||this._removeDefaultValues(a);return a},toSVG:function(a){var b=[],c=this.text.split(this._reNewline),d=this._getSVGLeftTopOffsets(c),f=this._getSVGTextAndBg(d.lineTop,d.textLeft,c),
c=this._getSVGShadows(d.lineTop,c);d.textTop+=this._fontAscent?this._fontAscent/5*this.lineHeight:0;this._wrapSVGTextAndBg(b,f,c,d);return a?a(b.join("")):b.join("")},_getSVGLeftTopOffsets:function(a){return{textLeft:-(this.width/2)+(this.group&&this.group.type==="path-group"?this.left:0),textTop:(this.useNative?this.fontSize*this.lineHeight-0.25*this.fontSize:this.height/2-a.length*this.fontSize-this._totalLineHeight)+(this.group&&this.group.type==="path-group"?this.top:0),lineTop:this.useNative?
this.fontSize*this.lineHeight:-this._fontAscent-this._fontAscent/5*this.lineHeight}},_wrapSVGTextAndBg:function(a,c,d,f){a.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',c.textBgRects.join(""),"<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+
this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" ','transform="translate(',b(f.textLeft,2)," ",b(f.textTop,2),')">',d.join(""),c.textSpans.join(""),"</text>\n","</g>\n")},_getSVGShadows:function(c,d){var f=[],g,h,i=1;if(!this.shadow||!this._boundaries)return f;for(g=0,h=d.length;g<h;g++)d[g]!==""?(f.push('<tspan x="',b((this._boundaries&&this._boundaries[g]?this._boundaries[g].left:0)+i+this.shadow.offsetX,2),g===0||this.useNative?'" y':'" dy','="',b(this.useNative?c*g-this.height/2+this.shadow.offsetY:
c+(g===0?this.shadow.offsetY:0),2),'" ',this._getFillAttributes(this.shadow.color),">",a.util.string.escapeXml(d[g]),"</tspan>"),i=1):i++;return f},_getSVGTextAndBg:function(a,b,c){var d=[],f=[],g=1;this._setSVGBg(f);for(var h=0,m=c.length;h<m;h++)c[h]!==""?(this._setSVGTextLineText(c[h],h,d,a,g,f),g=1):g++,this.textBackgroundColor&&this._boundaries&&this._setSVGTextLineBg(f,h,b,a);return{textSpans:d,textBgRects:f}},_setSVGTextLineText:function(c,d,f,g,h){var i=this._boundaries&&this._boundaries[d]?
b(this._boundaries[d].left,2):0;f.push('<tspan x="',i,'" ',d===0||this.useNative?"y":"dy",'="',b(this.useNative?g*d-this.height/2:g*h,2),'" ',this._getFillAttributes(this.fill),">",a.util.string.escapeXml(c),"</tspan>")},_setSVGTextLineBg:function(a,c,d,f){a.push("<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',b(d+this._boundaries[c].left,2),'" y="',b(f*c-this.height/2,2),'" width="',b(this._boundaries[c].width,2),'" height="',b(this._boundaries[c].height,2),'"></rect>\n')},_setSVGBg:function(a){this.backgroundColor&&
this._boundaries&&a.push("<rect ",this._getFillAttributes(this.backgroundColor),' x="',b(-this.width/2,2),'" y="',b(-this.height/2,2),'" width="',b(this.width,2),'" height="',b(this.height,2),'"></rect>')},_getFillAttributes:function(b){var c=b&&typeof b==="string"?new a.Color(b):"";return!c||!c.getSource()||c.getAlpha()===1?'fill="'+b+'"':'opacity="'+c.getAlpha()+'" fill="'+c.setAlpha(1).toRgb()+'"'},_set:function(a,b){if(a==="fontFamily"&&this.path)this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,
"$1"+b+"$3");this.callSuper("_set",a,b);a in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),a.Text.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),a.Text.DEFAULT_SVG_FONT_SIZE=16,a.Text.fromElement=function(b,c){if(!b)return null;var d=a.parseAttributes(b,a.Text.ATTRIBUTE_NAMES),c=a.util.object.extend(c?a.util.object.clone(c):{},d);c.top=c.top||0;
c.left=c.left||0;"dx"in d&&(c.left+=d.dx);"dy"in d&&(c.top+=d.dy);if(!("fontSize"in c))c.fontSize=a.Text.DEFAULT_SVG_FONT_SIZE;if(!c.originX)c.originX="left";c.top+=c.fontSize/4;var d=new a.Text(b.textContent,c),f=0;d.originX==="left"&&(f=d.getWidth()/2);d.originX==="right"&&(f=-d.getWidth()/2);d.set({left:d.getLeft()+f,top:d.getTop()-d.getHeight()/2});return d},a.Text.fromObject=function(b){return new a.Text(b.text,c(b))},a.util.createAccessors(a.Text))})(typeof m!=="undefined"?m:this);(function(){var d=
g.util.object.clone;g.IText=g.util.createClass(g.Text,g.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1E3,cursorDuration:600,styles:null,caching:!0,_skipFillStrokeCheck:!0,_reSpace:/\s|\n/,_fontSizeFraction:4,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},initialize:function(a,d){this.styles=
d?d.styles||{}:{};this.callSuper("initialize",a,d);this.initBehavior();g.IText.instances.push(this);this.__lineWidths={};this.__lineHeights={};this.__lineOffsets={}},isEmptyStyles:function(){if(!this.styles)return!0;var a=this.styles,d;for(d in a)for(var c in a[d])for(var b in a[d][c])return!1;return!0},setSelectionStart:function(a){this.selectionStart!==a&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}));this.selectionStart=a;this.hiddenTextarea&&
(this.hiddenTextarea.selectionStart=a)},setSelectionEnd:function(a){this.selectionEnd!==a&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}));this.selectionEnd=a;this.hiddenTextarea&&(this.hiddenTextarea.selectionEnd=a)},getSelectionStyles:function(a,d){if(arguments.length===2){for(var c=[],b=a;b<d;b++)c.push(this.getSelectionStyles(b));return c}c=this.get2DCursorLocation(a);return this.styles[c.lineIndex]?this.styles[c.lineIndex][c.charIndex]||
{}:{}},setSelectionStyles:function(a){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,a);else for(var d=this.selectionStart;d<this.selectionEnd;d++)this._extendStyles(d,a);return this},_extendStyles:function(a,d){var c=this.get2DCursorLocation(a);this.styles[c.lineIndex]||(this.styles[c.lineIndex]={});this.styles[c.lineIndex][c.charIndex]||(this.styles[c.lineIndex][c.charIndex]={});g.util.object.extend(this.styles[c.lineIndex][c.charIndex],d)},_render:function(a){this.callSuper("_render",
a);this.ctx=a;this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(this.active){var a=this.text.split(""),d;this.selectionStart===this.selectionEnd?(d=this._getCursorBoundaries(a,"cursor"),this.renderCursor(d)):(d=this._getCursorBoundaries(a,"selection"),this.renderSelection(a,d))}},get2DCursorLocation:function(a){if(typeof a==="undefined")a=this.selectionStart;a=this.text.slice(0,a).split(this._reNewline);return{lineIndex:a.length-1,charIndex:a[a.length-1].length}},
getCurrentCharStyle:function(a,d){var c=this.styles[a]&&this.styles[a][d===0?0:d-1];return{fontSize:c&&c.fontSize||this.fontSize,fill:c&&c.fill||this.fill,textBackgroundColor:c&&c.textBackgroundColor||this.textBackgroundColor,textDecoration:c&&c.textDecoration||this.textDecoration,fontFamily:c&&c.fontFamily||this.fontFamily,fontWeight:c&&c.fontWeight||this.fontWeight,fontStyle:c&&c.fontStyle||this.fontStyle,stroke:c&&c.stroke||this.stroke,strokeWidth:c&&c.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(a,
d){return this.styles[a]&&this.styles[a][d===0?0:d-1]&&this.styles[a][d===0?0:d-1].fontSize||this.fontSize},getCurrentCharColor:function(a,d){return this.styles[a]&&this.styles[a][d===0?0:d-1]&&this.styles[a][d===0?0:d-1].fill||this.cursorColor},_getCursorBoundaries:function(a,d){var c=this.get2DCursorLocation(),b=this.text.split(this._reNewline),g=Math.round(this._getLeftOffset()),e=this._getTopOffset(),c=this._getCursorBoundariesOffsets(a,d,c,b);return{left:g,top:e,leftOffset:c.left+c.lineLeft,
topOffset:c.top}},_getCursorBoundariesOffsets:function(a,d,c,b){for(var g=0,e=0,j=0,k=0,c=d==="cursor"?this._getHeightOfLine(this.ctx,0)-this.getCurrentCharFontSize(c.lineIndex,c.charIndex):0,l=0;l<this.selectionStart;l++)a[l]==="\n"?(k=0,c+=this._getCachedLineHeight(e+(d==="cursor"?1:0)),e++,j=0):(k+=this._getWidthOfChar(this.ctx,a[l],e,j),j++),g=this._getCachedLineOffset(e,b);this._clearCache();return{top:c,left:k,lineLeft:g}},_clearCache:function(){this.__lineWidths={};this.__lineHeights={};this.__lineOffsets=
{}},_getCachedLineHeight:function(a){return this.__lineHeights[a]||(this.__lineHeights[a]=this._getHeightOfLine(this.ctx,a))},_getCachedLineWidth:function(a,d){return this.__lineWidths[a]||(this.__lineWidths[a]=this._getWidthOfLine(this.ctx,a,d))},_getCachedLineOffset:function(a,d){var c=this._getCachedLineWidth(a,d);return this.__lineOffsets[a]||(this.__lineOffsets[a]=this._getLineLeftOffset(c))},renderCursor:function(a){var d=this.ctx;d.save();var c=this.get2DCursorLocation(),b=c.lineIndex,c=c.charIndex,
g=this.getCurrentCharFontSize(b,c),e=b===0&&c===0?this._getCachedLineOffset(b,this.text.split(this._reNewline)):a.leftOffset;d.fillStyle=this.getCurrentCharColor(b,c);d.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity;d.fillRect(a.left+e,a.top+a.topOffset,this.cursorWidth/this.scaleX,g);d.restore()},renderSelection:function(a,d){var c=this.ctx;c.save();c.fillStyle=this.selectionColor;for(var b=this.get2DCursorLocation(this.selectionStart),g=this.get2DCursorLocation(this.selectionEnd),e=
b.lineIndex,j=g.lineIndex,k=this.text.split(this._reNewline),l=e;l<=j;l++){var m=this._getCachedLineOffset(l,k)||0,i=this._getCachedLineHeight(l),n=0;if(l===e)for(var z=0,x=k[l].length;z<x;z++){if(z>=b.charIndex&&(l!==j||z<g.charIndex))n+=this._getWidthOfChar(c,k[l][z],l,z);z<b.charIndex&&(m+=this._getWidthOfChar(c,k[l][z],l,z))}else if(l>e&&l<j)n+=this._getCachedLineWidth(l,k)||5;else if(l===j){z=0;for(x=g.charIndex;z<x;z++)n+=this._getWidthOfChar(c,k[l][z],l,z)}c.fillRect(d.left+m,d.top+d.topOffset,
n,i);d.topOffset+=i}c.restore()},_renderChars:function(a,d,c,b,g,e){if(this.isEmptyStyles())return this._renderCharsFast(a,d,c,b,g);this.skipTextAlign=!0;b-=this.textAlign==="center"?this.width/2:this.textAlign==="right"?this.width:0;var j=this.text.split(this._reNewline),k=this._getWidthOfLine(d,e,j),j=this._getHeightOfLine(d,e,j),l=this._getLineLeftOffset(k),c=c.split(""),m,k="";b+=l||0;d.save();for(var l=0,i=c.length;l<=i;l++){m=m||this.getCurrentCharStyle(e,l);var n=this.getCurrentCharStyle(e,
l+1);if(this._hasStyleChanged(m,n)||l===i)this._renderChar(a,d,e,l-1,k,b,g,j),k="",m=n;k+=c[l]}d.restore()},_renderCharsFast:function(a,d,c,b,g){this.skipTextAlign=!1;a==="fillText"&&this.fill&&this.callSuper("_renderChars",a,d,c,b,g);a==="strokeText"&&this.stroke&&this.callSuper("_renderChars",a,d,c,b,g)},_renderChar:function(a,d,c,b,g,e,j,k){var l;if(this.styles&&this.styles[c]&&(l=this.styles[c][b])){var m=l.stroke||this.stroke,i=l.fill||this.fill;d.save();a=this._applyCharStylesGetWidth(d,g,c,
b,l);c=this._getHeightOfChar(d,g,c,b);i&&d.fillText(g,e,j);m&&d.strokeText(g,e,j);this._renderCharDecoration(d,l,e,j,a,k,c);d.restore();d.translate(a,0)}else{if(a==="strokeText"&&this.stroke)d[a](g,e,j);if(a==="fillText"&&this.fill)d[a](g,e,j);a=this._applyCharStylesGetWidth(d,g,c,b);this._renderCharDecoration(d,null,e,j,a,k);d.translate(d.measureText(g).width,0)}},_hasStyleChanged:function(a,d){return a.fill!==d.fill||a.fontSize!==d.fontSize||a.textBackgroundColor!==d.textBackgroundColor||a.textDecoration!==
d.textDecoration||a.fontFamily!==d.fontFamily||a.fontWeight!==d.fontWeight||a.fontStyle!==d.fontStyle||a.stroke!==d.stroke||a.strokeWidth!==d.strokeWidth},_renderCharDecoration:function(a,d,c,b,g,e,j){var k=d?d.textDecoration||this.textDecoration:this.textDecoration,d=(d?d.fontSize:null)||this.fontSize;k&&(k.indexOf("underline")>-1&&this._renderCharDecorationAtOffset(a,c,b+this.fontSize/this._fontSizeFraction,g,0,this.fontSize/20),k.indexOf("line-through")>-1&&this._renderCharDecorationAtOffset(a,
c,b+this.fontSize/this._fontSizeFraction,g,j/2,d/20),k.indexOf("overline")>-1&&this._renderCharDecorationAtOffset(a,c,b,g,e-this.fontSize/this._fontSizeFraction,this.fontSize/20))},_renderCharDecorationAtOffset:function(a,d,c,b,g,e){a.fillRect(d,c-g,b,e)},_renderTextLine:function(a,d,c,b,g,e){g+=this.fontSize/4;this.callSuper("_renderTextLine",a,d,c,b,g,e)},_renderTextDecoration:function(a,d){if(this.isEmptyStyles())return this.callSuper("_renderTextDecoration",a,d)},_renderTextLinesBackground:function(a,
d){if(this.textBackgroundColor||this.styles){a.save();if(this.textBackgroundColor)a.fillStyle=this.textBackgroundColor;for(var c=0,b=this.fontSize/this._fontSizeFraction,g=0,e=d.length;g<e;g++){var j=this._getHeightOfLine(a,g,d);if(d[g]!==""){var k=this._getWidthOfLine(a,g,d),l=this._getLineLeftOffset(k);if(this.textBackgroundColor)a.fillStyle=this.textBackgroundColor,a.fillRect(this._getLeftOffset()+l,this._getTopOffset()+c+b,k,j);if(this.styles[g])for(var k=0,m=d[g].length;k<m;k++)if(this.styles[g]&&
this.styles[g][k]&&this.styles[g][k].textBackgroundColor){var i=d[g][k];a.fillStyle=this.styles[g][k].textBackgroundColor;a.fillRect(this._getLeftOffset()+l+this._getWidthOfCharsAt(a,g,k,d),this._getTopOffset()+c+b,this._getWidthOfChar(a,i,g,k,d)+1,j)}}c+=j}a.restore()}},_getCacheProp:function(a,d){return a+d.fontFamily+d.fontSize+d.fontWeight+d.fontStyle+d.shadow},_applyCharStylesGetWidth:function(a,f,c,b,h){var e;e=(c=h||this.styles[c]&&this.styles[c][b])?d(c):{},c=e;this._applyFontStyles(c);b=
this._getCacheProp(f,c);if(this.isEmptyStyles()&&this._charWidthsCache[b]&&this.caching)return this._charWidthsCache[b];if(typeof c.shadow==="string")c.shadow=new g.Shadow(c.shadow);h=c.fill||this.fill;a.fillStyle=h.toLive?h.toLive(a):h;if(c.stroke)a.strokeStyle=c.stroke&&c.stroke.toLive?c.stroke.toLive(a):c.stroke;a.lineWidth=c.strokeWidth||this.strokeWidth;a.font=this._getFontDeclaration.call(c);this._setShadow.call(c,a);if(!this.caching)return a.measureText(f).width;if(!this._charWidthsCache[b])this._charWidthsCache[b]=
a.measureText(f).width;return this._charWidthsCache[b]},_applyFontStyles:function(a){if(!a.fontFamily)a.fontFamily=this.fontFamily;if(!a.fontSize)a.fontSize=this.fontSize;if(!a.fontWeight)a.fontWeight=this.fontWeight;if(!a.fontStyle)a.fontStyle=this.fontStyle},_getStyleDeclaration:function(a,f){return this.styles[a]&&this.styles[a][f]?d(this.styles[a][f]):{}},_getWidthOfChar:function(a,d,c,b){if(this.textAlign==="justify"&&/\s/.test(d))return this._getWidthOfSpace(a,c);var g=this._getStyleDeclaration(c,
b);this._applyFontStyles(g);g=this._getCacheProp(d,g);if(this._charWidthsCache[g]&&this.caching)return this._charWidthsCache[g];else if(a)return a.save(),d=this._applyCharStylesGetWidth(a,d,c,b),a.restore(),d},_getHeightOfChar:function(a,d,c,b){return this.styles[c]&&this.styles[c][b]?this.styles[c][b].fontSize||this.fontSize:this.fontSize},_getWidthOfCharAt:function(a,d,c,b){b=b||this.text.split(this._reNewline);b=b[d].split("")[c];return this._getWidthOfChar(a,b,d,c)},_getHeightOfCharAt:function(a,
d,c,b){b=b||this.text.split(this._reNewline);b=b[d].split("")[c];return this._getHeightOfChar(a,b,d,c)},_getWidthOfCharsAt:function(a,d,c,b){for(var g=0,e=0;e<c;e++)g+=this._getWidthOfCharAt(a,d,e,b);return g},_getWidthOfLine:function(a,d,c){return this._getWidthOfCharsAt(a,d,c[d].length,c)},_getWidthOfSpace:function(a,d){var c=this.text.split(this._reNewline)[d],b=c.split(/\s+/);return(this.width-this._getWidthOfWords(a,c,d))/(b.length-1)},_getWidthOfWords:function(a,d,c){for(var b=0,g=0;g<d.length;g++){var e=
d[g];e.match(/\s/)||(b+=this._getWidthOfChar(a,e,c,g))}return b},_getTextWidth:function(a,d){if(this.isEmptyStyles())return this.callSuper("_getTextWidth",a,d);for(var c=this._getWidthOfLine(a,0,d),b=1,g=d.length;b<g;b++){var e=this._getWidthOfLine(a,b,d);e>c&&(c=e)}return c},_getHeightOfLine:function(a,d,c){for(var c=c||this.text.split(this._reNewline),b=this._getHeightOfChar(a,c[d][0],d,0),c=c[d].split(""),g=1,e=c.length;g<e;g++){var j=this._getHeightOfChar(a,c[g],d,g);j>b&&(b=j)}return b*this.lineHeight},
_getTextHeight:function(a,d){for(var c=0,b=0,g=d.length;b<g;b++)c+=this._getHeightOfLine(a,b,d);return c},_getTopOffset:function(){return g.Text.prototype._getTopOffset.call(this)-this.fontSize/this._fontSizeFraction},_renderTextBoxBackground:function(a){if(this.backgroundColor)a.save(),a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset()+this.fontSize/this._fontSizeFraction,this.width,this.height),a.restore()},toObject:function(a){return g.util.object.extend(this.callSuper("toObject",
a),{styles:d(this.styles)})}});g.IText.fromObject=function(a){return new g.IText(a.text,d(a))};g.IText.instances=[]})();(function(){var d=g.util.object.clone;g.util.object.extend(g.IText.prototype,{initBehavior:function(){this.initAddedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var a=this;setTimeout(function(){a.selected=!0},100)})},initAddedHandler:function(){this.on("added",function(){if(this.canvas&&
!this.canvas._hasITextHandlers)this.canvas._hasITextHandlers=!0,this._initCanvasHandlers()})},_initCanvasHandlers:function(){this.canvas.on("selection:cleared",function(){g.IText.prototype.exitEditingOnOthers.call()});this.canvas.on("mouse:up",function(){g.IText.instances.forEach(function(a){a.__isMousedown=!1})});this.canvas.on("object:selected",function(a){g.IText.prototype.exitEditingOnOthers.call(a.target)})},_tick:function(){if(!this._abortCursorAnimation){var a=this;this.animate("_currentCursorOpacity",
1,{duration:this.cursorDuration,onComplete:function(){a._onTickComplete()},onChange:function(){a.canvas&&a.canvas.renderAll()},abort:function(){return a._abortCursorAnimation}})}},_onTickComplete:function(){if(!this._abortCursorAnimation){var a=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1);this._cursorTimeout1=setTimeout(function(){a.animate("_currentCursorOpacity",0,{duration:this.cursorDuration/2,onComplete:function(){a._tick()},onChange:function(){a.canvas&&a.canvas.renderAll()},
abort:function(){return a._abortCursorAnimation}})},100)}},initDelayedCursor:function(a){var d=this,c=a?0:this.cursorDelay;if(a)this._abortCursorAnimation=!0,clearTimeout(this._cursorTimeout1),this._currentCursorOpacity=1,this.canvas&&this.canvas.renderAll();this._cursorTimeout2&&clearTimeout(this._cursorTimeout2);this._cursorTimeout2=setTimeout(function(){d._abortCursorAnimation=!1;d._tick()},c)},abortCursorAnimation:function(){this._abortCursorAnimation=!0;clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);
this._currentCursorOpacity=0;this.canvas&&this.canvas.renderAll();var a=this;setTimeout(function(){a._abortCursorAnimation=!1},10)},selectAll:function(){this.selectionStart=0;this.selectionEnd=this.text.length;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(a){var d=0,c=a-1;if(this._reSpace.test(this.text.charAt(c)))for(;this._reSpace.test(this.text.charAt(c));)d++,
c--;for(;/\S/.test(this.text.charAt(c))&&c>-1;)d++,c--;return a-d},findWordBoundaryRight:function(a){var d=0,c=a;if(this._reSpace.test(this.text.charAt(c)))for(;this._reSpace.test(this.text.charAt(c));)d++,c++;for(;/\S/.test(this.text.charAt(c))&&c<this.text.length;)d++,c++;return a+d},findLineBoundaryLeft:function(a){for(var d=0,c=a-1;!/\n/.test(this.text.charAt(c))&&c>-1;)d++,c--;return a-d},findLineBoundaryRight:function(a){for(var d=0,c=a;!/\n/.test(this.text.charAt(c))&&c<this.text.length;)d++,
c++;return a+d},getNumNewLinesInSelectedText:function(){for(var a=0,d=0,c=this.getSelectedText().split(""),b=c.length;d<b;d++)c[d]==="\n"&&a++;return a},searchWordBoundary:function(a,d){for(var c=this._reSpace.test(this.text.charAt(a))?a-1:a,b=this.text.charAt(c),g=/[ \n\.,;!\?\-]/;!g.test(b)&&c>0&&c<this.text.length;)c+=d,b=this.text.charAt(c);g.test(b)&&b!=="\n"&&(c+=d===1?0:1);return c},selectWord:function(a){var d=this.searchWordBoundary(a,-1),a=this.searchWordBoundary(a,1);this.setSelectionStart(d);
this.setSelectionEnd(a);this.initDelayedCursor(!0)},selectLine:function(a){var d=this.findLineBoundaryLeft(a),a=this.findLineBoundaryRight(a);this.setSelectionStart(d);this.setSelectionEnd(a);this.initDelayedCursor(!0)},enterEditing:function(){if(!this.isEditing&&this.editable)return this.exitEditingOnOthers(),this.isEditing=!0,this.initHiddenTextarea(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._tick(),this.canvas&&this.canvas.renderAll(),this.fire("editing:entered"),
this.canvas&&this.canvas.fire("text:editing:entered",{target:this}),this},exitEditingOnOthers:function(){g.IText.instances.forEach(function(a){a.selected=!1;a.isEditing&&a.exitEditing()},this)},_setEditingProps:function(){this.hoverCursor="text";if(this.canvas)this.canvas.defaultCursor=this.canvas.moveCursor="text";this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=!1;this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){if(this.hiddenTextarea)this.hiddenTextarea.value=
this.text,this.hiddenTextarea.selectionStart=this.selectionStart},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){if(this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,
this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas))this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor},exitEditing:function(){this.isEditing=this.selected=!1;this.selectable=!0;this.selectionEnd=this.selectionStart;this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea);this.hiddenTextarea=null;
this.abortCursorAnimation();this._restoreEditingProps();this._currentCursorOpacity=0;this.fire("editing:exited");this.canvas&&this.canvas.fire("text:editing:exited",{target:this});return this},_removeExtraneousStyles:function(){var a=this.text.split(this._reNewline),d;for(d in this.styles)a[d]||delete this.styles[d]},_removeCharsFromTo:function(a,d){for(var c=d;c!==a;){var b=this.get2DCursorLocation(c).charIndex;c--;(b=this.get2DCursorLocation(c).charIndex>b)?this.removeStyleObject(b,c+1):this.removeStyleObject(this.get2DCursorLocation(c).charIndex===
0,c)}this.text=this.text.slice(0,a)+this.text.slice(d)},insertChars:function(a){var d=this.text.slice(this.selectionStart,this.selectionStart+1)==="\n";this.text=this.text.slice(0,this.selectionStart)+a+this.text.slice(this.selectionEnd);this.selectionStart===this.selectionEnd&&this.insertStyleObjects(a,d,this.copiedStyles);this.selectionStart+=a.length;this.selectionEnd=this.selectionStart;this.canvas&&this.canvas.renderAll().renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",
{target:this})},insertNewlineStyleObject:function(a,f,c){this.shiftLineStyles(a,1);this.styles[a+1]||(this.styles[a+1]={});var b=this.styles[a][f-1],g={};if(c)g[0]=d(b);else for(var e in this.styles[a])parseInt(e,10)>=f&&(g[parseInt(e,10)-f]=this.styles[a][e],delete this.styles[a][e]);this.styles[a+1]=g},insertCharStyleObject:function(a,f,c){var b=this.styles[a],g=d(b);f===0&&!c&&(f=1);for(var e in g){var j=parseInt(e,10);j>=f&&(b[j+1]=g[j])}this.styles[a][f]=c||d(b[f-1])},insertStyleObjects:function(a,
d,c){var b=this.get2DCursorLocation(),g=b.lineIndex,b=b.charIndex;this.styles[g]||(this.styles[g]={});a==="\n"?this.insertNewlineStyleObject(g,b,d):c?this._insertStyles(c):this.insertCharStyleObject(g,b)},_insertStyles:function(a){for(var d=0,c=a.length;d<c;d++){var b=this.get2DCursorLocation(this.selectionStart+d);this.insertCharStyleObject(b.lineIndex,b.charIndex,a[d])}},shiftLineStyles:function(a,f){var c=d(this.styles),b;for(b in this.styles){var g=parseInt(b,10);g>a&&(this.styles[g+f]=c[g])}},
removeStyleObject:function(a,f){var c=this.get2DCursorLocation(f),b=c.lineIndex,c=c.charIndex;if(a){var g=this.text.split(this._reNewline)[b-1],g=g?g.length:0;this.styles[b-1]||(this.styles[b-1]={});for(c in this.styles[b])this.styles[b-1][parseInt(c,10)+g]=this.styles[b][c];this.shiftLineStyles(b,-1)}else{(b=this.styles[b])&&delete b[c+(this.selectionStart===this.selectionEnd?-1:0)];var e=d(b);for(g in e){var j=parseInt(g,10);j>=c&&j!==0&&(b[j-1]=e[j],delete b[j])}}},insertNewline:function(){this.insertChars("\n")}})})();
g.util.object.extend(g.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date;this.__lastLastClickTime=+new Date;this.__lastPointer={};this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(d){this.__newClickTime=+new Date;var a=this.canvas.getPointer(d.e);this.isTripleClick(a)?(this.fire("tripleclick",d),this._stopEvent(d.e)):this.isDoubleClick(a)&&(this.fire("dblclick",d),this._stopEvent(d.e));this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=
this.__newClickTime;this.__lastPointer=a;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected},isDoubleClick:function(d){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===d.x&&this.__lastPointer.y===d.y&&this.__lastIsEditing},isTripleClick:function(d){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===d.x&&this.__lastPointer.y===d.y},_stopEvent:function(d){d.preventDefault&&d.preventDefault();
d.stopPropagation&&d.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler();this.initMousedownHandler();this.initMousemoveHandler();this.initMouseupHandler();this.initClicks()},initClicks:function(){this.on("dblclick",function(d){this.selectWord(this.getSelectionStartFromPointer(d.e))});this.on("tripleclick",function(d){this.selectLine(this.getSelectionStartFromPointer(d.e))})},initMousedownHandler:function(){this.on("mousedown",function(d){var a=this.canvas.getPointer(d.e);
this.__mousedownX=a.x;this.__mousedownY=a.y;this.__isMousedown=!0;this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea);this.selected&&this.setCursorByClick(d.e);if(this.isEditing)this.__selectionStartOnMouseDown=this.selectionStart,this.initDelayedCursor(!0)})},initMousemoveHandler:function(){this.on("mousemove",function(d){this.__isMousedown&&this.isEditing&&(d=this.getSelectionStartFromPointer(d.e),d>=this.__selectionStartOnMouseDown?(this.setSelectionStart(this.__selectionStartOnMouseDown),
this.setSelectionEnd(d)):(this.setSelectionStart(d),this.setSelectionEnd(this.__selectionStartOnMouseDown)))})},_isObjectMoved:function(d){d=this.canvas.getPointer(d);return this.__mousedownX!==d.x||this.__mousedownY!==d.y},initMouseupHandler:function(){this.on("mouseup",function(d){this.__isMousedown=!1;if(!this._isObjectMoved(d.e))this.__lastSelected&&(this.enterEditing(),this.initDelayedCursor(!0)),this.selected=!0})},setCursorByClick:function(d){var a=this.getSelectionStartFromPointer(d);d.shiftKey?
a<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(a)):this.setSelectionEnd(a):(this.setSelectionStart(a),this.setSelectionEnd(a))},_getLocalRotatedPointer:function(d){var a=this.canvas.getPointer(d),a=new g.Point(a.x,a.y),f=new g.Point(this.left,this.top),a=g.util.rotatePoint(a,f,g.util.degreesToRadians(-this.angle));return this.getLocalPointer(d,a)},getSelectionStartFromPointer:function(d){for(var d=this._getLocalRotatedPointer(d),a=this.text.split(this._reNewline),
f=0,c=0,b=0,g=0,e=0,j=a.length;e<j;e++){b+=this._getHeightOfLine(this.ctx,e)*this.scaleY;c=this._getLineLeftOffset(this._getWidthOfLine(this.ctx,e,a))*this.scaleX;this.flipX&&(a[e]=a[e].split("").reverse().join(""));for(var k=0,l=a[e].length;k<l;k++){var m=a[e][k],f=c;c+=this._getWidthOfChar(this.ctx,m,e,this.flipX?l-k:k)*this.scaleX;if(b<=d.y||c<=d.x)g++;else return this._getNewSelectionStartFromOffset(d,f,c,g+e,l)}if(d.y<b)return this._getNewSelectionStartFromOffset(d,f,c,g+e,l)}return this.text.length},
_getNewSelectionStartFromOffset:function(d,a,f,c,b){d=c+(f-d.x>d.x-a?0:1);this.flipX&&(d=b-d);if(d>this.text.length)d=this.text.length;return d}});g.util.object.extend(g.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=g.document.createElement("textarea");this.hiddenTextarea.setAttribute("autocapitalize","off");this.hiddenTextarea.style.cssText="position: fixed; bottom: 20px; left: 0px; opacity: 0; width: 0px; height: 0px; z-index: -999;";g.document.body.appendChild(this.hiddenTextarea);
g.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this));g.util.addListener(this.hiddenTextarea,"keypress",this.onKeyPress.bind(this));g.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this));g.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this));if(!this._clickHandlerInitialized&&this.canvas)g.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",
13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",88:"cut"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(d){if(this.isEditing){if(d.keyCode in this._keysMap)this[this._keysMap[d.keyCode]](d);else if(d.keyCode in this._ctrlKeysMap&&(d.ctrlKey||d.metaKey))this[this._ctrlKeysMap[d.keyCode]](d);
else return;d.stopImmediatePropagation();d.preventDefault();this.canvas&&this.canvas.renderAll()}},forwardDelete:function(d){this.selectionStart===this.selectionEnd&&this.moveCursorRight(d);this.removeChars(d)},copy:function(d){var a=this.getSelectedText();(d=this._getClipboardData(d))&&d.setData("text",a);this.copiedText=a;this.copiedStyles=this.getSelectionStyles(this.selectionStart,this.selectionEnd)},paste:function(d){var a=null;(a=(d=this._getClipboardData(d))?d.getData("text"):this.copiedText)&&
this.insertChars(a)},cut:function(d){this.selectionStart!==this.selectionEnd&&(this.copy(),this.removeChars(d))},_getClipboardData:function(d){return d&&(d.clipboardData||g.window.clipboardData)},onKeyPress:function(d){this.isEditing&&!d.metaKey&&!d.ctrlKey&&(d.which!==0&&this.insertChars(String.fromCharCode(d.which)),d.stopPropagation())},getDownCursorOffset:function(d,a){var f=a?this.selectionEnd:this.selectionStart,c=this.text.split(this._reNewline),b=this.text.slice(0,f),g=this.text.slice(f),
e=b.slice(b.lastIndexOf("\n")+1),b=g.match(/(.*)\n?/)[1],g=(g.match(/.*\n(.*)\n?/)||{})[1]||"",j=this.get2DCursorLocation(f);if(j.lineIndex===c.length-1||d.metaKey||d.keyCode===34)return this.text.length-f;for(var k=this._getLineLeftOffset(this._getWidthOfLine(this.ctx,j.lineIndex,c)),l=j.lineIndex,m=0,i=e.length;m<i;m++)f=e[m],k+=this._getWidthOfChar(this.ctx,f,l,m);c=this._getIndexOnNextLine(j,g,k,c);return b.length+1+c},_getIndexOnNextLine:function(d,a,f,c){for(var d=d.lineIndex+1,b=this._getLineLeftOffset(this._getWidthOfLine(this.ctx,
d,c)),g=0,e,c=0,j=a.length;c<j;c++){var k=this._getWidthOfChar(this.ctx,a[c],d,c);b+=k;if(b>f){e=!0;d=b;b=Math.abs(b-k-f);g=Math.abs(d-f)<b?c+1:c;break}}if(!e)g=a.length;return g},moveCursorDown:function(d){this.abortCursorAnimation();this._currentCursorOpacity=1;var a=this.getDownCursorOffset(d,this._selectionDirection==="right");d.shiftKey?this.moveCursorDownWithShift(a):this.moveCursorDownWithoutShift(a);this.initDelayedCursor()},moveCursorDownWithoutShift:function(d){this._selectionDirection=
"right";this.selectionStart+=d;if(this.selectionStart>this.text.length)this.selectionStart=this.text.length;this.selectionEnd=this.selectionStart;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},swapSelectionPoints:function(){var d=this.selectionEnd;this.selectionEnd=this.selectionStart;this.selectionStart=d},moveCursorDownWithShift:function(d){if(this.selectionEnd===this.selectionStart)this._selectionDirection="right";this[this._selectionDirection===
"right"?"selectionEnd":"selectionStart"]+=d;if(this.selectionEnd<this.selectionStart&&this._selectionDirection==="left")this.swapSelectionPoints(),this._selectionDirection="right";if(this.selectionEnd>this.text.length)this.selectionEnd=this.text.length;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getUpCursorOffset:function(d,a){var f=a?this.selectionEnd:this.selectionStart,c=this.get2DCursorLocation(f);if(c.lineIndex===0||d.metaKey||d.keyCode===
33)return f;for(var b=this.text.slice(0,f),f=b.slice(b.lastIndexOf("\n")+1),b=(b.match(/\n?(.*)\n.*$/)||{})[1]||"",g=this.text.split(this._reNewline),e,j=this._getLineLeftOffset(this._getWidthOfLine(this.ctx,c.lineIndex,g)),k=c.lineIndex,l=0,m=f.length;l<m;l++)e=f[l],j+=this._getWidthOfChar(this.ctx,e,k,l);c=this._getIndexOnPrevLine(c,b,j,g);return b.length-c+f.length},_getIndexOnPrevLine:function(d,a,f,c){for(var d=d.lineIndex-1,b=this._getLineLeftOffset(this._getWidthOfLine(this.ctx,d,c)),g=0,e,
c=0,j=a.length;c<j;c++){var k=this._getWidthOfChar(this.ctx,a[c],d,c);b+=k;if(b>f){e=!0;d=b;b=Math.abs(b-k-f);g=Math.abs(d-f)<b?c:c-1;break}}e||(g=a.length-1);return g},moveCursorUp:function(d){this.abortCursorAnimation();this._currentCursorOpacity=1;var a=this.getUpCursorOffset(d,this._selectionDirection==="right");d.shiftKey?this.moveCursorUpWithShift(a):this.moveCursorUpWithoutShift(a);this.initDelayedCursor()},moveCursorUpWithShift:function(d){if(this.selectionEnd===this.selectionStart)this._selectionDirection=
"left";this[this._selectionDirection==="right"?"selectionEnd":"selectionStart"]-=d;if(this.selectionEnd<this.selectionStart&&this._selectionDirection==="right")this.swapSelectionPoints(),this._selectionDirection="left";if(this.selectionStart<0)this.selectionStart=0;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorUpWithoutShift:function(d){this.selectionStart===this.selectionEnd&&(this.selectionStart-=d);if(this.selectionStart<0)this.selectionStart=
0;this.selectionEnd=this.selectionStart;this._selectionDirection="left";this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorLeft:function(d){if(!(this.selectionStart===0&&this.selectionEnd===0))this.abortCursorAnimation(),this._currentCursorOpacity=1,d.shiftKey?this.moveCursorLeftWithShift(d):this.moveCursorLeftWithoutShift(d),this.initDelayedCursor()},_move:function(d,a,f){d.altKey?this[a]=this["findWordBoundary"+f](this[a]):d.metaKey||
d.keyCode===35||d.keyCode===36?this[a]=this["findLineBoundary"+f](this[a]):this[a]+=f==="Left"?-1:1},_moveLeft:function(d,a){this._move(d,a,"Left")},_moveRight:function(d,a){this._move(d,a,"Right")},moveCursorLeftWithoutShift:function(d){this._selectionDirection="left";this.selectionEnd===this.selectionStart&&this._moveLeft(d,"selectionStart");this.selectionEnd=this.selectionStart;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorLeftWithShift:function(d){if(this._selectionDirection===
"right"&&this.selectionStart!==this.selectionEnd)this._moveLeft(d,"selectionEnd");else if(this._selectionDirection="left",this._moveLeft(d,"selectionStart"),this.text.charAt(this.selectionStart)==="\n"&&this.selectionStart--,this.selectionStart<0)this.selectionStart=0;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorRight:function(d){if(!(this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length))this.abortCursorAnimation(),
this._currentCursorOpacity=1,d.shiftKey?this.moveCursorRightWithShift(d):this.moveCursorRightWithoutShift(d),this.initDelayedCursor()},moveCursorRightWithShift:function(d){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)this._moveRight(d,"selectionStart");else if(this._selectionDirection="right",this._moveRight(d,"selectionEnd"),this.text.charAt(this.selectionEnd-1)==="\n"&&this.selectionEnd++,this.selectionEnd>this.text.length)this.selectionEnd=this.text.length;this.fire("selection:changed");
this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorRightWithoutShift:function(d){this._selectionDirection="right";if(this.selectionStart===this.selectionEnd)this._moveRight(d,"selectionStart"),this.selectionEnd=this.selectionStart;else{this.selectionEnd+=this.getNumNewLinesInSelectedText();if(this.selectionEnd>this.text.length)this.selectionEnd=this.text.length;this.selectionStart=this.selectionEnd}this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",
{target:this})},removeChars:function(d){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(d):this._removeCharsFromTo(this.selectionStart,this.selectionEnd);this.selectionEnd=this.selectionStart;this._removeExtraneousStyles();this.canvas&&this.canvas.renderAll().renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(d){if(this.selectionStart!==0)d.metaKey?(d=this.findLineBoundaryLeft(this.selectionStart),
this._removeCharsFromTo(d,this.selectionStart),this.selectionStart=d):d.altKey?(d=this.findWordBoundaryLeft(this.selectionStart),this._removeCharsFromTo(d,this.selectionStart),this.selectionStart=d):(this.removeStyleObject(this.text.slice(this.selectionStart-1,this.selectionStart)==="\n"),this.selectionStart--,this.text=this.text.slice(0,this.selectionStart)+this.text.slice(this.selectionStart+1))}});g.util.object.extend(g.IText.prototype,{_setSVGTextLineText:function(d,a,f,c,b,g){this.styles[a]?
this._setSVGTextLineChars(d,a,f,c,b,g):this.callSuper("_setSVGTextLineText",d,a,f,c,b)},_setSVGTextLineChars:function(d,a,f,c,b,g){for(var c=a===0||this.useNative?"y":"dy",d=d.split(""),b=0,e=this._getSVGLineLeftOffset(a),j=this._getSVGLineTopOffset(a),k=this._getHeightOfLine(this.ctx,a),l=0,m=d.length;l<m;l++){var i=this.styles[a][l]||{};f.push(this._createTextCharSpan(d[l],i,e,j,c,b));var n=this._getWidthOfChar(this.ctx,d[l],a,l);i.textBackgroundColor&&g.push(this._createTextCharBg(i,e,j,k,n,b));
b+=n}},_getSVGLineLeftOffset:function(d){return this._boundaries&&this._boundaries[d]?g.util.toFixed(this._boundaries[d].left,2):0},_getSVGLineTopOffset:function(d){for(var a=0,f=0;f<=d;f++)a+=this._getHeightOfLine(this.ctx,f);return a-this.height/2},_createTextCharBg:function(d,a,f,c,b,g){return['<rect fill="',d.textBackgroundColor,'" transform="translate(',-this.width/2," ",-this.height+c,')" x="',a+g,'" y="',f+c,'" width="',b,'" height="',c,'"></rect>'].join("")},_createTextCharSpan:function(d,
a,f,c,b,h){var e=this.getSvgStyles.call(g.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text"},a));return['<tspan x="',f+h,'" ',b,'="',c,'" ',a.fontFamily?'font-family="'+a.fontFamily.replace(/"/g,"'")+'" ':"",a.fontSize?'font-size="'+a.fontSize+'" ':"",a.fontStyle?'font-style="'+a.fontStyle+'" ':"",a.fontWeight?'font-weight="'+a.fontWeight+'" ':"",a.textDecoration?'text-decoration="'+a.textDecoration+'" ':"",'style="',e,'">',g.util.string.escapeXml(d),"</tspan>"].join("")}});
(function(){function d(a,d,e){var f=c.parse(a);if(!f.port)f.port=f.protocol.indexOf("https:")===0?443:80;a=(f.port===443?h:b).request({hostname:f.hostname,port:f.port,path:f.path,method:"GET"},function(a){var b="";d&&a.setEncoding(d);a.on("end",function(){e(b)});a.on("data",function(c){a.statusCode===200&&(b+=c)})});a.on("error",function(a){a.errno===process.ECONNREFUSED?g.log("ECONNREFUSED: connection refused to "+f.hostname+":"+f.port):g.log(a.message)});a.end()}function a(a,b){require("fs").readFile(a,
function(a,c){if(a)throw g.log(a),a;else b(c)})}if(!(typeof document!=="undefined"&&typeof B!=="undefined")){var f=require("xmldom").DOMParser,c=require("url"),b=require("http"),h=require("https"),e=require("canvas"),j=require("canvas").Image;g.util.loadImage=function(b,c,e){function f(a){g.src=new Buffer(a,"binary");g._src=b;c&&c.call(e,g)}var g=new j;b&&(b instanceof Buffer||b.indexOf("data")===0)?(g.src=g._src=b,c&&c.call(e,g)):b&&b.indexOf("http")!==0?a(b,f):b?d(b,"binary",f):c&&c.call(e,b)};
g.loadSVGFromURL=function(b,c,e){b=b.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();b.indexOf("http")!==0?a(b,function(a){g.loadSVGFromString(a.toString(),c,e)}):d(b,"",function(a){g.loadSVGFromString(a,c,e)})};g.loadSVGFromString=function(a,b,c){a=(new f).parseFromString(a);g.parseSVGDocument(a.documentElement,function(a,c){b&&b(a,c)},c)};g.util.getScript=function(a,b){d(a,"",function(a){eval(a);b&&b()})};g.Image.fromObject=function(a,b){g.util.loadImage(a.src,function(c){var d=new g.Image(c);d._initConfig(a);
d._initFilters(a,function(a){d.filters=a||[];b&&b(d)})})};g.createCanvasForNode=function(a,b,c,d){var d=d||c,f=g.document.createElement("canvas"),a=new e(a||600,b||600,d);f.style={};f.width=a.width;f.height=a.height;c=new (g.Canvas||g.StaticCanvas)(f,c);c.contextContainer=a.getContext("2d");c.nodeCanvas=a;c.Font=e.Font;return c};g.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};g.StaticCanvas.prototype.createJPEGStream=function(a){return this.nodeCanvas.createJPEGStream(a)};
var k=g.StaticCanvas.prototype.setWidth;g.StaticCanvas.prototype.setWidth=function(a,b){k.call(this,a,b);this.nodeCanvas.width=a;return this};if(g.Canvas)g.Canvas.prototype.setWidth=g.StaticCanvas.prototype.setWidth;var l=g.StaticCanvas.prototype.setHeight;g.StaticCanvas.prototype.setHeight=function(a,b){l.call(this,a,b);this.nodeCanvas.height=a;return this};if(g.Canvas)g.Canvas.prototype.setHeight=g.StaticCanvas.prototype.setHeight}})();B.fabric=g;m=m||{};m.fabric=g;typeof define==="function"&&define.amd&&
define([],function(){return g});return g})})})(function(){var s=window.AmazonUIPageJS||window.P,B=s._namespace||s.attributeErrors;return B?B("AmazonCustomFabricJS"):s}(),window);
(function(s,B,t){s.execute(function(){(function(){s.when("A","ac-weblab","ready").register("BuyBox",function(n,m){return function(g){function d(){var a={},b={},c=!1;k.controller!==t&&(a=k.controller.getJSON());b.customizationData=JSON.stringify(a);if(g("#amazonCustomUseCaseId").length)b.clientId=g("#amazonCustomUseCaseId").val();g(".pc-error-container").hide();c=s(a);n.post("/gp/product/features/callSetCustomizationDatav2.html",{dataType:"json",params:b,contentType:"application/x-www-form-urlencoded;charset=utf-8",
success:function(a){c&&n.trigger("amazon-custom-log-ref-tag","hasNonASCII",{msg:a.result.pcToken});a.result.Status==="OK"&&a.result.pcToken!==t?(n.trigger("amazon-custom-log-ref-tag","AddToCartClick"),g("#UNIQ-pcToken",g(".pc-buy-box")).val(a.result.pcToken),g("#addToCart").submit()):g(".pc-error-container").show()},error:function(){g(".pc-error-container").show()}})}function a(a){var b=g("#pc-atc"),c=g(".pc-atc-wrapper");a?(b.prop("disabled",!1),c.removeClass("a-button-disabled")):(b.prop("disabled",
!0),c.addClass("a-button-disabled"))}function f(a,c){b(g(".pc-atc-missing-customization"),a,c)}function c(a,c){b(g(".pc-atc-missing-required-text"),a,c)}function b(a,b,c){b?a.show():a.hide();c&&c.error?a.addClass("a-color-error"):a.removeClass("a-color-error")}function h(a){l=!0;if(a)o=a.callback}function e(){l=!1;o=null}var j={$el:t,showLabel:!0,controller:t},k={},l=!1,o=null,i=function(a){k=g.extend({},j,a);return this};i.prototype.getComponentName=function(){return"BuyBox"};i.prototype.Init=function(){p.Bind();
m.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_71376")&&(f(!1),c(!1))};var p={Bind:function(){n.declarative("upload-metadata","click",function(a){a.$event.preventDefault();g("#pc-atc").is(":disabled")||(m.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_71376")&&l?g.isFunction(o)&&o():(n.trigger("amazon-custom-popup-close",new Date),d()))});n.on("enableBuybox",function(){a(!0)});n.on("disableBuybox",function(){a(!1)});m.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_71376")&&(n.on("showMissingCustomization",function(a){f(!0,a)}),n.on("hideMissingCustomization",
function(){f(!1)}),n.on("showMissingRequiredFields",function(a){c(!0,a)}),n.on("hideMissingRequiredFields",function(){c(!1)}),n.on("blockBuybox",h),n.on("unblockBuybox",e))}},s=function(a){for(var a=a.customizationInfo["version3.0"].surfaces,b=RegExp(/[^\x00-\x7F]+/g),c=0;c<a.length;c++)for(var d=0;d<a[c].areas.length;d++)if(a[c].areas[d].customizationType==="TextPrinting"&&b.test(a[c].areas[d].text))return!0;return!1};return i}(n.$)})})()})})(function(){var s=window.AmazonUIPageJS||window.P,B=s._namespace||
s.attributeErrors;return B?B("AmazonCustomBuyBoxAssets"):s}(),window);